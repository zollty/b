---
layout: ue
title: 精通Log4j配置
category: Java框架和组件
tags: 日志,Log4j
keywords: "精通Log4j配置"
---

<p style="text-align:center;line-height:150%"><span class="Apple-style-span" style="color: rgb(0, 112, 192); font-family: &#39;Courier New&#39; font-size: 16px; line-height: 28px; ">&nbsp;</span><br/></p><p style="line-height:150%"><span style="font-size: 20px; "><strong>一、<span style="font-family: &#39;Courier New&#39;; ">logger</span>、<span style="font-family: &#39;Courier New&#39;; ">appender</span>、<span style="font-family: &#39;Courier New&#39;; ">layout</span></strong></span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">Log4j&nbsp;can&nbsp;send&nbsp;your&nbsp;log&nbsp;messages&nbsp;</span><span style="font-family: &#39;Courier New&#39;font-size: 16px">to&nbsp;the&nbsp;console,&nbsp;a&nbsp;text&nbsp;file,&nbsp;an&nbsp;html&nbsp;file,&nbsp;an&nbsp;xml&nbsp;file,&nbsp;and&nbsp;so&nbsp;on</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">.</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">日志制造者</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-weight:bold;font-size:16px;background:rgb(255,255,0);background:rgb(255,255,0)">logger</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">:&nbsp;send&nbsp;your&nbsp;message&nbsp;strings&nbsp;to&nbsp;destinations&nbsp;or&nbsp;targets.</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">Log4j&nbsp;can&nbsp;log&nbsp;the&nbsp;message&nbsp;you&nbsp;send,&nbsp;log&nbsp;the&nbsp;</span><span style="font-family: &#39;Courier New&#39;font-size: 16px">date,&nbsp;time,&nbsp;message&nbsp;priority,&nbsp;Java&nbsp;class&nbsp;name,&nbsp;source&nbsp;code&nbsp;line&nbsp;number,&nbsp;method&nbsp;name,&nbsp;Java&nbsp;thread&nbsp;name</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;and&nbsp;much&nbsp;more.</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">日志目标</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-weight:bold;font-size:16px;background:rgb(255,255,0);background:rgb(255,255,0)">appender</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">:&nbsp;logging&nbsp;destinations&nbsp;are&nbsp;called&nbsp;&quot;appenders&quot;.</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">Some&nbsp;common&nbsp;appender&nbsp;classes&nbsp;are&nbsp;</span><span style="font-family: &#39;Courier New&#39;font-size: 16px">ConsoleAppender,&nbsp;FileAppender,&nbsp;SMTPAppender</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">.</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">指定格式</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-weight:bold;font-size:16px;background:rgb(255,255,0);background:rgb(255,255,0)">layout</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">:&nbsp;An&nbsp;appender&nbsp;uses&nbsp;a&nbsp;layout&nbsp;to&nbsp;</span><span style="font-family: &#39;Courier New&#39;font-size: 16px">format&nbsp;your&nbsp;message&nbsp;before&nbsp;actually&nbsp;writing&nbsp;it&nbsp;to&nbsp;the&nbsp;log</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">.&nbsp;For&nbsp;example,&nbsp;the&nbsp;HTMLLayout&nbsp;will&nbsp;format&nbsp;all&nbsp;your&nbsp;messages&nbsp;into&nbsp;a&nbsp;nice&nbsp;HTML&nbsp;table.</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">定义优先级</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-weight:bold;font-size:16px;background:rgb(255,255,0);background:rgb(255,255,0)">priority</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">:&nbsp;Five&nbsp;priority&nbsp;constants&nbsp;in&nbsp;the&nbsp;Priority&nbsp;class&nbsp;are</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;font-size: 16px">FATAL</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;font-size: 16px">ERROR</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;font-size: 16px">WARN</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;font-size: 16px">INFO</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;font-size: 16px">DEBUG</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">in&nbsp;the&nbsp;order&nbsp;of&nbsp;decreasing&nbsp;priority.You&nbsp;can&nbsp;make&nbsp;more&nbsp;by&nbsp;subclassing&nbsp;if&nbsp;you&nbsp;want.</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><strong><span style="font-family: &#39;Courier New&#39;font-size: 16px">二、</span></strong><span style="font-family: &#39;Courier New&#39;font-size: 16px"><span style="font-size: 20px; "><strong><span style="font-family: &#39;Courier New&#39;; ">Configuring&nbsp;Log4j</span></strong></span></span></p><p><span style="font-size: 16px; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-position: initial initial; background-repeat: initial initial; "><br/></span></p><p><span style="font-size: 16px; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-position: initial initial; background-repeat: initial initial; ">The&nbsp;default&nbsp;file&nbsp;which&nbsp;configures&nbsp;log4j&nbsp;is&nbsp;log4j.properties.&nbsp;</span>Place&nbsp;it&nbsp;anywhere&nbsp;in&nbsp;the&nbsp;application&nbsp;classpath<span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">.</span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">指定格式</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">Here&nbsp;is&nbsp;an&nbsp;example&nbsp;output&nbsp;using&nbsp;PatternLayout&nbsp;with&nbsp;the&nbsp;conversion&nbsp;pattern&nbsp;</span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">&quot;%r&nbsp;[%t]&nbsp;%-5p&nbsp;%c{2}&nbsp;%x&nbsp;-&nbsp;%m%n&quot;</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">效果如下：</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">176&nbsp;[main]&nbsp;INFO&nbsp;&nbsp;examples.Sort&nbsp;-&nbsp;Populating&nbsp;an&nbsp;array&nbsp;of&nbsp;2&nbsp;elements&nbsp;in&nbsp;reverse&nbsp;order.</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">225&nbsp;[main]&nbsp;INFO&nbsp;&nbsp;examples.SortAlgo&nbsp;-&nbsp;Entered&nbsp;the&nbsp;sort&nbsp;method.</span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">解释：</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%r</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">代表系统启动的时间</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">[%t]</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">代表输出消息的那个线程</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%-5p</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">代表消息的级别</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%c{2}</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">代表</span><span style="font-family: &#39;Courier New&#39;font-size: 16px">截取完整类名的后两个名，例如<span style="font-family:Courier New">com.zollty.Sort</span>，截取右两位就是<span style="font-family:Courier New">zollty.Sort</span></span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%x</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">代表<span style="font-family:Courier New">the&nbsp;nested&nbsp;diagnostic&nbsp;context&nbsp;(NDC)</span></span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%m%n</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">代表消息内容</span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">几种格式对比：</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">1</span><span style="color:rgb(0,112,192);font-size:16px">.</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">时间</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%d</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;">2012-11-04&nbsp;17:19:06,428</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%d{ABSOLUTE}</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;">17:19:06,428</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%</span><span style="color:rgb(0,112,192);font-size:16px">r</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;">428</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%-4r</span></p><p style="line-height: normal; "><span style="font-family: 宋体">2</span><span style="font-family: &#39;Courier New&#39;">428</span></p><p><span style="color:rgb(0,112,192);font-size:16px">时间还可以格式化为：</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%d{dd&nbsp;MMM&nbsp;yyyy&nbsp;HH:mm:ss,SSS}</span></p><p><span style="color:rgb(0,112,192);font-size:16px">官方文档推荐用以下三种格式</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&quot;ABSOLUTE&quot;,&nbsp;&quot;DATE&quot;&nbsp;and&nbsp;&quot;ISO8601&quot;</span><span style="color:rgb(0,112,192);font-size:16px">(default)</span></p><p><span style="color:rgb(0,32,96);font-size:16px">我推荐使用</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,32,96);font-size:16px">%d{ABSOLUTE}</span><span style="color:rgb(0,32,96);font-size:16px">，输出日志文件时按天生成文件，例如<span style="font-family:Courier New">zollty</span></span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,32,96);font-size:16px">.log.2012-09-03</span><span style="color:rgb(0,32,96);font-size:16px">。</span></p><p><span style="font-family: 宋体;font-size: 16px">[%t]和<span style="font-family:Courier New">%x</span>不推荐使用<span style="font-family:Courier New">.</span></span></p><p><span style="font-family: &#39;Courier New&#39;font-size: 16px">%-5p</span><span style="font-family: 宋体;font-size: 16px">是推荐的格式，<span style="font-family:Courier New">-5</span>代表，左对齐，取<span style="font-family:Courier New">5</span>位，例如</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">DEBUG</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">[main]:&nbsp;Message&nbsp;1</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">WARN</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">[main]:&nbsp;Message&nbsp;2</span></p><p><span style="color:rgb(0,112,192);font-size:16px">虽然<span style="font-family:Courier New">WARN</span>只有<span style="font-family:Courier New">4</span>个单词，但是占<span style="font-family:Courier New">5</span>位，这样就能和<span style="font-family:Courier New">DEBUG</span>对齐。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: 宋体;font-size: 16px">%c的使用要看情况，其实本来是很好用的，但是速度比较慢。官方文档中说到：</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">WARNING&nbsp;Generating&nbsp;the&nbsp;caller&nbsp;class&nbsp;information&nbsp;is&nbsp;slow.&nbsp;Thus,&nbsp;use&nbsp;should&nbsp;be&nbsp;avoided&nbsp;unless&nbsp;execution&nbsp;speed&nbsp;is&nbsp;not&nbsp;an&nbsp;issue.</span></p><p><span style="font-family: 宋体;font-size: 16px">可见，在速度不是很重要的情况下，可以使用<span style="font-family:Courier New">%c</span>。</span></p><p><span style="font-family:宋体;font-size:16px"><span class="Apple-style-span" style="line-height: 28px;"><br/></span></span></p><p><span style="font-family: 宋体;font-size: 16px">再调试时，可以用以下格式</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">%c{1}:%L</span></p><p><span style="color:rgb(0,112,192);font-size:16px">即输出类名和行号。其实输出行号和类名意义也不大，特别是对于<span style="font-family:Courier New">INFO</span>、<span style="font-family:Courier New">DEBUG</span>级别的信息。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: 宋体;font-size: 16px">我推荐的格式</span></p><p><span style="color:rgb(0,112,192);font-size:16px">控制台标准格式：（生成时务必注释掉，否则影响性能）</span></p><p><strong><span style="font-family: &#39;Courier New&#39;font-size: 16px">%d{ABSOLUTE}&nbsp;%-5p&nbsp;%c{1}:%L&nbsp;-&nbsp;%m%n</span></strong></p><p><span style="color:rgb(0,112,192);font-size:16px">日志文件标准格式：<span style="font-family:Courier New">(</span>性能优先<span style="font-family:Courier New">)</span></span></p><p><strong><span style="font-family: &#39;Courier New&#39;font-size: 16px">%d&nbsp;%p&nbsp;-&nbsp;%m%n</span></strong></p><p><span style="color:#0070c0;font-size:16px"><span class="Apple-style-span" style="line-height: 28px;"><br/></span></span></p><p><span style="color:rgb(0,112,192);font-size:16px">可以把<span style="font-family:Courier New">ERROR</span>和<span style="font-family:Courier New">DEBUG</span>级别的日志分开，否则在一大堆<span style="font-family:Courier New">INFO</span>中找<span style="font-family:Courier New">ERROR</span>比较难。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: 宋体;font-size: 16px">输出到文件，示例：</span></p><pre class="brush:xml;toolbar:false">&lt;appender&nbsp;name=&quot;DAILY&quot;&nbsp;class=&quot;org.apache.log4j.DailyRollingFileAppender&quot;&gt;
&nbsp;&nbsp;&lt;param&nbsp;name=&quot;file&quot;&nbsp;value=&quot;D:/logs/StrutsGA/StrutsGA.log&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;param&nbsp;name=&quot;DatePattern&quot;&nbsp;value=&quot;&#39;.&#39;yyyy-MM-dd&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;param&nbsp;name=&quot;threshold&quot;&nbsp;value=&quot;info&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;param&nbsp;name=&quot;append&quot;&nbsp;value=&quot;true&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;layout&nbsp;class=&quot;org.apache.log4j.PatternLayout&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&nbsp;name=&quot;ConversionPattern&quot;&nbsp;value=&quot;%d&nbsp;%p&nbsp;-&nbsp;%m%n&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;/layout&gt;
&lt;/appender&gt;</pre><p style="line-height: normal; "><br/></p><p><span style="color:rgb(0,112,192);font-size:16px">其中</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;param&nbsp;name=&quot;DatePattern&quot;&nbsp;value=&quot;&#39;.&#39;yyyy-MM-dd&quot;&nbsp;/&gt;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">代表：</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">Rollover&nbsp;at&nbsp;midnight&nbsp;each&nbsp;day.</span></p><p><span style="color:rgb(0,112,192);font-size:16px">即日志按天保存，例如</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">/</span><span style="color:rgb(0,112,192);font-size:16px">logs</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">/</span><span style="color:rgb(0,112,192);font-size:16px">cqrd</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">.log.20</span><span style="color:rgb(0,112,192);font-size:16px">1</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">2-0</span><span style="color:rgb(0,112,192);font-size:16px">5</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">-08</span><span style="color:rgb(0,112,192);font-size:16px">，这是默认值，不设置也是一样的。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">另外常用的还有</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&#39;.&#39;yyyy-MM</span></p><p><span style="color:rgb(0,112,192);font-size:16px">代表日志按月保存，适合数据量较小的日志。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">再看</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;param&nbsp;name=&quot;threshold&quot;&nbsp;value=&quot;info&quot;/&gt;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">其意思是忽略比<span style="font-family:Courier New">info</span>级别低的信息。官方说明如下：</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">All&nbsp;log&nbsp;events&nbsp;with&nbsp;lower&nbsp;level&nbsp;than&nbsp;the&nbsp;threshold&nbsp;level&nbsp;are&nbsp;ignored&nbsp;by&nbsp;the&nbsp;appender</span></p><p><span style="color:rgb(0,112,192);font-size:16px">其作用和下面的过滤器差不多：</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;filter&nbsp;class=&quot;org.apache.log4j.varia.LevelRangeFilter&quot;&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;param&nbsp;name=&quot;LevelMin&quot;&nbsp;value=&quot;INFO&quot;&nbsp;/&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;param&nbsp;name=&quot;LevelMax&quot;&nbsp;value=&quot;FATAL&quot;&nbsp;/&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;/filter&gt;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">只不过，过滤器可以两头控制，而</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">threshold</span><span style="color:rgb(0,112,192);font-size:16px">只能控制最低的那一端。通常来说，用</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">threshold</span><span style="color:rgb(0,112,192);font-size:16px">足够了。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: 宋体;font-size: 16px">输出到控制台，示例：</span></p><pre class="brush:xml;toolbar:false">&lt;appender&nbsp;name=&quot;stdout&quot;&nbsp;class=&quot;org.apache.log4j.ConsoleAppender&quot;&gt;
&nbsp;&nbsp;&lt;param&nbsp;name=&quot;Target&quot;&nbsp;value=&quot;System.out&quot;/&gt;
&nbsp;&nbsp;&lt;layout&nbsp;class=&quot;org.apache.log4j.PatternLayout&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&nbsp;name=&quot;ConversionPattern&quot;&nbsp;value=&quot;%d{ABSOLUTE}&nbsp;%-5p&nbsp;%c{1}:%L&nbsp;-&nbsp;%m%n&quot;/&gt;
&nbsp;&nbsp;&lt;/layout&gt;
&nbsp;&nbsp;&lt;filter&nbsp;class=&quot;org.apache.log4j.varia.LevelRangeFilter&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&nbsp;name=&quot;LevelMin&quot;&nbsp;value=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;param&nbsp;name=&quot;LevelMax&quot;&nbsp;value=&quot;FATAL&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;/filter&gt;
&lt;/appender&gt;</pre><p><span class="Apple-style-span" style="color: rgb(0, 112, 192); font-size: 14px; line-height: 25px; ">其中</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;param&nbsp;name=&quot;</span><span style="color:rgb(0,112,192);font-size:16px">T</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">arget&quot;&nbsp;value=&quot;System.out&quot;/&gt;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">这个<span style="font-family:Courier New">target</span>有两个值可选</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">System.out</span><span style="color:rgb(0,112,192);font-size:16px">(默认<span style="font-family:Courier New">)</span>和</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">System.</span><span style="color:rgb(0,112,192);font-size:16px">err。</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">System.out</span><span style="color:rgb(0,112,192);font-size:16px">是默认值，不设置也是一样的。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="font-family: 宋体;font-size: 16px">下面来看看</span><span style="font-family: &#39;Courier New&#39;font-size: 16px">category</span><span style="font-family: 宋体;font-size: 16px">和<span style="font-family:Courier New">logger</span>的配置</span></p><p><span style="color:rgb(0,112,192);font-size:16px">其<span style="font-family:Courier New">dtd</span>验证如下：</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span><span class="Apple-style-span" style="font-size: 14px; line-height: normal; ">&lt;!ELEMENT&nbsp;category&nbsp;(param*,(priority|level)?,appender-ref*)&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;!ATTLIST&nbsp;category</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CDATA&nbsp;&nbsp;&nbsp;#IMPLIED</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;&nbsp;name</span> &nbsp;<span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">CDATA</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">#REQUIRED</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;&nbsp;additivity</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">(true|false)&nbsp;&quot;true&quot;&nbsp;&nbsp;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;!ELEMENT&nbsp;logger&nbsp;(param*,level?,appender-ref*)&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;!ATTLIST&nbsp;logger</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CDATA&nbsp;&nbsp;&nbsp;#IMPLIED</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;&nbsp;name</span> &nbsp;<span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">CDATA</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">#REQUIRED</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp;&nbsp;additivity</span> <span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">(true|false)&nbsp;&quot;true&quot;&nbsp;&nbsp;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&gt;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">可见它们都有三个参数：<span style="font-family:Courier New">class</span>、<span style="font-family:Courier New">name</span>和<span style="font-family:Courier New">additivity</span></span></p><p><span style="color:rgb(0,112,192);font-size:16px">其中<span style="font-family:Courier New">additivity</span>可为空，其默认值为<span style="font-family:Courier New">true</span>，代表可以多次输出。一般建议见其设置为<span style="font-family:Courier New">false</span>，这样信息就只输出一次。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">有三个子标签：<span style="font-family:Courier New">param*</span>、</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">(priority|level)</span><span style="color:rgb(0,112,192);font-size:16px">？和</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">appender-ref</span><span style="color:rgb(0,112,192);font-size:16px">*</span></p><p><span style="color:rgb(0,112,192);font-size:16px">“<span style="font-family:Courier New">*</span>”代表<span style="font-family:Courier New">0</span>到多个，<span style="font-family:Courier New">?</span>代表一个，也就是说可以用<span style="font-family:Courier New">0</span>到多个<span style="font-family:Courier New">param</span>和</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">appender-ref</span><span style="color:rgb(0,112,192);font-size:16px">，而</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">priority</span><span style="color:rgb(0,112,192);font-size:16px">和</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">level</span><span style="color:rgb(0,112,192);font-size:16px">只能有其中一个。注意</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">logger</span><span style="color:rgb(0,112,192);font-size:16px">中只有<span style="font-family:Courier New">level</span>，不能定义</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">priority</span><span style="color:rgb(0,112,192);font-size:16px">。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">例如：</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;logger&nbsp;name=&quot;org.hibernate&quot;&nbsp;additivity=&quot;false&quot;&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp; &nbsp; &lt;level&nbsp;value=&quot;INFO&quot;&nbsp;/&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&nbsp; &nbsp; &lt;appender-ref&nbsp;ref=&quot;stdout&quot;&nbsp;/&gt;</span></p><p style="line-height: normal; "><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">&lt;/logger&gt;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">category</span><span style="color:rgb(0,112,192);font-size:16px">和<span style="font-family:Courier New">logger</span>的区别：</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;&nbsp;&nbsp;&nbsp;这个我也不太清楚，好像</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">category</span><span style="color:rgb(0,112,192);font-size:16px">是<span style="font-family:Courier New">logger</span>的前身，<span style="font-family:Courier New">logger</span>是后面版本才推出的，其作用应该和</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">category</span><span style="color:rgb(0,112,192);font-size:16px">差不多。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">level</span><span style="color:rgb(0,112,192);font-size:16px">和</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">priority</span><span style="color:rgb(0,112,192);font-size:16px">的区别：</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;&nbsp;&nbsp;好像</span><span style="color:rgb(0,112,192);font-size:16px">没区别，都是表示一个范围，输出<span style="font-family:Courier New">&gt;=</span>设定级别的信息，老版本的<span style="font-family:Courier New">category</span>可以使用</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">priority</span><span style="color:rgb(0,112,192);font-size:16px">，但是<span style="font-family:Courier New">logger</span>中只能用<span style="font-family:Courier New">level</span>了。可见<span style="font-family:Courier New">logger</span>简化了<span style="font-family:Courier New">category</span>的使用。</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">logger、<span style="font-family:Courier New">cateory</span>和<span style="font-family:Courier New">appender</span>都可以定义优先级，那么以哪个的优先级为准呢？</span></p><p><span style="color:rgb(0,112,192);font-size:16px">&nbsp;</span></p><p><span style="color:rgb(0,112,192);font-size:16px">应该是取最高级别的那个。例如，上例中的那个<span style="font-family:Courier New">logger</span>，<span style="font-family:Courier New">level</span>为<span style="font-family:Courier New">INFO</span>，它的</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">appender-ref</span><span style="color:rgb(0,112,192);font-size:16px">指向</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">stdout</span><span style="color:rgb(0,112,192);font-size:16px">，如果这个名叫</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">stdout</span><span style="color:rgb(0,112,192);font-size:16px">的<span style="font-family:Courier New">appender</span>的</span><span style=";font-family:&#39;Courier New&#39;color:rgb(0,112,192);font-size:16px">threshold</span><span style="color:rgb(0,112,192);font-size:16px">设置为<span style="font-family:Courier New">WARN</span>，则就以<span style="font-family:Courier New">WARN</span>为准。</span></p><p><span style="color:rgb(0,112,192);font-size:16px"></span></p><p>另外，appender中还可以设置filter，filter是最后一道检查的关卡。<br/><br/>即：日志级别检查顺序为 <br/>logger(level或者priority) -- appender(&nbsp; threshold&nbsp; ) -- appender(&nbsp; filter&nbsp; )<br/><br/>注意：root也是一个logger，称之为rootlogger，注意到一点，如果logger的级别不为空，那么它会覆盖rootlogger的级别。以下是源码：<br/>&nbsp; public Level getEffectiveLevel() {<br/>&nbsp;&nbsp;&nbsp; for(Category c = this; c != null; c=c.parent) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(c.level != null)<br/>&nbsp;&nbsp; &nbsp;return c.level;<br/>&nbsp;&nbsp;&nbsp; }<br/>&nbsp;&nbsp;&nbsp; return null;<br/>&nbsp; }<br/>默认new出来的logger，level都是null的，但是如下这样配置的logger，<br/>&nbsp;&nbsp; &nbsp;&lt;logger name=&quot;org.springframework.beans.factory&quot;&gt;<br/>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;level value=&quot;error&quot; /&gt;<br/>&nbsp;&nbsp; &nbsp;&lt;/logger&gt;<br/>那么level就不为null，故这个level的级别会覆盖rootlogger的级别。rootlogger的级别就不起作用可。<br/><br/>实际上，还有一个最优先的级别——Repository，log4j是最优先检查这个级别的。<br/><br/>所以完整的检查级别是：<br/><br/>（注意logger和category等价，level和priority等价，不再单独说明）<br/>（[]的内容代表“可选”）<br/>Repository（threshold）--[ logger(level) ] -- rootlogger<br/>&nbsp;-- appender(&nbsp; threshold&nbsp; ) -- appender(&nbsp; filter&nbsp; )<br/><br/><br/>但是注意logger的范围只是定义在一个包中有用，而appender的定义是全局的。<br/><br/><span style="font-size: 20px;">总结：Log4j日志级别设置-各种设置的优先级</span><br/><br/>1、利用threshold或者filter设置，这种级别是最高的。而且以后用任何其他方式动态设置都不会再起作用。例如，在配置文件中配置了级别为ERROR，然后在程序中动态的修改某个logger的级别为INFO：logger.setLevel(Level.INFO); 这样是不会其作用的。<br/><br/>2、在配置root的时候用priority设置的级别，这种级别是最低的。会被其他方式设置的级别覆盖。<br/><br/>3、程序中使用logger.setLevel动态设置的级别，会覆盖配置文件中的priority的设置，但是不会覆盖threshold或者filter设置。如果设置了threshold或者filter设置，最终还是以它们的设置为准。<br/><br/></p><p>&nbsp;</p><p><br/></p>