---
layout: ue
title: 多线程是否能加快处理速度
category: 计算机原理和基础
tags: 多线程
keywords: "多线程是否能加快处理速度"
---

<p><br/></p><p>问：多线程是不是能加快处理速度？</p><p>解析：</p><p><span class="Apple-tab-span" style="white-space:pre"></span>在使用多线程时，一定要知道一个道理：<strong>处理速度的最终决定因素是CPU、内存等</strong>，<strong>在单CPU（无论多少核）上，分配CPU资源的单位是“进程”而不是“线程”</strong>。</p><p>我们可以做一个简单的试验：</p><p><span class="Apple-tab-span" style="white-space:pre"></span>假设我要拷贝100万条数据，单CPU电脑，用一个进程，在单线程的情况下，CPU占用率为5%，耗时1000秒。那么当在这个进程下，开辟10个线程同时去运行，是不是CPU占用率增加到50%，耗时减少到100秒呢？显然不是。我实测出来的情况是这样的：</p><p><span class="Apple-tab-span" style="white-space:pre"></span>“CPU占用率仍然是5%，总耗时仍然是1000秒。且每个线程的运行时间也为1000秒。”</p><p>重点是后面那句，怎么理解？意味着什么？</p><p><span class="Apple-tab-span" style="white-space:pre"></span>我的理解如下：<strong>进程只有一个，所以分配的CPU资源是一定的，多线程只不过是轮流抢占CPU而已</strong>，并不会真正提高处理速度。这意味着，<strong>多线程的作用主要在于提高了并发数量，比如http请求，如果是单线程，一次只能接收一个请求，多线程则可以同时接收多个请求</strong>。</p><p><span class="Apple-tab-span" style="white-space:pre"></span><strong>但是多线程由于轮换使用CPU，会造成单个线程的执行速度变慢</strong>（以前CPU供一个线程使用，现在要供多个线程轮流使用了）。<strong>但是在多CPU的服务器上，多线程就很有优势了，它不但能提高并发数量，而且能提高处理速度</strong>。因为在多CPU的服务器上，<strong>CPU调度</strong>很灵活，当一个线程占用着一个CPU的时候，其他线程可以被分配给其他CPU去处理，从而实现了“真正意义上地并行”。</p><p><br/></p><p>总结：</p><p><span class="Apple-tab-span" style="white-space:pre"></span>第一，看硬件。<strong>如果是在比较强大的、多CPU的服务器上运行程序，可以使用多线程来提高并发数和执行速度</strong>。<strong>但是线程也不宜过多，即使是16个CPU的服务器，同一时间最多也只能真正意义上地并发处理16个线程，多出来的线程还是要等待</strong>。</p><p><span class="Apple-tab-span" style="white-space: pre; "></span>第二，看用途。如果你不在乎处理速度，仅仅是为了提高并发处理能力，那么理所当然地用多线程，但是如果你仅仅是想提高处理速度，且又是在单CPU机器上运行，那么多线程并不值得。<strong>如果你的任务很耗时，且可以一部分、一部分地做，那么最好不要用多线程</strong>（<span style="color: rgb(0, 112, 192); ">好比搬砖，单线程一次搬10块，总共搬10天，但搬一块算一块，到第9天的时候，你就搬完90块砖了；如果你用10个线程同时去搬砖，同样要搬10天，但是到第9天的时候，这10个线程100块砖都“还在路上”，一块砖都没搬完！</span>）。</p><p><br/></p><p><span style="font-size: 24px; "><strong>一个实际例子</strong></span></p><p><br/></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">在单线程的情况下，假如说我们生成<span style="font-family:Times New Roman">10</span><span style="font-family:宋体">个报表文件需要</span><span style="font-family:Times New Roman">1</span><span style="font-family:宋体">个小时。</span></span></p><p style="line-height:29px"><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">&nbsp;</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">如果是在多线程的情况下呢，生成<span style="font-family:Times New Roman">10</span><span style="font-family:宋体">个文件要多少个小时？</span></span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">同样要<span style="font-family:Times New Roman">1</span><span style="font-family:宋体">个小时。不管你有多少个线程，就算你有</span><span style="font-family:Times New Roman">100</span><span style="font-family:宋体">个线程，一样需要</span><span style="font-family:Times New Roman">1</span><span style="font-family:宋体">个小时。</span></span></p><p style="line-height:29px"><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">&nbsp;</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">这就是问题所在。单线程和多线程的区别在哪里？</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">单线程是先执行完第一个报表，用了<span style="font-family:Times New Roman">6</span><span style="font-family:宋体">分钟，再执行第二个报表，也用</span><span style="font-family:Times New Roman">6</span><span style="font-family:宋体">分钟。</span></span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">多线程，是<span style="font-family:Times New Roman">10</span><span style="font-family:宋体">个报表一起执行，但是每一个报表都要</span><span style="font-family:Times New Roman">1</span><span style="font-family:宋体">个小时。</span></span></p><p style="line-height:29px"><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">&nbsp;</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">同一个线程，比如说一个<span style="font-family:Times New Roman">servlet</span><span style="font-family:宋体">，一个人去访问，执行它，只需要</span><span style="font-family:Times New Roman">2</span><span style="font-family:宋体">秒。</span></span></p><p style="line-height:29px"><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">&nbsp;</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">如果两个人同时去访问，可能就要<span style="font-family:Times New Roman">4</span><span style="font-family:宋体">秒。如果</span><span style="font-family:Times New Roman">10</span><span style="font-family:宋体">个人同时去访问，那么每个人就要</span></span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">等待<span style="font-family:Times New Roman">20</span><span style="font-family:宋体">秒。就是说它基本上是一个成倍的线性增长。</span></span></p><p style="line-height:29px"><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">&nbsp;</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">一个线程占<span style="font-family:Times New Roman">2%</span><span style="font-family:宋体">的</span><span style="font-family:Times New Roman">CPU</span><span style="font-family:宋体">，那是不是</span><span style="font-family:Times New Roman">50</span><span style="font-family:宋体">个线程就占</span><span style="font-family:Times New Roman">100%</span><span style="font-family:宋体">的</span><span style="font-family:Times New Roman">CPU</span><span style="font-family:宋体">？不是。</span></span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">50<span style="font-family:宋体">个线程仍然占</span><span style="font-family:Times New Roman">2%</span><span style="font-family:宋体">的</span><span style="font-family:Times New Roman">CPU</span><span style="font-family:宋体">，分配</span><span style="font-family:Times New Roman">CPU</span><span style="font-family:宋体">资源的单位是进程，而不是线程。</span></span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">所以说线程是无法加快执行速度的</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">多线程的总体执行时间和单线程是一样的，但是多线程单个线程的执行时间</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">是单线程的多倍。</span></p><p style="line-height:29px"><strong><span style=";font-family:宋体;font-size:19px">我这里有一组数据，我有两个任务，如果是单线程。</span></strong></p><p style="line-height:29px"><strong><span style=";font-family:宋体;font-size:19px">先执行任务<span style="font-family:Times New Roman">1</span><span style="font-family:宋体">，再执行任务</span><span style="font-family:Times New Roman">2</span><span style="font-family:宋体">，一共用了</span><span style="font-family:Times New Roman">80</span><span style="font-family:宋体">秒钟，每个任务花费</span><span style="font-family:Times New Roman">40</span><span style="font-family:宋体">秒</span></span></strong></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">如果我<strong>用<span style="font-family:Times New Roman">2</span><span style="font-family:宋体">个线程同时跑，一共也用了</span><span style="font-family:Times New Roman">80</span><span style="font-family:宋体">秒，但是每个任务都花费</span><span style="font-family:Times New Roman">80</span><span style="font-family:宋体">秒</span></strong></span><span class="Apple-style-span" style="font-family: 宋体; font-size: 19px; ">（也就是说在最后一刻的时候，两个任务几乎是同时完成）。</span></p><p style="line-height:29px"><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">&nbsp;</span></p><p style="line-height:29px"><span style=";font-family:宋体;font-size:19px">附：以下两组数据是单线程和多线程耗时的对比（<span style="font-family:Times New Roman">win7</span><span style="font-family:宋体">系统、笔记本i7 CPU）。</span></span></p><p style="line-height:29px"><span style="font-family:宋体"><span class="Apple-style-span" style="font-size: 19px;"></span></span></p><p style="line-height:29px"><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">&nbsp;</span><span class="Apple-style-span" style="font-family: 宋体; font-size: 19px; ">单位：毫秒</span></p><table width="467"><tbody><tr class="firstRow"><td width="92" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:宋体;font-size:19px">编号</span></p></td><td width="98" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:宋体;font-size:19px">单线程<span style="font-family:Times New Roman">1</span></span></p></td><td width="108" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:宋体;font-size:19px">单线程<span style="font-family:Times New Roman">2</span></span></p></td><td width="169" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:宋体;font-size:19px">2<span style="font-family:宋体">个线程同时运行</span></span></p></td></tr><tr><td width="92" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-top-width: initial; border-top-color: initial; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:宋体;font-size:19px">测试<span style="font-family:Times New Roman">1</span></span></p></td><td width="98" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-top-width: initial; border-top-color: initial; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">81284</span></p></td><td width="108" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-top-width: initial; border-top-color: initial; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">81020</span></p></td><td width="169" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-top-width: initial; border-top-color: initial; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">155373</span></p></td></tr><tr><td width="92" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-top-width: initial; border-top-color: initial; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:宋体;font-size:19px">测试<span style="font-family:Times New Roman">2</span></span></p></td><td width="98" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-top-width: initial; border-top-color: initial; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">79601</span></p></td><td width="108" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-top-width: initial; border-top-color: initial; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">78405</span></p></td><td width="169" valign="top" style="padding-top: 0px; padding-right: 7px; padding-bottom: 0px; padding-left: 7px; border-left-style: none; border-left-width: initial; border-left-color: initial; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-top-width: initial; border-top-color: initial; border-bottom-width: 1px; border-bottom-color: windowtext; "><p><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">154144</span></p></td></tr></tbody></table><p style="line-height:29px"><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px">&nbsp;</span></p><p style="line-height:29px"><span class="Apple-style-span" style="font-family: 宋体; font-size: 19px; ">从上面数据可见，</span><strong style="font-family: 宋体; font-size: 19px; "><span style="font-family:Times New Roman">2</span>个线程同时运行的时间，几乎等于线程<span style="font-family:Times New Roman">1+</span>线程<span style="font-family:Times New Roman">2</span>单独运行的时间</strong><span style="font-family: 宋体; font-size: 19px; ">。所以说多线程实际上总时间没变，但是单个任务的执行时间延长了。</span><br/><span style=";font-family:&#39;Times New Roman&#39;;font-size:19px"></span></p><p><br/></p><p><br/></p>