---
layout: ue
title: Hibernate学习和使用笔记
category: JavaEE服务器端开发
tags: Hibernate
keywords: "Hibernate"
---

<p><strong><span style="font-family: 宋体; color: rgb(0, 32, 96); font-size: 20px; ">一、学习<span style="font-family: &#39;Times New Roman&#39;; ">Hibernate</span>的官方<span style="font-family: &#39;Times New Roman&#39;; ">Reference</span>文档</span></strong><br/></p><p><span style="font-family: &#39;Courier New&#39;; font-size: 14px; line-height: 25px; "><br/></span></p><p><span style="font-size:16px;">从<span style="font-family:Courier New">3.6</span><span style="font-family:宋体">版本之后，</span><span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">的</span><span style="font-family:Courier New">xml</span><span style="font-family:宋体">推荐使用如下的声明</span></span></p><p><img src="http://ires.qiniudn.com/my/img/20150722/wps1EA.tmp.jpg" title="wps1EA.tmp.jpg"/><span style="font-size:16px;">&nbsp;</span></p><p><span style="font-size:16px;">即，用</span></p><p><span style="font-family: &#39;Courier New&#39;; color: rgb(0, 32, 96); font-size: 16px; ">http://www.hibernate.org/dtd/</span></p><p><span style="font-size:16px;">替换原来<span style="font-family:Courier New">sourceforge</span><span style="font-family:宋体">那种格式。</span></span></p><p><span style="font-size:16px;">&nbsp;</span></p><p><span style="font-size:16px;">以前<span style="font-family:Courier New">C3P0</span><span style="font-family:宋体">驱动是如下配置的：</span></span></p><p><img src="http://ires.qiniudn.com/my/img/20150722/wps1EB.tmp.jpg" title="wps1EB.tmp.jpg"/><span style="font-size:16px;">&nbsp;</span></p><p><span style="font-size:16px;">在新版本中应该用如下配置：</span></p><p><span style="font-family: &#39;Courier New&#39;; color: rgb(0, 32, 96); font-size: 16px; ">org.hibernate.service.jdbc.connections.internal.C3P0ConnectionProvider</span></p><p><span style="font-size: 16px; line-height: 28px; "><br/></span></p><p><span style="font-size:16px;">Hibernate<span style="font-family:宋体">官方文档从一开始就开始介绍</span><span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">是和</span></span><span style="font-size:16px;;background:rgb(255,255,0);background:rgb(255,255,0)">JBoss</span><span style="font-size:16px;">数据库结合在一起的，<span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">的</span><span style="font-family:Courier New">required</span><span style="font-family:宋体">包里面就有两个是</span><span style="font-family:Courier New">JBoss</span><span style="font-family:宋体">相关的。</span></span></p><p><span style=";font-family:&#39;Courier New&#39;;font-size:14px">&nbsp;</span><img src="http://ires.qiniudn.com/my/img/20150722/wps1EC.tmp.jpg" title="wps1EC.tmp.jpg"/></p><p><span style="font-size:16px;">同时它一开始就讲到，<span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">是用</span></span><span style="font-size:16px;;background:rgb(255,255,0);background:rgb(255,255,0)">Maven</span><span style="font-size:16px;">来管理的（<span style="font-family:Courier New">JBoss&nbsp;Maven&nbsp;repository</span><span style="font-family:宋体">）。</span></span></p><p><span style="font-family: &#39;Courier New&#39;; font-size: 14px; line-height: 25px; "><br/></span></p><p><span style="font-size:16px;">Hibernate<span style="font-family:宋体">的</span><span style="font-family:Courier New">jar</span><span style="font-family:宋体">包目录如下</span></span></p><p><span style=";font-family:&#39;Courier New&#39;;font-size:14px">&nbsp;</span><img src="http://ires.qiniudn.com/my/img/20150722/wps1ED.tmp.jpg" title="wps1ED.tmp.jpg"/></p><p><span style="font-size:16px;">其中<span style="font-family:Courier New">required</span><span style="font-family:宋体">里面包括</span></span></p><p><span style=";font-family:&#39;Courier New&#39;;font-size:14px">&nbsp;</span><img src="http://ires.qiniudn.com/my/img/20150722/wps1EE.tmp.jpg" title="wps1EE.tmp.jpg"/></p><p><span style="font-size:16px;">除了<span style="font-family:Courier New">required</span><span style="font-family:宋体">目录下的</span><span style="font-family:Courier New">jar</span><span style="font-family:宋体">，还有</span><span style="font-family:Courier New">jpa</span><span style="font-family:宋体">目录下的</span><span style="font-family:Courier New">jar</span><span style="font-family:宋体">以及</span><span style="font-family:Courier New">optional</span><span style="font-family:宋体">里面的</span><span style="font-family:Courier New">c3p0</span><span style="font-family:宋体">和</span><span style="font-family:Courier New">ehcache</span><span style="font-family:宋体">都是常用的。</span></span></p><p><span style=";font-family:&#39;Courier New&#39;;font-size:14px">&nbsp;</span></p><p><span style="font-size:16px;">关于数据库方言（<span style="font-family:Courier New">dialect</span><span style="font-family:宋体">）的配置，</span><span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">官方文档是这样说的：</span></span></p><p><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">In&nbsp;most&nbsp;cases,&nbsp;Hibernate&nbsp;is&nbsp;able&nbsp;to&nbsp;properly&nbsp;determine&nbsp;which&nbsp;dialect&nbsp;to&nbsp;use.&nbsp;This&nbsp;is&nbsp;particularly&nbsp;useful&nbsp;if&nbsp;your&nbsp;application&nbsp;targets&nbsp;multiple&nbsp;databases.</span></p><p><span style="font-size:16px;">也就是说如果不是多数据库，就可以不配置<span style="font-family:Courier New">dialect</span><span style="font-family:宋体">。</span></span></p><p><span style="font-family: &#39;Courier New&#39;; font-size: 14px; line-height: 25px; "><br/></span></p><p><span style="font-size:16px;">关于实体（<span style="font-family:Courier New">Entity</span><span style="font-family:宋体">）的定义，用标准的</span><span style="font-family:Courier New">JavaBean</span><span style="font-family:宋体">，建议将其属性（</span><span style="font-family:Courier New">fields</span><span style="font-family:宋体">）设置为私有（</span><span style="font-family:Courier New">private</span><span style="font-family:宋体">）的。要有</span><span style="font-family:Courier New">setter</span><span style="font-family:宋体">和</span><span style="font-family:Courier New">getter</span><span style="font-family:宋体">方法，构造函数必须是无参（</span><span style="font-family:Courier New">no-argument</span><span style="font-family:宋体">）的，而且建议设置为</span><span style="font-family:Courier New">public</span><span style="font-family:宋体">的。</span><span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">会用</span><span style="font-family:Courier New">Java&nbsp;Reflection</span><span style="font-family:宋体">去为你</span><span style="font-family:Courier New">create&nbsp;objects</span><span style="font-family:宋体">。</span><span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">会自动到</span><span style="font-family:Courier New">classpath</span><span style="font-family:宋体">下去找</span><span style="font-family:Courier New">Event.hbm.xml</span><span style="font-family:宋体">定义文件。</span></span></p><p><span style="font-size:16px;">实体的<span style="font-family:Courier New">hbm.xml</span><span style="font-family:宋体">文件定义格式如下：</span></span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;class&nbsp;name=&quot;Event&quot;&nbsp;table=&quot;EVENTS&quot;&gt;</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;...</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;/class&gt;</span></p><p><span style="font-size:16px;">class<span style="font-family:宋体">中，</span><span style="font-family:Courier New">name</span><span style="font-family:宋体">和</span><span style="font-family:Courier New">table</span><span style="font-family:宋体">对应。</span></span></p><p><span style=";font-family:&#39;Courier New&#39;;font-size:14px">&nbsp;</span></p><p><span style="font-size:16px;">然后用<span style="font-family:Courier New">id</span><span style="font-family:宋体">定义数据表的主键：</span></span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;id&nbsp;name=&quot;id&quot;&nbsp;column=&quot;EVENT_ID&quot;&gt;</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;...</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;/id&gt;</span></p><p><span style="font-size:16px;">主键不是必须的，但是<span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">强烈的要求你使用主键。（</span><span style="font-family:Courier New">it&nbsp;is&nbsp;strongly&nbsp;recommend&nbsp;that&nbsp;all&nbsp;schemas&nbsp;define&nbsp;proper&nbsp;referential&nbsp;integrity</span><span style="font-family:宋体">）</span></span></p><p><span style="font-size:16px;">可以用<span style="font-family:Courier New">generator</span><span style="font-family:宋体">定义主键的生成策略。例如：</span></span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;id&nbsp;name=&quot;id&quot;&nbsp;type=&quot;java.lang.Integer&quot;&gt;</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;column&nbsp;name=&quot;id&quot;&nbsp;/&gt;</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;generator&nbsp;class=&quot;identity&quot;&nbsp;/&gt;</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;/id&gt;</span></p><p><span style="font-family: &#39;Courier New&#39;; font-size: 14px; line-height: 25px; "><br/></span></p><p><span style="font-size:16px;">用<span style="font-family:Courier New">property</span><span style="font-family:宋体">定义</span><span style="font-family:Courier New">table</span><span style="font-family:宋体">的其他字段。例如：</span></span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;property&nbsp;name=&quot;date&quot;&nbsp;type=&quot;timestamp&quot;&nbsp;column=&quot;EVENT_DATE&quot;/&gt;</span></p><p style="line-height: normal; "><span style="font-family: &#39;Courier New&#39;; font-size: 16px; ">&lt;property&nbsp;name=&quot;title&quot;/&gt;</span></p><p><span style="font-size:16px;">第二个<span style="font-family:Courier New">property</span><span style="font-family:宋体">没有指定</span><span style="font-family:Courier New">column</span><span style="font-family:宋体">，那么</span><span style="font-family:Courier New">name</span><span style="font-family:宋体">就会被看作是默认的</span><span style="font-family:Courier New">column</span><span style="font-family:宋体">。同时注意到第一个</span><span style="font-family:Courier New">property</span><span style="font-family:宋体">，由于其</span><span style="font-family:Courier New">name</span><span style="font-family:宋体">的值（</span><span style="font-family:Courier New">date</span><span style="font-family:宋体">）在很多数据库中是一个关键字，所以此时</span><span style="font-family:Courier New">column</span><span style="font-family:宋体">是不能省略的。</span></span></p><p><span style="font-size:16px;">注意到<span style="font-family:Courier New">property</span><span style="font-family:宋体">中有一个属性为</span><span style="font-family:Courier New">type</span><span style="font-family:宋体">，它既不是</span><span style="font-family:Courier New">Java</span><span style="font-family:宋体">数据类型，也不是</span><span style="font-family:Courier New">SQL</span><span style="font-family:宋体">数据库类型，</span></span></p><p><span style="font-size:16px;">而是<span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">映射类型（</span><span style="font-family:Courier New">The&nbsp;types&nbsp;declared&nbsp;and&nbsp;used&nbsp;in&nbsp;the&nbsp;mapping&nbsp;files&nbsp;are&nbsp;neither&nbsp;Java&nbsp;data&nbsp;types&nbsp;nor&nbsp;SQL&nbsp;database&nbsp;types.&nbsp;Instead,&nbsp;they&nbsp;are&nbsp;<strong>Hibernate&nbsp;mapping&nbsp;types</strong></span><span style="font-family:宋体">）。</span></span></p><p><span style="font-size:16px;">如果不指定这个类型，<span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">将根据</span><span style="font-family:Courier New">Java</span><span style="font-family:宋体">反射自动决定（</span><span style="font-family:Courier New">if&nbsp;the&nbsp;type&nbsp;attribute&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;mapping,&nbsp;by&nbsp;using&nbsp;Java&nbsp;reflection&nbsp;to&nbsp;determine&nbsp;the&nbsp;Java&nbsp;type&nbsp;of&nbsp;the&nbsp;declared&nbsp;property&nbsp;and&nbsp;using&nbsp;a&nbsp;default&nbsp;mapping&nbsp;type&nbsp;for&nbsp;that&nbsp;Java&nbsp;type</span><span style="font-family:宋体">）。</span></span></p><p><span style="font-size:16px;">注意到上面的<span style="font-family:Courier New">type=timestamp</span><span style="font-family:宋体">，这个</span><span style="font-family:Courier New">timestamp</span><span style="font-family:宋体">就是</span><span style="font-family:Courier New">Hibernate</span><span style="font-family:宋体">定义的映射类型（</span><span style="font-family:Courier New">Hibernate&nbsp;cannot&nbsp;know&nbsp;if&nbsp;the&nbsp;property</span></span><span style=";font-family:&#39;Courier New&#39;;font-size:14px">,&nbsp;which&nbsp;is&nbsp;of&nbsp;type&nbsp;java.util.Date,&nbsp;should&nbsp;map&nbsp;to&nbsp;a&nbsp;SQL&nbsp;DATE,&nbsp;TIME,&nbsp;or&nbsp;TIMESTAMP&nbsp;datatype.&nbsp;Full&nbsp;date&nbsp;and&nbsp;time&nbsp;information&nbsp;is&nbsp;preserved&nbsp;by&nbsp;mapping&nbsp;the&nbsp;property&nbsp;to&nbsp;a&nbsp;timestamp&nbsp;converter,&nbsp;which&nbsp;identifies&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;class&nbsp;org.hibernate.type.TimestampTy</span><span style="font-size:16px;">pe<span style="font-family:宋体">）。</span></span></p><p><br/></p><p><br/></p><p style="white-space: normal; "><span style="font-size: 20px; ">二、Hibernate及Hibernate与&nbsp;Struts 2&nbsp;的整合</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">Hibernate的主要作用是操作数据库的，一方面方便建立数据库的连接，另一方面把关系数据映射成面向对象的数据，通过HQL来操作数据库的增删查改。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">首先把Hibernate需要的jar文件hibernate3.jar拷贝到WEB-INF/lib目录下。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">然后配置Hibernate，使其能够连接数据库。在没有使用Spring框架时，Hibernate的配置文件就放在/src文件夹下，命名为hibernate.cfg.xml，内容示例如下：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-family: Consolas; color: teal; ">&lt;!</span><span style="font-family: Consolas; color: rgb(63, 127, 127); ">DOCTYPE</span><span style="font-family: Consolas; ">&nbsp;<span style="color: teal; ">hibernate-configuration</span>&nbsp;<span style="color: gray; ">PUBLIC</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: Consolas; font-size: 16px; color: teal; ">&quot;-//Hibernate/Hibernate Configuration DTD 3.0//EN&quot;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: Consolas; font-size: 16px; color: rgb(63, 127, 95); ">&quot;http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd&quot;</span><span style="font-family: Consolas; font-size: 16px; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">hibernate-configuration</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">session-factory</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!--&nbsp;</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">数据</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">库连</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">接</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">URL --&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;connection.url&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jdbc:mysql://localhost/javaweb</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!--&nbsp;</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">数据</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">库连</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">接</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">驱动</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;connection.driver_class&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; com.mysql.jdbc.Driver</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!--&nbsp;</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">数据</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">库</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">用</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">户</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">名</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;connection.username&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;</span>root<span style="font-size: 16px; color: teal; ">&lt;/</span><span style="font-size: 16px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!--&nbsp;</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">数据</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">库</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">用</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">户</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">密</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">码</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;connection.password&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;</span>admin<span style="font-size: 16px; color: teal; ">&lt;/</span><span style="font-size: 16px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!--&nbsp;</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">数据</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">库</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">方言</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;dialect&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; org.hibernate.dialect.MySQLDialect</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!--&nbsp;</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">指定映射文件</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">mapping</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">resource</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;com/javaweb/po/Product.hbm.xml&quot;</span></i><span style="font-size: 16px; color: teal; ">/&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">session-factory</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">hibernate-configuration</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">如果使用了Spring框架，则不需要这个文件，直接交由Spring托管，在Spring的配置文件\WebRoot\WEB-INF\applicationContext.xml中配置类似的内容。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">配置好后，就可以使用了。假如有一个数据文件User.java，里面定义id，name等数据，这时要把这些数据映射成面向对象的，只需要在User.java的同级目录下建立一个User.hbm.xml文件，内容示例如下：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-family: Consolas; color: teal; ">&lt;?</span><span style="font-family: Consolas; color: rgb(63, 127, 127); ">xml</span><span style="font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">version</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;1.0&quot;</span></i><span style="color: teal; ">?&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;!</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">DOCTYPE</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: teal; ">hibernate-mapping</span>&nbsp;<span style="font-size: 16px; color: gray; ">PUBLIC</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: Consolas; font-size: 16px; color: teal; ">&quot;-//Hibernate/Hibernate Mapping DTD 3.0//EN&quot;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: Consolas; font-size: 16px; color: rgb(63, 127, 95); ">&quot;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&quot;</span><span style="font-family: Consolas; font-size: 16px; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">hibernate-mapping</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!--&nbsp;</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">每个</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">class</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">对应</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">一个持久化</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">对</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">象</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">class</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;com.javaweb.po.User&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!-- id</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">元素用来定</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">义</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">主</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">键标识</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">,</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">并指定主</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">键</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">自</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">动递</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">增</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">id</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;id&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">generator</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">class</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;identity&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;&lt;/</span><span style="font-size: 16px; color: rgb(63, 127, 127); ">generator</span><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">id</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!--&nbsp;</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">定</span><span style="font-size: 16px; font-family: 宋体; color: rgb(63, 95, 191); ">义</span><span style="font-size: 16px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">其他属性</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;username&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;&lt;/</span><span style="font-size: 16px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;password&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;&lt;/</span><span style="font-size: 16px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;age&quot;</span></i>&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">type</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;int&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;&lt;/</span><span style="font-size: 16px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;birth&quot;</span></i>&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">type</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;date&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;&lt;/</span><span style="font-size: 16px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="font-size: 16px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;email&quot;</span></i><span style="font-size: 16px; color: teal; ">&gt;&lt;/</span><span style="font-size: 16px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 16px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">class</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">hibernate-mapping</span><span style="font-size: 16px; font-family: Consolas; color: teal; ">&gt;</span></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">此时配置便完成了，在其他java文件中引入相应的Hibernate类文件，就可以以面向对象的方式使用数据了。例如，通常引用到的为</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">import org.hibernate.Session;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">import org.hibernate.SessionFactory;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">import org.hibernate.cfg.Configuration;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">import org.hibernate.Query;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">import org.hibernate.Session;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">等等，非常多，而如果每个java文件都要引用的话就显得非常累赘，所以通常把一些基础数据库操作封装在HibernateUtil.java文件中。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">如果使用了Spring框架，则不需要引入这么多文件，在Spring框架中，直接使用dao文件就可以了，在dao文件中引入如下Spring的hibernate3.suppor.HibernateDaoSupport即可：</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">import org.springframework.orm.hibernate3.support.HibernateDaoSupport;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">Hibernate与&nbsp;Struts 2&nbsp;的整合其实没什么可讲的，就是简单的把两个的功能叠加在一起，类似于1+1=2。Hibernate负责DAO操作，DAO通常分为3个部分，DAO接口，DAO实现类，DAO工厂类，接口就是声明一些方法，例如delete，实现类利用Hibernate的方式去实现这个方法，而工厂类就是简单的new一个实现类再返回，工厂类示例如下：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><strong><span style="font-family: Consolas; color: rgb(127, 0, 85); ">package</span></strong><span style="font-family: Consolas; ">&nbsp;com.javaweb.factory;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><strong><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 85); ">import</span></strong><span style="font-size: 16px; font-family: Consolas; ">&nbsp;com.javaweb.dao.ProductDao;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><strong><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 85); ">import</span></strong><span style="font-size: 16px; font-family: Consolas; ">&nbsp;com.javaweb.dao.ProductDaoImpl;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><strong><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 85); ">public</span></strong>&nbsp;<strong><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 85); ">class</span></strong><span style="font-size: 16px; font-family: Consolas; ">&nbsp;DaoFactory {</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 85); ">public</span></strong>&nbsp;<strong><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 85); ">static</span></strong><span style="font-size: 16px; font-family: Consolas; ">&nbsp;ProductDao getDaoInstance(){</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; "><span style="font-size: 16px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 85); ">return</span></strong>&nbsp;<strong><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 85); ">new</span></strong><span style="font-size: 16px; font-family: Consolas; ">&nbsp;ProductDaoImpl();</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">&nbsp;&nbsp;&nbsp; }</span></p><p style="white-space: normal; line-height: normal; "><span style="font-family: Consolas; font-size: 16px; ">}</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">仅在有很多个DAO的实现类时才能体现工厂类的作用，因为工厂类把这些实现类都封装在了一个DaoFactory类里面，只需要调用不同的方法即可new一个不同的实现类。</span></p><p><br/></p><p style="white-space: normal; "><span style="font-size: 18px; ">Hibernate的配置之Configuration对象和SessionFactory对象</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">通常写在<strong>HibernateSessionFactory.java</strong>中：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">private static org.hibernate.cfg.Configuration configuration = new Configuration();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">private static org.hibernate.SessionFactory sessionFactory;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">private static String configFile = &quot;/hibernate.cfg.xml;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">configuration.configure(configFile);</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">sessionFactory = configuration.buildSessionFactory();</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">创建Session:</span></p><p style="white-space: normal; text-indent: 32px; line-height: normal; "><span style="font-size: 16px; ">Session session1 = sessionFactory.openSession() ; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">&nbsp; &nbsp; &nbsp; //&nbsp; Session session2 = sessionFactory.getCurrentSession() ;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">官方的写法:</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">public</span></strong>&nbsp;<strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">static</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;Session getSession()&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">throws</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;HibernateException {</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Session session = (Session)&nbsp;</span><i><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">threadLocal</span></i><span style="font-size: 14px; font-family: Consolas; ">.get();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">if</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;(session ==&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">null</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;|| !session.isOpen()) {</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">if</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;(</span><i><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); ">sessionFactory</span></i><span style="font-size: 14px; font-family: Consolas; ">&nbsp;==&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">null</span></strong><span style="font-size: 14px; font-family: Consolas; ">) {</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>rebuildSessionFactory</i>();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; session = (</span><i><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); ">sessionFactory</span></i><span style="font-size: 14px; font-family: Consolas; ">&nbsp;!=&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">null</span></strong><span style="font-size: 14px; font-family: Consolas; ">) ?&nbsp;</span><i><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); ">sessionFactory</span></i><span style="font-size: 14px; font-family: Consolas; ">.openSession()</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">null</span></strong><span style="font-size: 14px; font-family: Consolas; ">;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><i><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">threadLocal</span></i><span style="font-size: 14px; font-family: Consolas; ">.set(session);</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">return</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;session;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp; }</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">Transaction的用法：</span></p><p style="white-space: normal; "><span style="font-size: 16px; text-indent: 48px; font-family: 宋体; ">&nbsp; &nbsp;</span><span style="font-size: 16px; line-height: normal; text-indent: 48px; ">Transaction trans = session1.beginTransaction();</span></p><p style="white-space: normal; "><span style="font-size: 16px; line-height: normal; text-indent: 48px; ">&nbsp; &nbsp; &nbsp; &nbsp;trans.begin();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trans.commit();</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">遇到异常：</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trans.rollback();</span></p><p style="white-space: normal; "><span style="font-size:16px"><br/></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">持久化状态：</span></p><p style="white-space: normal; "><span class="Apple-style-span" style="font-size: 16px; ">&nbsp; &nbsp; &nbsp;</span><span class="Apple-style-span" style="font-size: 16px; line-height: normal; ">session1.save(obj); &nbsp; &nbsp;//可使对象由临时状态，转换成持久化状态。</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">&nbsp; &nbsp; &nbsp;session1.delete(); &nbsp; &nbsp;//同上相反，把对象欢迎成临时状态</span></p><p style="white-space: normal; line-height: normal; "><span class="Apple-style-span" style="font-size: 16px; ">&nbsp; &nbsp; &nbsp;session1.close(); &nbsp; &nbsp;//可使持久化状态称为游离状态。</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">&nbsp; &nbsp; &nbsp;session1.update(); &nbsp; &nbsp;//同上相反，可使游离状态变成持久化状态。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; "><br/></span></p><p style="white-space: normal; "><span style="font-size: 20px; "><strong><span style="font-family: 宋体; ">三、Hibernate</span></strong><strong><span style="font-family: 宋体; ">缓存</span></strong></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 18px; "><strong>一级缓存</strong></span><span style="font-size: 16px; ">是session类的缓存，是自动缓存的，无需配置。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">对于一级缓存：</span></p><p style="margin-left: 48px; white-space: normal; "><span style="font-size: 16px; ">（1）save、update、saveOrupdate、load、get、list、iterate、lock方法都会向缓存中存对象.</span></p><p style="margin-left: 48px; white-space: normal; "><span style="font-size: 16px; ">（2）可以从缓存中读数据的只有：&nbsp;get、load、iterate</span></p><p style="margin-left: 48px; white-space: normal; "><span style="font-size: 16px; ">（3）Query对象默认情况下不读缓存，如果要使其支持缓存（也就是new两个相同的Query时，第二次不再去执行sql语句），则要通过语法：&nbsp;</span><span class="Apple-style-span" style="font-size: 16px; line-height: 28px; ">query.setCacheable(true)；（并且要在hibernate.cfg.xml中配置：</span></p><p style="white-space: normal; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">property</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;hibernate.cache.use_query_cache&quot;</span></i><span style="color: teal; ">&gt;</span>true<span style="color: teal; ">&lt;/</span><span style="color: rgb(63, 127, 127); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">property</span><span style="color: teal; ">&gt;</span></span><span style="font-size: 16px; ">）</span></p><p style="white-space: normal; "><span style="font-size: 16px; "><br/></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">PS：list方法好像有点怪，其存入缓存中的数据无法clear？</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">注意事项：</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 16px; ">1.Session&nbsp;级别的缓存，它同session邦定。它的生命周期和session相同。Session消毁，它也同时消毁；管理一级缓存，一级缓存无法取消，用两个方法管理，clear(),evict()</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 16px; ">2.两个session&nbsp;不能共享一级缓存，因它会伴随session的生命周期的创建和消毁；</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 16px; ">3.Session缓存是实体级别的缓存</span>&nbsp;<span style="font-size: 16px; ">，就是只有在查询对象级别的时候才使用</span>&nbsp;<span style="font-size: 16px; ">，如果使用HQL和SQL是查询属性级别</span>&nbsp;<span style="font-size: 16px; ">的，是不使用一级缓存的！切记！！！！</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">查询单个对象的两种方法：</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 14px; font-family: Consolas; ">User&nbsp;<span style="text-decoration: underline; ">user1</span>&nbsp;= (User) session.load(User.</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">class</span></strong><span style="font-size: 14px; font-family: Consolas; ">, 1);</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 14px; font-family: Consolas; ">User&nbsp;<span style="text-decoration: underline; ">user2</span>&nbsp;= (User) session.<span style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">get</span>(User.</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">class</span></strong><span style="font-size: 14px; font-family: Consolas; ">, 53);</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">前一种load的时候不会执行sql语句，user1是空对象，只有用到user1时才会去查询，第二种get方法，就是直接查询，把结果赋值给user2。两种方式都会一级缓存。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">查询多个对象时，有两种方法：</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">第一种（List方法）：</span></p><p style="white-space: normal; "><span style="text-indent: 48px; line-height: 28.7999992370605px; font-family: 宋体; font-size: 14px; ">&nbsp; &nbsp;&nbsp;</span><span style="line-height: normal; text-indent: 48px; font-size: 14px; font-family: Consolas; ">List&lt;User&gt; list =&nbsp;<span style="text-decoration: underline; ">query.list()</span>;</span><a style="background-color: rgb(199, 237, 204); line-height: normal; text-indent: 48px; " name="OLE_LINK4"></a><a style="background-color: rgb(199, 237, 204); line-height: normal; text-indent: 48px; " name="OLE_LINK3"></a><span style="line-height: normal; text-indent: 48px; font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">//</span><span style="line-height: normal; text-indent: 48px; font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">第</span><span style="line-height: normal; text-indent: 48px; font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">一次</span><span style="line-height: normal; text-indent: 48px; font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">查询</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list =&nbsp;<span style="text-decoration: underline; ">query.list()</span>;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">//</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">还</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">会去</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">查询</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">一次，但是将</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">结</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">果全部</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">缓</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">存到</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">list</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">中</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">for</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;(User user : list) {</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.</span><i><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); ">out</span></i><span style="font-size: 14px; font-family: Consolas; ">.<span style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">println</span>(user);</span>&nbsp;<span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">//</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">直接从缓存中取</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">第二种（Iterate方法）</span></p><p style="white-space: normal; line-height: normal; "><span style="text-indent: 48px; line-height: 28.7999992370605px; font-family: 宋体; font-size: 14px; ">&nbsp; &nbsp;&nbsp;</span><span style="text-indent: 48px; text-decoration: underline; font-size: 14px; font-family: Consolas; ">Iterator</span><span style="text-indent: 48px; font-size: 14px; font-family: Consolas; ">&nbsp;list = query.iterate();&nbsp;</span><span style="text-indent: 48px; font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">//</span><span style="text-indent: 48px; font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">只</span><span style="text-indent: 48px; font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">查询</span><span style="text-indent: 48px; font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">id</span><span style="text-indent: 48px; font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">，而不是把所有</span><span style="text-indent: 48px; font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">值</span><span style="text-indent: 48px; font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">都</span><span style="text-indent: 48px; font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">查</span><span style="text-indent: 48px; font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">出</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = query.iterate();&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">//</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">还</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">会去</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">查询</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">一次</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">id</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">while</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;(list.hasNext()) {</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.</span><i><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); ">out</span></i><span style="font-size: 14px; font-family: Consolas; ">.println(list.next());&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">//</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">每次都要用</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">sql</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">去</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">查询</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">指定</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 95); ">id</span><span style="font-size: 14px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">的</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 127, 95); ">记录</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">可以看出，其实iterate的效率很低，但是list占用内存较大。所以一般用list，并且数据量大时一定要配合用分页查询（否则不能用list）。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">另外注意，在增删改时涉及到事务(Transaction)，当事务没有commit时，所有的增删改的数据都是存在代理那里的，实际上这也是一种缓存。例如要save一千万个对象，那么肯定会塞满缓存，一般是每save二十个对象就flush+clear，然后再继续。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><br/></p><p style="white-space: normal; "><strong><span style="font-size: 18px; ">二级缓存</span></strong><span style="font-size: 16px; ">是sessionFactory下的缓存，各个session都共享缓存，需要配置插件。一般用hibernate自带的这个ehcache，需要引入下面这个包：</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">ehcache-1.2.3.jar</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">首先在</span><a name="OLE_LINK5"></a><span style="font-size: 16px; ">hibernate.cfg.xml中配置：</span></p><p style="margin-left: 13px; white-space: normal; line-height: normal; "><span style="font-size: 14px; "><span style="font-family: Consolas; color: teal; ">&lt;</span><span style="font-family: Consolas; color: rgb(63, 127, 127); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">property</span><span style="font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;hibernate.cache.provider_class&quot;</span></i><span style="color: teal; ">&gt;</span>org.hibernate.cache.EhCacheProvider<span style="color: teal; ">&lt;/</span><span style="color: rgb(63, 127, 127); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">property</span><span style="color: teal; ">&gt;</span></span></span></p><p style="margin-left: 13px; white-space: normal; line-height: normal; "><span style="font-size: 14px; "><span style="font-size: 12px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 12px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 12px; font-family: Consolas; ">&nbsp;<span style="font-size: 14px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 14px; color: rgb(42, 0, 255); ">&quot;hibernate.cache.use_second_level_cache&quot;</span></i><span style="font-size: 14px; color: teal; ">&gt;</span>true<span style="font-size: 14px; color: teal; ">&lt;/</span><span style="font-size: 14px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 14px; color: teal; ">&gt;</span></span></span></p><p style="margin-left: 13px; white-space: normal; line-height: normal; "><span style="font-size: 14px; "><span style="font-size: 12px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 12px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 12px; font-family: Consolas; ">&nbsp;<span style="font-size: 14px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 14px; color: rgb(42, 0, 255); ">&quot;hibernate.cache.use_query_cache&quot;</span></i><span style="font-size: 14px; color: teal; ">&gt;</span>true<span style="font-size: 14px; color: teal; ">&lt;/</span><span style="font-size: 14px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 14px; color: teal; ">&gt;</span></span></span></p><p style="margin-left: 13px; white-space: normal; line-height: normal; "><span style="font-size: 14px; "><span style="font-size: 12px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 12px; font-family: Consolas; color: rgb(63, 127, 127); ">property</span><span style="font-size: 12px; font-family: Consolas; ">&nbsp;<span style="font-size: 14px; color: rgb(127, 0, 127); ">name</span>=<i><span style="font-size: 14px; color: rgb(42, 0, 255); ">&quot;current_session_context_class&quot;</span></i><span style="font-size: 14px; color: teal; ">&gt;</span>thread<span style="font-size: 14px; color: teal; ">&lt;/</span><span style="font-size: 14px; color: rgb(63, 127, 127); ">property</span><span style="font-size: 14px; color: teal; ">&gt;</span></span></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">在src目录下新建ehcache.xml，这个是可选的，在这个文件中可以自定义cache的参数，例如下面的文件中自定义了一个name为userCache的配置：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;?</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">xml</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">version</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;1.0&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">encoding</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;UTF-8&quot;</span></i><span style="color: teal; ">?&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">ehcache</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">diskStore</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">path</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;java.io.tmdir&quot;</span></i><span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">defaultCache</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">maxElementsInMemory</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;10000&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">eternal</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;false&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">overflowToDisk</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;true&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">timeToIdleSeconds</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;300&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">timeToLiveSeconds</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;600&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">diskPersistent</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;false&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">memoryStoreEvictionPolicy</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;LRU&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">cache</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;userCache&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">maxElementsInMemory</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;5000&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">eternal</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;false&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">overflowToDisk</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;true&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">timeToIdleSeconds</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;300&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">timeToLiveSeconds</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;600&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">diskPersistent</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;false&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">memoryStoreEvictionPolicy</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;LRU&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">ehcache</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">可以为每个entity配置二级缓存：</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">比如在User.hbm.xml中，做如下设置：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">class</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;User&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">table</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;t_user&quot;</span></i><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;&lt;cache usage=&quot;nonstrict-read-write&quot; region=&quot;userCache&quot;/&gt;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">id</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;id&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">type</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;java.lang.Integer&quot;</span></i><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">column</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;id&quot;</span></i>&nbsp;<span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">generator</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">class</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;sequence&quot;</span></i><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">param</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;sequence&quot;</span></i><span style="color: teal; ">&gt;</span>SEQ_ID_ALL<span style="color: teal; ">&lt;/</span><span style="color: rgb(63, 127, 127); ">param</span><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">generator</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">id</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">那个cache标签即给User设置缓存，必须放在首位（紧跟class标签）,其属性region指定了缓存的配置，这里其值是userCache，对应ehcache中的配置。也可以在hibernate.cfg.xml中配置：</span></p><p style="white-space: normal; "><span style="font-size: 16px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">class-cache</span><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">usage</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;nonstrict-read-write&quot;</span></i>&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 127); ">region</span><span style="font-size: 16px; font-family: Consolas; ">=</span><i><span style="font-size: 16px; font-family: Consolas; color: rgb(42, 0, 255); ">&quot;</span></i><i><span style="font-size: 16px; font-family: Consolas; color: rgb(42, 0, 255); ">userCache</span></i><i><span style="font-size: 16px; font-family: Consolas; color: rgb(42, 0, 255); ">&quot;</span></i><span style="font-size: 16px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">class</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;com.travelsky.hibc.entity.User&quot;</span></i><span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">对于以上配置中的usage，有nonstrict-read-write，read-write，read-only和transactional四种，关于这四种事务隔离级别的描述如下：</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">　　事务型：仅仅在托管环境中适用。它提供了Repeatable Read事务隔离级别。对于经常被读但很少修改的数据，可以采用这种隔离类型，因为它可以防止脏读和不可重复读这类的并发问题。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;　　读写型：提供了Read Committed事务隔离级别。仅仅在非集群的环境中适用。对于经常被读但很少修改的数据，可以采用这种隔离类型，因为它可以防止脏读这类的并发问题。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;　　非严格读写型：不保证缓存与数据库中数据的一致性。如果存在两个事务同时访问缓存中相同数据的可能，必须为该数据配置一个很短的数据过期时间，从而尽量避免脏读。对于极少被修改，并且允许偶尔脏读的数据，可以采用这种并发访问策略。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;　　只读型：对于从来不会修改的数据，如参考数据，可以使用这种并发访问策略。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;　　事务型并发访问策略是事务隔离级别最高，只读型的隔离级别最低。事务隔离级别越高，并发性能就越低。（一般用“非严格读写型”甚至“只读型”）</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">使用方法（调用Query的setCacheable(true)方法），例如：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 12px; font-family: Consolas; color: rgb(127, 0, 85); ">public</span></strong>&nbsp;<strong><span style="font-size: 12px; font-family: Consolas; color: rgb(127, 0, 85); ">void</span></strong><span style="font-size: 12px; font-family: Consolas; ">&nbsp;QueryCache() {</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Session session1 = HibernateSessionFactory.<i>getSession</i>();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="text-decoration: underline; ">List</span>&nbsp;<span style="text-decoration: underline; ">list2</span>&nbsp;= session1.createQuery(</span><span style="font-size: 12px; font-family: Consolas; color: rgb(42, 0, 255); ">&quot;from User&quot;</span><span style="font-size: 12px; font-family: Consolas; ">).setCacheable(</span><strong><span style="font-size: 12px; font-family: Consolas; color: rgb(127, 0, 85); ">true</span></strong><span style="font-size: 12px; font-family: Consolas; ">).list();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; session1.close();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Session&nbsp;<span style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: yellow; ">session2</span>&nbsp;= HibernateSessionFactory.<i>getSession</i>();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; color: rgb(63, 127, 95); ">&nbsp; &nbsp; &nbsp; &nbsp; // User user2 = (User) session2.load(User.class, 22); //</span><span style="font-size: 12px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">不会</span><span style="font-size: 12px; font-family: 宋体; color: rgb(63, 127, 95); ">查询</span><span style="font-size: 12px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">，直接用</span><span style="font-size: 12px; font-family: Consolas; color: rgb(63, 127, 95); ">session1</span><span style="font-size: 12px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">的</span><span style="font-size: 12px; font-family: 宋体; color: rgb(63, 127, 95); ">缓</span><span style="font-size: 12px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">存</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="text-decoration: underline; ">List</span>&nbsp;<span style="text-decoration: underline; ">list3</span>&nbsp;=&nbsp;<span style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">session2</span>.createQuery(</span><span style="font-size: 12px; font-family: Consolas; color: rgb(42, 0, 255); ">&quot;from User&quot;</span><span style="font-size: 12px; font-family: Consolas; ">).setCacheable(</span><strong><span style="font-size: 12px; font-family: Consolas; color: rgb(127, 0, 85); ">true</span></strong><span style="font-size: 12px; font-family: Consolas; ">).list();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(211, 211, 211); ">session2</span>.close();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12px; font-family: Consolas; color: rgb(63, 127, 95); ">//&nbsp;</span><span style="font-size: 12px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">只</span><span style="font-size: 12px; font-family: 宋体; color: rgb(63, 127, 95); ">查询</span><span style="font-size: 12px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 127, 95); ">一遍</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 12px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp; }</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">在配置中的region属性可以不写，可以到程序中再指定：</span></p><p style="white-space: normal; text-indent: 48px; line-height: normal; "><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">List&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 127); ">list2</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">&nbsp;=&nbsp;</span><span style="font-size: 16px; font-family: Consolas; color: rgb(127, 0, 127); ">session1</span><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">.createQuery(</span><i><span style="font-size: 16px; font-family: Consolas; color: rgb(42, 0, 255); ">&quot;from User&quot;</span></i><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">)</span></p><p style="margin-left: 48px; white-space: normal; text-indent: 48px; line-height: normal; "><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">.setCacheable(</span><i><span style="font-size: 16px; font-family: Consolas; color: rgb(42, 0, 255); ">true</span></i><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">).setCacheRegion(</span><i><span style="font-size: 16px; font-family: Consolas; color: rgb(42, 0, 255); ">&quot;userCache&quot;</span></i><span style="font-size: 16px; font-family: Consolas; color: rgb(63, 127, 127); ">).list();</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 20px; "><strong><span style="font-family: 宋体; ">四、Hibernate</span></strong><strong><span style="font-family: 宋体; ">锁，悲观锁（Pessimistic），乐观锁（Optimistic）</span></strong></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span class="Apple-style-span" style="font-size: 16px; line-height: 28px; ">悲观锁：本次事务提交之前（事务提交时会释放事务过程中的锁），外界无法修改这些记录。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span><span class="Apple-style-span" style="font-size: 16px; line-height: 28px; ">其实现方法是转换成数据库的锁来实现的，例如：</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 16px; ">select * from account where name=&#39;zollty&#39; for update</span></p><p style="white-space: normal; "><span style="font-size:16px"><span class="Apple-style-span" style="line-height: 28px;"><br/></span></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">Hibernate的加锁模式有多种，我们常用的是：</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 16px; ">LockMode.UPGRADE：利用数据库的for update子句加锁。</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 16px; ">LockMode.UPGRADE_NOWAIT：Oracle的特定实现，利用Oracle的for update nowait子句实现加锁。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">加锁一般通过以下方法实现：</span></p><p style="margin-left: 53px; white-space: normal; line-height: normal; "><span style="font-size: 16px; ">Criteria.setLockMode</span></p><p style="margin-left: 53px; white-space: normal; line-height: normal; "><span style="font-size: 16px; ">Query.setLockMode</span></p><p style="margin-left: 53px; white-space: normal; line-height: normal; "><span style="font-size: 16px; ">Session.lock</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">悲观锁的实现（for update）：</span></p><p style="white-space: normal; "><span style="font-size: 16px; color: rgb(63, 127, 95); ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //也就是在执行数据库select语句时跟上for update</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query.setLockMode(</span><span style="font-size: 16px; color: rgb(42, 0, 255); ">&quot;user&quot;</span><span style="font-size: 16px; ">, LockMode.</span><i><span style="font-size: 16px; color: rgb(0, 0, 192); ">UPGRADE</span></i><span style="font-size: 16px; ">);</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 16px; color: rgb(63, 95, 191); ">/**</span></p><p style="white-space: normal; "><span style="font-size: 14px; color: rgb(63, 95, 191); ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">当有</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">LOCK</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">冲突时会提示错误并结束</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">STATEMENT</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">而不是在那里等待</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">(</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">比如</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">:</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">要查的行已经被其它事务锁了</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">,</span></p><p style="white-space: normal; "><span style="font-size: 14px; color: rgb(63, 95, 191); ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">当前的锁事务与之冲突</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">,</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">加上</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">nowait,</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">当前的事务会结束会提示错误并立即结束</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">&nbsp;STATEMENT</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">而不再等待</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">).</span></p><p style="white-space: normal; "><span style="font-size: 14px; color: rgb(63, 95, 191); ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">关于</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">NOWAIT(</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">如果一定要用</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">FOR UPDATE</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">，我更建议加上</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">NOWAIT)</span></p><p style="white-space: normal; "><span style="font-size: 14px; color: rgb(63, 95, 191); ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">如果加了</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">for update</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">后</span>&nbsp;<span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">该语句用来锁定特定的行（如果有</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">where</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">子句，就是满足</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">where</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">条件的那些行）。</span></p><p style="white-space: normal; "><span style="font-size: 14px; color: rgb(63, 95, 191); ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">当这些行被锁定后，其他会话可以选择这些行，但不能更改或删除这些行，直到该语句的事务被</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">commit</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">语句或</span><span style="font-size: 14px; color: rgb(63, 95, 191); ">rollback</span><span style="font-size: 14px; font-family: 宋体; color: rgb(63, 95, 191); ">语句结束为止。</span></p><p style="white-space: normal; "><span style="font-size: 16px; color: rgb(63, 95, 191); ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</span></p><p style="white-space: normal; "><span style="font-size: 16px; "><br/></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">乐观锁的实现（Version）：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">class</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;xx&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">table</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;t_user&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">dynamic-update</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;true&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">dynamic-insert</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;true&quot;</span></i></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(127, 0, 127); ">optimistic-lock</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;version&quot;</span></i><span style="color: teal; ">&gt;</span></span></p><p style="margin-left: 48px; white-space: normal; text-indent: 28px; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">id</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span><span style="font-size: 14px; font-family: Consolas; ">...</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">id</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 95, 191); ">&lt;!-- version</span><span style="font-size: 19px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">必</span><span style="font-size: 19px; font-family: 宋体; color: rgb(63, 95, 191); ">须紧</span><span style="font-size: 19px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">跟</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 95, 191); ">id</span><span style="font-size: 19px; font-family: &#39;MS Mincho&#39;; color: rgb(63, 95, 191); ">之后</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 95, 191); ">&nbsp;--&gt;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">version</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;version&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">type</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;java.lang.Integer&quot;</span></i><span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><strong><span style="font-size: 18px; ">五、Hibernate实体配置高级篇</span></strong></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">sequence的写法</span></p><p style="white-space: normal; "><span style="line-height: normal; text-indent: 19px; font-size: 14px; font-family: Consolas; color: teal; ">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;</span><span style="line-height: normal; text-indent: 19px; font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">id</span><span style="line-height: normal; text-indent: 19px; font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;id&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">type</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;java.lang.Integer&quot;</span></i><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">column</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;ID&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">precision</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;22&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">scale</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;0&quot;</span></i>&nbsp;<span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">generator</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">class</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;sequence&quot;</span></i><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">param</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;sequence&quot;</span></i><span style="color: teal; ">&gt;</span>SEQ_DEPT_ID<span style="color: teal; ">&lt;/</span><span style="color: rgb(63, 127, 127); ">param</span><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">generator</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">id</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; "><span style="font-size: 16px; "><br/></span></p><p style="white-space: normal; "><span style="font-size: 16px; ">员工和部门的关系配置：</span></p><p style="white-space: normal; "><span class="Apple-style-span" style="font-size: 16px; line-height: 28px; ">员工deptInfo对象属性：</span></p><p style="white-space: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">private</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;DeptInfo&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); ">deptInfo</span><span style="font-size: 14px; font-family: Consolas; ">;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">对应：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">many-to-one</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;deptInfo&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">class</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;DeptInfo&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">fetch</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;select&quot;</span></i><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">column</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;DEPT_ID&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">precision</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;22&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">scale</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;0&quot;</span></i>&nbsp;<span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">many-to-one</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">而部门中员工是以set来存放的：</span></p><p style="white-space: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">private</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;Set&lt;EmpInfo&gt;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(0, 0, 192); ">empInfos</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;=&nbsp;</span><strong><span style="font-size: 14px; font-family: Consolas; color: rgb(127, 0, 85); ">new</span></strong><span style="font-size: 14px; font-family: Consolas; ">&nbsp;HashSet&lt;EmpInfo&gt;(0);</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">对应：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">set</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;empInfos&quot;&nbsp;</span></i><span style="color: rgb(127, 0, 127); ">inverse</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;true&quot;</span></i><span style="color: teal; ">&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">key</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">column</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">name</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;DEPT_ID&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">precision</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;22&quot;</span></i>&nbsp;<span style="color: rgb(127, 0, 127); ">scale</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;0&quot;</span></i>&nbsp;<span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">key</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">one-to-many</span><span style="font-size: 14px; font-family: Consolas; ">&nbsp;<span style="color: rgb(127, 0, 127); ">class</span>=<i><span style="color: rgb(42, 0, 255); ">&quot;EmpInfo&quot;</span></i>&nbsp;<span style="color: teal; ">/&gt;</span></span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 14px; font-family: Consolas; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&lt;/</span><span style="font-size: 14px; font-family: Consolas; color: rgb(63, 127, 127); ">set</span><span style="font-size: 14px; font-family: Consolas; color: teal; ">&gt;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">这个inverse是做什么的？答：通常放在一对多的一方并设置为true，代表“主外键的关系由对方来维护”，打个比方：在一个公司中，是老板认识所有的员工容易，还是所有员工认识老板容易？</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">员工配置里面是&lt;many-to-one&gt;多个员工对应一个部门</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">而部门配置里面是&lt;one-to-many&gt;是一个部门对应多个员工。这个标签有一个class属性放对方的类名。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">关于inverse的详细解释：</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设STUDENT表中存在一个名为CLASS_ID的字段，它和CLASS表中的ID字段是主外键关系。那个inverse属性就是用来规定是由谁（Student或Class）来维护这个主外键关系的。</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inverse的默认值为false。</span></p><p style="white-space: normal; text-indent: 48px; "><span style="font-size: 16px; ">在处理逻辑代码中，如下：</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">Class c1 = new Class();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">c1.setName(&quot;一班&quot;);</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">Student s1 = new Student();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">Student s2 = new Student();</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">s1.setName(&quot;Jason&quot;);</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">s2.setName(&quot;Tom&quot;);</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">c1.getStudents().add(s1);</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">c2.getStudents().add(s2);</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">s1.setClass(c1);</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">s2.setClass(c1);&nbsp;&nbsp; //注释1</span></p><p style="white-space: normal; line-height: normal; "><span style="font-size: 16px; ">session.save(c1);</span></p><p style="white-space: normal; "><span style="font-size: 16px; ">&nbsp; &nbsp; &nbsp; &nbsp; 上面的代码会使Hibernate执行五条SQL语句，其中前三条是insert插入语句，后两条是update更新语句。插入就不用说了，那么为什么还要有更新语句呢？这是因为Class类映射文件的&lt;set&gt;元素中指定了inverse=&quot;false&quot;，这就告之Hibernate：STUDENT表与CLASS表的主外键关系是由Class类来维护的。当执行save后，执行了三条insert语句，这三条语句中的后两条是插入到STUDENT表的，它们的CLASS_ID字段是通过s1.getClass().getID()取出的，假如我将上面“注释1”处修改为s2.setClass(c2);（c2是另一个Class对象，可能是持久化对象），这样，主外键关系不就乱了吗。为了保证主外键关系，Hibernate在这种情况下会再执行两条update语句来更改STUDENT表中两个新插入记录的CLASS_ID字段，当然，这时CLASS_ID字段的取值是从c1对象中直接取得，而不再是s1.getClass().getID()方式了。</span></p><p style="white-space: normal; "><span class="Apple-style-span" style="font-size: 16px; line-height: 28px; ">&nbsp; &nbsp; &nbsp; &nbsp; 如果我们将Class类映射文件的&lt;set&gt;元素中的inverse属性修改为true，这就是告诉Hibernate：Class类不维护主外键关系了，这个任务就交给了Student类。于是，我们再执行上面的代码，Hibernate就会只执行三条insert语句，而不会执行任何update语句。因为Hibernate会通过Student类的s1.getClass().getID()和s2.getClass().getID()来确定CLASS_ID字段的值。</span></p><p style="white-space: normal; "><span class="Apple-style-span" style="font-size: 16px; line-height: 28px; ">&nbsp; &nbsp; &nbsp; &nbsp; 故，为了节省数据库资源，省却不必要的update语句，我们一般建议在一对多双向关联关系中，将一方的inverse属性设置为true，即将主外键的关系交由多方来维护。</span></p><p style="white-space: normal; "><span class="Apple-style-span" style="font-size: 16px; line-height: 28px; ">&nbsp; &nbsp; &nbsp; &nbsp; 打个比方：在一个公司中，是老板认识所有的员工容易，还是所有员工认识老板容易？</span></p><p><br/></p>
