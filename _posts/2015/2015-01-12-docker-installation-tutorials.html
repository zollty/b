---
layout: ue
title: Docker安装教程
category: 运维与基础设施
tags: [Docker]
keywords: "Docker安装教程"
---

{% raw %}
<p><br/></p><p>一、CentOS安装Docker篇</p><p><br/></p><p>Docker 要求 CentOS 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的CentOS 版本是否支持 Docker 。</p><p>通过 uname -r 命令查看你当前的内核版本。</p><p><br/></p><p><br/></p><p><strong>超简单CentOS7 配置阿里云yum源</strong></p><p>1、打开centos的yum文件夹</p><p>输入命令cd&nbsp; /etc/yum.repos.d/</p><p><br/></p><p>2、用wget下载repo文件</p><p>输入命令wget&nbsp; http://mirrors.aliyun.com/repo/Centos-7.repo</p><p>如果wget命令不生效，说明还没有安装wget工具，输入yum -y install wget 回车进行安装。</p><p>当前目录是/etc/yum.repos.d/，刚刚下载的Centos-7.repo也在这个目录上</p><p><br/></p><p>3、备份系统原来的repo文件</p><p>mv&nbsp; CentOS-Base.repo CentOS-Base.repo.bak</p><p>即是重命名 CentOS-Base.repo -&gt; CentOS-Base.repo.bak</p><p><br/></p><p>4、替换系统原理的repo文件</p><p>mv Centos-7.repo CentOS-Base.repo</p><p>即是重命名 Centos-7.repo -&gt; CentOS-Base.repo</p><p><br/></p><p>5、执行yum源更新命令</p><p>yum clean all</p><p>yum makecache</p><p>yum update</p><p>依次执行上述三条命令即配置完毕。</p><p><br/></p><p><br/></p><p><strong>yum方式安装Docker</strong></p><p>1、移除旧的版本：</p><p>sudo yum remove docker \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-client \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-client-latest \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-common \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-latest \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-latest-logrotate \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-logrotate \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-selinux \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-engine-selinux \</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; docker-engine</p><p><br/></p><p>2、安装一些必要的系统工具：</p><p>sudo yum install -y yum-utils device-mapper-persistent-data lvm2</p><p><br/></p><p>3、添加软件源信息：</p><p>sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</p><p><br/></p><p>4、更新 yum 缓存：</p><p>sudo yum makecache fast</p><p><br/></p><p>5、安装 Docker-ce：</p><p>sudo yum -y install docker-ce</p><p><br/></p><p>6、启动 Docker 后台服务</p><p>sudo systemctl start docker<br/></p><p><br/></p><p>7、测试运行 hello-world</p><p>docker run hello-world</p><p><br/></p><p>到此，Docker 在 CentOS 系统的安装完成。</p><p><br/></p><p style="white-space: normal;"><strong>删除 Docker CE</strong></p><p style="white-space: normal;">执行以下命令来删除 Docker CE：</p><p style="white-space: normal;">$ sudo yum remove docker-ce</p><p style="white-space: normal;">$ sudo rm -rf /var/lib/docker</p><p style="white-space: normal;"><br/></p><p style="white-space: normal;">另外，可以使用脚本自动安装</p><p>在测试或开发环境中 Docker 官方为了简化安装流程，提供了一套便捷的安装脚本，CentOS 系统上可以使用这套脚本安装：</p><p>$ curl -fsSL get.docker.com -o get-docker.sh</p><p>$ sudo sh get-docker.sh --mirror Aliyun</p><p>执行这个命令后，脚本就会自动的将一切准备工作做好，并且把 Docker CE 的 Edge 版本安装在系统中。</p><p><br/></p><p>启动 Docker CE</p><p>$ sudo systemctl enable docker</p><p>$ sudo systemctl start docker</p><p><br/></p><p><strong>建立 docker 用户组</strong></p><p>默认情况下，docker 命令会使用 Unix socket 与 Docker 引擎通讯。而<em>只有 root 用户和 docker 组的用户</em>才可以访问 Docker 引擎的 Unix socket。出于安全考虑，一般 Linux 系统上不会直接使用 root 用户。因此，更好地做法是将需要使用 docker 的用户加入 docker 用户组。</p><p><br/></p><p>建立 docker 组：</p><p>$ sudo groupadd docker</p><p><br/></p><p>将当前用户加入 docker 组：</p><p>$ sudo usermod -aG docker $USER</p><p><br/></p><p>退出当前终端并重新登录，进行如下测试。</p><p>$ docker run hello-world</p><p><br/></p><p><strong>镜像加速</strong></p><p>鉴于国内网络问题，后续拉取 Docker 镜像十分缓慢，强烈建议安装 Docker 之后配置 <a href="https://yeasy.gitbooks.io/docker_practice/content/install/mirror.html" target="_blank" title="国内镜像加速">国内镜像加速</a>。</p><p><br/></p><p>Docker 官方和国内很多云服务商都提供了国内加速器服务，例如：</p><p>Docker 中国 registry mirror：&nbsp;<a href="https://registry.docker-cn.com">https://registry.docker-cn.com</a></p><p>中国科学技术大学：<a href="https://docker.mirrors.ustc.edu.cn">https://docker.mirrors.ustc.edu.cn</a></p><p>七牛云加速器：&nbsp;<a href="https://reg-mirror.qiniu.com/">https://reg-mirror.qiniu.com/</a> </p><p>网易云：<a href="http://hub-mirror.c.163.com">http://hub-mirror.c.163.com</a> </p><p>阿里云：</p><p><a href="https://1234abcd.mirror.aliyuncs.com/">https://1234abcd.mirror.aliyuncs.com/</a> </p><p><a href="https://ckq4qobq.mirror.aliyuncs.com/">https://ckq4qobq.mirror.aliyuncs.com/</a> </p><p><br/></p><p><br/></p><p>当配置某一个加速器地址之后，若发现拉取不到镜像，请切换到另一个加速器地址。</p><p>也可以单次设置拉取地址，例如使用docker中国镜像：</p><p>docker pull <strong>registry.docker-cn.com</strong>/library/ubuntu:16.04</p><p><br/></p><p>Daocloud镜像配置，官方脚本一键配置：<br/></p><p>参见：<a href="https://www.daocloud.io/mirror#accelerator-doc">https://www.daocloud.io/mirror#accelerator-doc</a> </p><p><br/></p><p><br/></p><p>手动配置，我们以 Docker 官方加速器 https://registry.docker-cn.com 为例进行介绍。</p><p><br/></p><p>Ubuntu 14.04、Debian 7 Wheezy （对于使用 upstart 的系统而言）</p><p>编辑 /etc/default/docker 文件，在其中的 DOCKER_OPTS 中配置加速器地址：</p><p>DOCKER_OPTS=&quot;--registry-mirror=https://registry.docker-cn.com&quot;</p><p>重新启动服务。</p><p>$ sudo service docker restart</p><p><br/></p><p>Ubuntu 16.04+、Debian 8+、CentOS 7 （对于使用 systemd 的系统）</p><p>请在 <strong>/etc/docker/daemon.json</strong> 中写入如下内容（如果文件不存在请新建该文件）</p><pre class="brush:js;toolbar:false">{
&nbsp;&nbsp;&quot;registry-mirrors&quot;:&nbsp;[
&nbsp;&nbsp;&nbsp;&nbsp;&quot;https://registry.docker-cn.com&quot;
&nbsp;&nbsp;]
}</pre><p>注意，一定要保证该文件符合 json 规范，否则 Docker 将不能启动。</p><p>之后重新启动服务。</p><p>$ sudo systemctl daemon-reload</p><p>$ sudo systemctl restart docker</p><p>注意：如果您之前查看旧教程，修改了 docker.service 文件内容，请去掉您添加的内容（--registry-mirror=https://registry.docker-cn.com），这里不再赘述。</p><p><br/></p><p>配置加速器之后，可以手动检查加速器配置是否生效，在命令行执行&nbsp;</p><p>$ docker info</p><p>或者执行一次：</p><p>$ docker search ubuntu</p><p><br/></p><p><strong>添加内核参数</strong></p><p>默认配置下，如果在 CentOS 使用 Docker CE 看到下面的这些警告信息：</p><p>WARNING: bridge-nf-call-iptables is disabled</p><p>WARNING: bridge-nf-call-ip6tables is disabled</p><p><br/></p><p>请添加内核配置参数以启用这些功能。</p><p>more /etc/sysctl.conf</p><p><br/></p><p>$ <strong>sudo tee -a /etc/sysctl.conf &lt;&lt;-EOF</strong></p><p><strong>net.bridge.bridge-nf-call-ip6tables = 1</strong></p><p><strong>net.bridge.bridge-nf-call-iptables = 1</strong></p><p><strong>EOF</strong></p><p>然后重新加载 sysctl.conf 即可</p><p>$ <strong>sudo sysctl -p</strong></p><p><br/></p><p><br/></p>
{% endraw %}
