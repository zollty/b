---
layout: ue
title: Linux的cron定时任务使用说明
category: Linux系统与应用
tags: Linux,Cron
keywords: "Cron"
---

<p>直接使用 crontab -e 命令，进入到编辑器</p><p>然后输入 crontab指令</p><p><br/></p><p>crontab用法</p><p>crontab –e : 修改 crontab 文件，如果文件不存在会自动创建。&nbsp;</p><p>crontab –l : 显示 crontab 文件。&nbsp;</p><p>crontab -r : 删除 crontab 文件。</p><p>crontab -ir : 删除 crontab 文件前提醒用户。</p><p><br/></p><p>在crontab文件中写入需要执行的命令和时间，该文件中每行都包括六个域，其中前五个域是指定命令被执行的时间，最后一个域是要被执行的命令。每个域之间使用空格或者制表符分隔。格式如下：&nbsp;</p><p>minute hour day-of-month month-of-year day-of-week commands &nbsp; &nbsp;</p><p>合法值为：00-59 00-23 01-31 01-12 0-6 (0 is sunday)&nbsp;</p><p><br/></p><p>除了数字还有几个特殊的符号：&quot;*&quot;、&quot;/&quot;和&quot;-&quot;、&quot;,&quot;</p><p><br/></p><p>*代表所有的取值范围内的数字</p><p>&quot;/&quot;代表每的意思,&quot;/5&quot;表示每5个单位，例如每分钟运行一次命令： */1 * * * * /home/linrui/XXXX.sh</p><p>&quot;-&quot;代表从某个数字到某个数字</p><p>&quot;,&quot;分开几个离散的数字</p><p><br/></p><p>例如：</p><p>15,30,45,59 * * * * echo &quot;xgmtest.....&quot; &nbsp; &nbsp; 表示，每隔15分钟，执行一次打印命令&nbsp;</p><p>1、在 凌晨00:01运行</p><p>1 0 * * * /home/linrui/XXXX.sh</p><p><br/></p><p>2、每个工作日23:59都进行备份作业。</p><p>59 11 * * 1,2,3,4,5 /home/linrui/XXXX.sh &nbsp;&nbsp;</p><p>或者如下写法：</p><p>59 11 * * 1-5 /home/linrui/XXXX.sh</p><p><br/></p><p>3、每分钟运行一次命令</p><p>*/1 * * * * /home/linrui/XXXX.sh</p><p><br/></p><p>4、每个月的1号 14:10 运行</p><p>10 14 1 * * /home/linrui/XXXX.sh</p><p><br/></p><p>&nbsp; &nbsp;今天做了个数据库的备份脚本，顺便系统得学习一下Linux下定时执行脚本的设置。关键是要记住/var/spool/cron这个目录。下面看一下具体的用法：</p><p>&nbsp;</p><p>&nbsp; &nbsp; 首先查看一下/etc/crontab文件：</p><p>&nbsp;</p><p>&nbsp; &nbsp;$ cat /etc/crontab</p><p>&nbsp; &nbsp;SHELL=/bin/bash</p><p>&nbsp; &nbsp;PATH=/sbin:/bin:/usr/sbin:/usr/bin</p><p>&nbsp; &nbsp;MAILTO=root</p><p>&nbsp; &nbsp;HOME=/</p><p><br/></p><p>&nbsp; &nbsp;# run-parts</p><p>&nbsp; &nbsp;01 * * * * root run-parts /etc/cron.hourly</p><p>&nbsp; &nbsp;02 4 * * * root run-parts /etc/cron.daily</p><p>&nbsp; &nbsp;22 4 * * 0 root run-parts /etc/cron.weekly</p><p>&nbsp; &nbsp;42 4 1 * * root run-parts /etc/cron.monthly</p><p><br/></p><p>&nbsp; &nbsp; 前四行是有关设置cron任务运行的环境变量。SHELL变量的值指定系统使用的SHELL环境(该样例为bash shell)，PATH变量定义了执行命令的路径。Cron的输出以电子邮件的形式发给MAILTO变量定义的用户名。如果MAILTO变量定义为空字符串(MAILTO=&quot;&quot;)，电子邮件不会被发送。执行命令或脚本时HOME变量可用来设置基目录。</p><p>&nbsp; &nbsp; 文件/etc/crontab中每行任务的描述格式如下:&nbsp;</p><p>&nbsp;</p><p>&nbsp; &nbsp; minute hour day month dayofweek command</p><p>&nbsp;</p><p>&nbsp; &nbsp; minute - 从0到59的整数&nbsp;</p><p>&nbsp; &nbsp; hour - 从0到23的整数&nbsp;</p><p>&nbsp; &nbsp; day - 从1到31的整数 (必须是指定月份的有效日期)</p><p>&nbsp; &nbsp; month - 从1到12的整数 (或如Jan或Feb简写的月份)</p><p>&nbsp; &nbsp; dayofweek - 从0到7的整数，0或7用来描述周日 (或用Sun或Mon简写来表示)</p><p>&nbsp; &nbsp; command - 需要执行的命令(可用as ls /proc &gt;&gt; /tmp/proc或 执行自定义脚本的命令)&nbsp;</p><p>&nbsp;</p><p>&nbsp; &nbsp; root表示以root用户身份来运行</p><p>&nbsp; &nbsp; run-parts表示后面跟着的是一个文件夹，要执行的是该文件夹下的所有脚本</p><p><br/></p><p>&nbsp; &nbsp; 对于以上各语句，星号(*)表示所有可用的值。例如*在指代month时表示每月执行(需要符合其他限制条件)该命令。&nbsp;</p><p>&nbsp; &nbsp; 整数间的连字号(-)表示整数列，例如1-4意思是整数1,2,3,4</p><p>&nbsp; &nbsp; 指定数值由逗号分开。如：3,4,6,8表示这四个指定整数。</p><p>&nbsp; &nbsp; 符号“/”指定步进设置。“/”表示步进值。如0-59/2定义每两分钟执行一次。步进值也可用星号表示。如*/3用来运行每三个月份运行指定任务。</p><p><br/></p><p>&nbsp; &nbsp; 以“#”开头的为注释行,不会被执行。</p><p><br/></p><p>&nbsp; &nbsp; 如果一个cron任务需要定期而不是按小时,天,周,月来执行,则需要添加/etc/cron.d目录。这个目录下的所有文件和文件/etc/crontab语法相同，查看样例：</p><p><br/></p><p># record the memory usage of the system every monday&nbsp;</p><p># at 3:30AM in the file /tmp/meminfo&nbsp;</p><p>30 3 * * mon cat /proc/meminfo &gt;&gt; /tmp/meminfo&nbsp;</p><p># run custom scrīpt the first day of every month at 4:10AM&nbsp;</p><p>10 4 1 * * /root/scrīpts/backup.sh</p><p><br/></p><p>&nbsp; &nbsp; 除了root用户之外的用户可以执行crontab配置计划任务。所有用户定义的crontab存储在目录/var/spool/cron下，任务会以创建者的身份被执行。要以特定用户创建一个crontab，先以该用户登录，执行命令crontab -e，系统会启动在VISUAL或者EDITOR中指定的的编辑软件编辑crontab。文件内容与/etc/crontab格式相同。示例如下：</p><p>0 3 * * * /home/dbbackup/db1backup.sh backup</p><p>0 4 * * * /home/dbbackup/db2backup.sh backup</p><p><br/></p><p>&nbsp; &nbsp; 表示每天3点执行/home/dbbackup/db1backup.sh backup，4点执行/home/dbbackup/db2backup.sh backup，如果是每五分钟执行一次可改为：</p><p>*/5 * * * * /home/dbbackup/db2backup.sh backup</p><p><br/></p><p>&nbsp; &nbsp; 当更改的crontab需要保存时，文件会保存在成如下文件/var/spool/cron/username。文件名会根据用户名而不同。</p><p><br/></p><p>&nbsp; &nbsp; cron服务会每分钟检查一次/etc/crontab、/etc/cron.d/、/var/spool/cron文件下的变更。如果发现变化，就会下载到存储器中。因此，即使crontab文件改变了，程序也不需要重新启动。推荐自定义的任务使用crontab -e命令添加，退出后用/etc/init.d/crond restart命令重启crond进程，官方文件说不用重启进程，但我遇到不重启无法运行任务的情况。开始不知道/etc/crontab文件中的run-parts是什么意思，直接把命令按照/etc/crontab的格式加上总是无法运行，后来才知道run-parts是指后面跟着的是文件夹。</p><p><br/></p>