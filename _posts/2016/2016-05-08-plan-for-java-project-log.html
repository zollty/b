---
layout: ue
title: Java项目日志记录方案
category: JavaEE技术
tags: LOG
keywords: "Logback,log4j"
---

<p><span style="font-size: 20px;">一、概述</span></p><p><br/></p><p>1、采用slf4j作为日志API，采用logback作为日志输出工具，用slf4j桥接方式替换掉log4j和commons-logging。</p><p>2、采用trace（追踪）、debug（调试）、info（信息）、warn（警告）、error（错误）、fatal（致命）共6种日志级别。</p><p>3、采用dev（开发环境）、test（测试环境）、production（生产环境）等不同的日志配置，根据环境变量自动识别。</p><p>4、特殊的记录，需要大批量写入日志文件，应该采用异步线程写文件。</p><p><br/></p><p><span style="font-size: 20px;">二、日志级别定义</span></p><p>&nbsp; &nbsp; 采用trace（追踪）、debug（调试）、info（信息）、warn（警告）、error（错误）、fatal（致命）共6种日志级别。</p><p><br/></p><p>日志级别使用原则：</p><p>1、fatal（致命错误）使用原则</p><p>fatal为系统级别的异常，发生fatal错误，代表服务器整个或者核心功能已经无法工作了！！</p><p>1）在服务器启动时就应该检查，如果存在致命错误，<span style="color: rgb(0, 176, 80);">直接抛异常，让服务器不要启动起来</span>（启动了也无法正常工作，不如不启动）。</p><p>2）如果在服务器启动之后，发生了致命的错误，则记录fatal级别的错误日志，最好是同时<span style="color: rgb(0, 176, 80);">触发相关的修复和告警工作</span><span style="line-height: 32.4px;">（比如，给开发和维护人员发送告警邮件）。</span></p><p><br/></p><p>2、error（错误）使用原则</p><p>error为功能或者逻辑级别的严重异常，发生error级别的异常，<span style="color: rgb(0, 176, 80);">代表功能或者重要逻辑遇到问题、无法正常工作</span>。</p><p><br/></p><p>3、warn（警告）使用原则</p><p>warn用在某些逻辑非常规，发生了一些<span style="color: rgb(0, 176, 80);">小故障但是没有大的影响</span>，<span style="color: rgb(0, 176, 80);">或者重要数据被修改</span>，或者<span style="color: rgb(0, 176, 80);">某些操作需要引起重视</span>。</p><p><br/></p><p>4、info（信息）使用原则</p><p>info用于<span style="color: rgb(0, 176, 80);">记录一些有用的、关键的信息</span>，一般<span style="color: rgb(0, 176, 80);">这些信息出现得不频繁</span>，<span style="color: rgb(0, 176, 80);">只是在初始化的地方或者重要操作的地方才记录</span>。</p><p><br/></p><p>5、debug（调试）使用原则</p><p>debug用于记录一些<span style="color: rgb(0, 176, 80);">调试信息</span>，为了<span style="color: rgb(0, 176, 80);">方便查看程序的执行过程和相关数据、了解程序的动态</span>。</p><p><br/></p><p>6、trace（跟踪）使用原则</p><p>trace用于记录一些<span style="color: rgb(0, 176, 80);">更详细的调试信息</span>，这些信息<span style="color: rgb(0, 176, 80);">无需每次调试时都打印出来</span>，只在需要更详细的调试信息时才开启。</p><p><br/></p><p style="line-height: 32.4px; white-space: normal;">7、项目稳定运行时的日志量</p><p style="line-height: 32.4px; white-space: normal;">1）正常情况下，trace日志至少是debug日志的100倍，</p><p style="line-height: 32.4px; white-space: normal;"><span style="line-height: 32.4px;">trace级别的日志量&nbsp;</span><span style="line-height: 32.4px; color: rgb(192, 0, 0);"><span style="font-weight: 700;"><span style="font-size: 20px;">：</span></span></span><span style="line-height: 32.4px;">&nbsp;debug级别的日志量 &nbsp;&gt; &nbsp;100&nbsp;</span><span style="line-height: 32.4px; font-size: 20px; color: rgb(192, 0, 0);"><span style="font-weight: 700;">：</span></span><span style="line-height: 32.4px;">&nbsp;1，</span></p><p style="line-height: 32.4px; white-space: normal;">也就是说trace日志非常多，debug日志相对较少。</p><p style="line-height: 32.4px; white-space: normal;"><br/></p><p style="line-height: 32.4px; white-space: normal;">2）debug级别的日志量 <span style="color: rgb(192, 0, 0); font-size: 20px; font-weight: bold; line-height: 32.4px;">：</span> info级别的日志量 &gt; 1000<span style="line-height: 32.4px;">&nbsp;</span><span style="line-height: 32.4px; font-size: 20px; color: rgb(192, 0, 0);"><span style="font-weight: 700;">：</span></span><span style="line-height: 32.4px;">&nbsp;1，</span></p><p style="line-height: 32.4px; white-space: normal;"><span style="line-height: 32.4px;">也就是说</span>正常情况下，info日志很少，只在部分重要位置会输出 info日志。</p><p style="line-height: 32.4px; white-space: normal;"><br/></p><p style="line-height: 32.4px; white-space: normal;">3）error日志和warn日志，正常情况下，几乎为0，当出现异常时，error日志和warn日志量 也在可控范围，不会超过debug级别的最大日志量。</p><p><br/></p><p><span style="font-size: 20px;">三、日志输出（Appender）分类</span></p><p><br/></p><p>分为5个一般类：&nbsp;</p><p>&nbsp; &nbsp; FILE_EXCEPTION （异常日志，包括ERROR和WARN）</p><p>&nbsp; &nbsp; FILE_APP （应用日志，包括当前应用package下面的日志和DEBUG级别以上的其他日志）</p><p>&nbsp; &nbsp; FILE_INFO （普通信息日志）</p><p>&nbsp; &nbsp; FILE_DEBUG （调试日志）</p><p>&nbsp; &nbsp; FILE_TRACE（追踪日志）</p><p>&nbsp; &nbsp; SYSOUT（控制台输出，可以包括以上所有日志）</p><p>扩展类： 包括异步输出的日志，或者特殊业务日志。</p><p><br/></p><p>举例说明：</p><p>假如&nbsp;</p><p>当前应用的 Main Package 为 cn.zollty.lightning</p><p>ROOT_LEVEL为 trace，应用日志 LEVEL 为 debug</p><p>有以下日志打印：</p><pre class="brush:java;toolbar:false">Logger&nbsp;loggerA&nbsp;=&nbsp;LoggerFactory.getLogger(cn.zollty.lightning.Tests.class);
loggerA.trace(&quot;--------&quot;);
loggerA.debug(&quot;--------&quot;);
loggerA.info(&quot;--------&quot;);
loggerA.warn(&quot;--------&quot;);
loggerA.error(&quot;--------&quot;);

Logger&nbsp;loggerB&nbsp;=&nbsp;LoggerFactory.getLogger(org.apache.kafka.Consumer.class);
loggerB.trace(&quot;--------&quot;);
loggerB.debug(&quot;--------&quot;);
loggerB.info(&quot;--------&quot;);
loggerB.warn(&quot;--------&quot;);
loggerB.error(&quot;--------&quot;);</pre><p>那么，<span style="line-height: 1.8;">异常日志（FILE_EXCEPTION）输出的为：</span></p><p>loggerA.warn(&quot;--------&quot;);</p><p>loggerA.error(&quot;--------&quot;);</p><p>loggerB.warn(&quot;--------&quot;);</p><p>loggerB.error(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">控制台（SYSOUT）输出日志的为;</p><p style="line-height: 32.4px; white-space: normal;">loggerA.debug(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">loggerA.info(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">loggerA.warn(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">loggerA.error(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">loggerB.trace(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">loggerB.debug(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">loggerB.info(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">loggerB.warn(&quot;--------&quot;);</p><p style="line-height: 32.4px; white-space: normal;">loggerB.error(&quot;--------&quot;);</p><p><span style="line-height: 1.8;">应用日志（FILE_APP）输出的为：</span><br/></p><p>loggerA.debug(&quot;--------&quot;);</p><p>loggerA.info(&quot;--------&quot;);</p><p>loggerA.warn(&quot;--------&quot;);</p><p>loggerA.error(&quot;--------&quot;);</p><p>loggerB.info(&quot;--------&quot;);</p><p>loggerB.warn(&quot;--------&quot;);</p><p>loggerB.error(&quot;--------&quot;);</p><p><br/></p><p style="line-height: 32.4px; white-space: normal;">2、历史日志文件</p><p style="line-height: 32.4px; white-space: normal;">异常日志（error和warn）最多保存 9000 M（生产，测试）</p><p style="line-height: 32.4px; white-space: normal;">app日志最多保存 9000 M （生产，测试）</p><p style="line-height: 32.4px; white-space: normal;">trace日志最多保存 1000 M （仅供测试用，一般不用）</p><p style="line-height: 32.4px; white-space: normal;">debug、info日志最多保存 5000 M（一般不用，用app日志就够了）</p><p><br/></p><p><span style="font-size: 20px;">四、<span style="line-height: 1.8;">各环境默认日志定义</span></span></p><p><span style="line-height: 1.8;"><br/></span></p><p><span style="line-height: 1.8;">开发环境</span><br/></p><p>1）默认日志级别定义为：</p><p>&nbsp; &nbsp; app包为TRACE级别。日志的ROOT Level为DEBUG级别。</p><p>2）</p><p>启用 System.out 控制台输出日志；</p><p>启用error.log为错误和警告日志、app.log为应用日志（包括app包下的日志和其他INFO级别以上的日志）。</p><p><br/></p><p>测试环境</p><p>1）默认日志级别定义为：</p><p>&nbsp; &nbsp; app包为DEBUG级别。日志的ROOT Level为DEBUG级别。</p><p>2）</p><p>禁用 System.out 控制台输出日志；</p><p>启用error.log为错误和警告日志、app.log为应用日志（包括app包下的日志和其他INFO级别以上的日志）。</p><p><br/></p><p>生产环境</p><p>1）默认日志级别定义为：</p><p>&nbsp; &nbsp; app包为DEBUG级别。日志的ROOT Level为INFO级别。</p><p>2）</p><p>禁用 System.out 控制台输出日志；</p><p>启用error.log为错误和警告日志、app.log为应用日志（包括app包下的日志和其他INFO级别以上的日志）。</p><p><br/></p><p><span style="font-size: 20px;">五、<span style="line-height: 1.8;">根据环境自动选择日志配置（借助<span style="font-size: 20px; line-height: 36px;">Logback</span>）</span></span></p><p><span style="line-height: 1.8;"><br/></span></p><p><span style="color: rgb(192, 0, 0);">关键点1：</span>使用logback的环境变量定义和读取功能</p><p>例如下面的各种环境变量定义：</p><pre class="brush:xml;toolbar:false">&lt;!--&nbsp;部署的环境类型：dev、test、product&nbsp;--&gt;
&lt;property&nbsp;name=&quot;DEPLOY_ENV&quot;&nbsp;value=&quot;${deploy.env:-dev}&quot;&nbsp;/&gt;

&lt;!--&nbsp;日志路径，这里是相对路径，web项目eclipse下会输出到当前目录./logs/下，如果部署到linux上的tomcat下，会输出到tomcat/logs/目录&nbsp;下&nbsp;--&gt;
&lt;property&nbsp;name=&quot;LOG_HOME&quot;&nbsp;value=&quot;${catalina.base:-.}/logs&quot;&nbsp;/&gt;

&lt;!--&nbsp;日志文件大小,超过这个大小将被压缩&nbsp;--&gt;
&lt;property&nbsp;name=&quot;LOG_MAX_SIZE&quot;&nbsp;value=&quot;100MB&quot;&nbsp;/&gt;
&lt;!--&nbsp;日志输出格式&nbsp;--&gt;
&lt;property&nbsp;name=&quot;LOG_COMMON_PATTERN&quot;&nbsp;value=&quot;%d{HH:mm:ss.SSS}&nbsp;[%thread]&nbsp;[%level]&nbsp;%logger&nbsp;-&nbsp;%msg%n&quot;&nbsp;/&gt;
&lt;property&nbsp;name=&quot;LOG_DEV_PATTERN&quot;&nbsp;value=&quot;%d{HH:mm:ss.SSS}&nbsp;[%thread]&nbsp;%-5level&nbsp;%logger{48}:%line&nbsp;-&nbsp;%msg%n&quot;&nbsp;/&gt;

&lt;!--&nbsp;主日志级别&nbsp;--&gt;
&lt;property&nbsp;name=&quot;ROOT_LEVEL&quot;&nbsp;value=&quot;${log.root.level:-DEBUG}&quot;&nbsp;/&gt;

&lt;!--&nbsp;APP&nbsp;日志级别&nbsp;--&gt;
&lt;property&nbsp;name=&quot;APP_LEVEL&quot;&nbsp;value=&quot;${log.app.level:-TRACE}&quot;&nbsp;/&gt;
&lt;!--&nbsp;APP&nbsp;Package&nbsp;前缀：&nbsp;cn.zollty.lightning&nbsp;--&gt;
&lt;property&nbsp;name=&quot;APP_PACKAGE&quot;&nbsp;value=&quot;cn.zollty.lightning&quot;&nbsp;/&gt;</pre><p>其中&nbsp;<span style="color: rgb(192, 0, 0);">${</span>deploy.env<span style="color: rgb(192, 0, 0);">:-</span>dev<span style="color: rgb(192, 0, 0);">}</span> 代表的意思是，如果环境变量中没有 deploy.env，则使用默认值dev。</p><p><span style="line-height: 1.8;"><br/></span></p><p><span style="color: rgb(192, 0, 0);">一个小技巧：</span>可以自定义类似下面这个类，在logback初始化之前，先设置变量的值：</p><pre class="brush:xml;toolbar:false">&lt;statusListener&nbsp;class=&quot;cn.zollty.commons.logbackext.InitConfigOnConsoleStatusListener&quot;&nbsp;/&gt;</pre><p><span style="line-height: 1.8;">这个类<span style="line-height: 32.4px;">继承自</span><span style="line-height: 32.4px;">ch.qos.logback.core.status.OnConsoleStatusListener。</span></span></p><p><span style="line-height: 1.8;"><br/></span></p><p><span style="color: rgb(192, 0, 0);">关键点2：</span>使用logback的 if-then 条件语法</p><pre class="brush:xml;toolbar:false">&lt;root&nbsp;level=&quot;${ROOT_LEVEL}&quot;&gt;
&nbsp;&nbsp;&lt;!--&nbsp;Required:&nbsp;exception&nbsp;log&nbsp;--&gt;
&nbsp;&nbsp;&lt;appender-ref&nbsp;ref=&quot;FILE_EXCEPTION&quot;/&gt;
&nbsp;&nbsp;&lt;!--&nbsp;Required:&nbsp;app&nbsp;log&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&lt;appender-ref&nbsp;ref=&quot;FILE_APP&quot;/&gt;

&nbsp;&nbsp;&lt;if&nbsp;condition=&#39;p(&quot;DEPLOY_ENV&quot;).contains(&quot;dev&quot;)&#39;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;then&gt;
	&lt;appender-ref&nbsp;ref=&quot;STDOUT&quot;&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/then&gt;
&nbsp;&nbsp;&lt;/if&gt;
&lt;/root&gt;</pre><p><span style="line-height: 1.8;"><br/></span></p><p>参考配置：</p><p><span style="color: rgb(255, 0, 0);"><strong>logback.xml：</strong></span></p><pre class="brush:xml;toolbar:false">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&nbsp;scan=&quot;true&quot;&nbsp;scanPeriod=&quot;60&nbsp;seconds&quot;&nbsp;debug=&quot;false&quot;&gt;

&nbsp;&nbsp;&lt;statusListener&nbsp;class=&quot;cn.zollty.commons.logbackext.InitConfigOnConsoleStatusListener&quot;&nbsp;/&gt;

&nbsp;&nbsp;&lt;!--&nbsp;部署的环境类型：dev、test、product&nbsp;--&gt;
&nbsp;&nbsp;&lt;property&nbsp;name=&quot;DEPLOY_ENV&quot;&nbsp;value=&quot;${deploy.env:-dev}&quot;&nbsp;/&gt;

&nbsp;&nbsp;&lt;!--&nbsp;日志路径，这里是相对路径，web项目eclipse下会输出到当前目录./logs/下，如果部署到linux上的tomcat下，会输出到tomcat/logs/目录&nbsp;下&nbsp;--&gt;
&nbsp;&nbsp;&lt;property&nbsp;name=&quot;LOG_HOME&quot;&nbsp;value=&quot;${catalina.base:-.}/logs&quot;&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;!--&nbsp;日志文件大小,超过这个大小将被压缩&nbsp;--&gt;
&nbsp;&nbsp;&lt;property&nbsp;name=&quot;LOG_MAX_SIZE&quot;&nbsp;value=&quot;100MB&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;!--&nbsp;日志输出格式&nbsp;--&gt;
&nbsp;&nbsp;&lt;property&nbsp;name=&quot;LOG_COMMON_PATTERN&quot;&nbsp;value=&quot;%d{HH:mm:ss.SSS}&nbsp;[%thread]&nbsp;[%level]&nbsp;%logger&nbsp;-&nbsp;%msg%n&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;property&nbsp;name=&quot;LOG_DEV_PATTERN&quot;&nbsp;value=&quot;%d{HH:mm:ss.SSS}&nbsp;[%thread]&nbsp;%-5level&nbsp;%logger{48}:%line&nbsp;-&nbsp;%msg%n&quot;&nbsp;/&gt;

&nbsp;&nbsp;&lt;!--&nbsp;主日志级别&nbsp;--&gt;
&nbsp;&nbsp;&lt;property&nbsp;name=&quot;ROOT_LEVEL&quot;&nbsp;value=&quot;${log.root.level:-DEBUG}&quot;&nbsp;/&gt;

&nbsp;&nbsp;&lt;!--&nbsp;APP&nbsp;日志级别&nbsp;--&gt;
&nbsp;&nbsp;&lt;property&nbsp;name=&quot;APP_LEVEL&quot;&nbsp;value=&quot;${log.app.level:-TRACE}&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;!--&nbsp;APP&nbsp;Package&nbsp;前缀：&nbsp;cn.cstonline.zollty&nbsp;--&gt;
&nbsp;&nbsp;&lt;property&nbsp;name=&quot;APP_PACKAGE&quot;&nbsp;value=&quot;cn.zollty.lightning&quot;&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;include&nbsp;resource=&quot;includedConfig.xml&quot;/&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;appender&nbsp;name=&quot;STDOUT&quot;&nbsp;class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;encoder&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pattern&gt;${LOG_DEV_PATTERN}&lt;/pattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/encoder&gt;
&nbsp;&nbsp;&lt;/appender&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;appender&nbsp;name=&quot;FILTER-DATA&quot;&nbsp;class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;file&gt;${LOG_HOME}/filter.log&lt;/file&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;rollingPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fileNamePattern&gt;${LOG_HOME}/filter/filter-%d{yyyy-MM-dd}-%i.log.zip&lt;/fileNamePattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;maxHistory&gt;90&lt;/maxHistory&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;TimeBasedFileNamingAndTriggeringPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;MaxFileSize&gt;100MB&lt;/MaxFileSize&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/TimeBasedFileNamingAndTriggeringPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/rollingPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;encoder&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pattern&gt;${LOG_COMMON_PATTERN}&lt;/pattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/encoder&gt;
&nbsp;&nbsp;&lt;/appender&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;appender&nbsp;name=&quot;ASYNC1&quot;&nbsp;class=&quot;ch.qos.logback.classic.AsyncAppender&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;appender-ref&nbsp;ref=&quot;FILTER-DATA&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;/appender&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;include&nbsp;resource=&quot;special_log_level.xml&quot;/&gt;

&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;${APP_PACKAGE}&quot;&nbsp;level=&quot;${APP_LEVEL}&quot;&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;FILTER-LOGGER&quot;&nbsp;level=&quot;${APP_LEVEL}&quot;&nbsp;additivity=&quot;false&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;appender-ref&nbsp;ref=&quot;ASYNC1&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;/logger&gt;

&nbsp;&nbsp;&lt;root&nbsp;level=&quot;${ROOT_LEVEL}&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Required:&nbsp;exception&nbsp;log&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;appender-ref&nbsp;ref=&quot;FILE_EXCEPTION&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Required:&nbsp;app&nbsp;log&nbsp;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;appender-ref&nbsp;ref=&quot;FILE_APP&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Optional：&nbsp;show&nbsp;all&nbsp;debug&nbsp;or&nbsp;trace&nbsp;info&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;&lt;appender-ref&nbsp;ref=&quot;FILE_DEBUG&quot;/&gt;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;&lt;appender-ref&nbsp;ref=&quot;FILE_TRACE&quot;/&gt;&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;if&nbsp;condition=&#39;p(&quot;DEPLOY_ENV&quot;).contains(&quot;dev&quot;)&#39;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;then&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;appender-ref&nbsp;ref=&quot;STDOUT&quot;&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/then&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/if&gt;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&lt;/root&gt;

&lt;/configuration&gt;</pre><p><strong style="color: rgb(255, 0, 0); line-height: 1.8;"><span style="line-height: 1.8;">includedConfig.xml</span></strong><br/></p><pre class="brush:xml;toolbar:false">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;&nbsp;?&gt;

&lt;included&gt;

&nbsp;&nbsp;&lt;!--&nbsp;WARN&nbsp;and&nbsp;ERROR&nbsp;--&gt;
&nbsp;&nbsp;&lt;appender&nbsp;name=&quot;FILE_EXCEPTION&quot;&nbsp;class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter&nbsp;class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;level&gt;WARN&lt;/level&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/filter&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;file&gt;${LOG_HOME}/error.log&lt;/file&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;rollingPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;rollover&nbsp;daily&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fileNamePattern&gt;${LOG_HOME}/error/error-%d{yyyy-MM-dd}-%i.log.zip&lt;/fileNamePattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;maxHistory&gt;90&lt;/maxHistory&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;TimeBasedFileNamingAndTriggeringPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;or&nbsp;whenever&nbsp;the&nbsp;file&nbsp;size&nbsp;reaches&nbsp;100MB&nbsp;--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;MaxFileSize&gt;${LOG_MAX_SIZE}&lt;/MaxFileSize&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/TimeBasedFileNamingAndTriggeringPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/rollingPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;encoder&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pattern&gt;${LOG_COMMON_PATTERN}&lt;/pattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/encoder&gt;
&nbsp;&nbsp;&lt;/appender&gt;

&nbsp;&nbsp;&lt;!--&nbsp;INFO&nbsp;or&nbsp;Greater&nbsp;--&gt;
&nbsp;&nbsp;&lt;appender&nbsp;name=&quot;FILE_INFO&quot;&nbsp;class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter&nbsp;class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;level&gt;INFO&lt;/level&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/filter&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;file&gt;${LOG_HOME}/info.log&lt;/file&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;rollingPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fileNamePattern&gt;${LOG_HOME}/info/info-%d{yyyy-MM-dd}-%i.log.zip&lt;/fileNamePattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;maxHistory&gt;50&lt;/maxHistory&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;TimeBasedFileNamingAndTriggeringPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;MaxFileSize&gt;${LOG_MAX_SIZE}&lt;/MaxFileSize&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/TimeBasedFileNamingAndTriggeringPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/rollingPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;encoder&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pattern&gt;${LOG_COMMON_PATTERN}&lt;/pattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/encoder&gt;
&nbsp;&nbsp;&lt;/appender&gt;

&nbsp;&nbsp;&lt;!--&nbsp;DEBUG&nbsp;or&nbsp;Greater--&gt;
&nbsp;&nbsp;&lt;appender&nbsp;name=&quot;FILE_DEBUG&quot;&nbsp;class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter&nbsp;class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;level&gt;DEBUG&lt;/level&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/filter&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;file&gt;${LOG_HOME}/debug.log&lt;/file&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;rollingPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fileNamePattern&gt;${LOG_HOME}/debug/debug-%d{yyyy-MM-dd}-%i.log.zip&lt;/fileNamePattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;maxHistory&gt;50&lt;/maxHistory&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;TimeBasedFileNamingAndTriggeringPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;MaxFileSize&gt;${LOG_MAX_SIZE}&lt;/MaxFileSize&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/TimeBasedFileNamingAndTriggeringPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/rollingPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;encoder&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pattern&gt;${LOG_COMMON_PATTERN}&lt;/pattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/encoder&gt;
&nbsp;&nbsp;&lt;/appender&gt;

&nbsp;&nbsp;&lt;!--&nbsp;TRACE&nbsp;and&nbsp;ALL&nbsp;--&gt;
&nbsp;&nbsp;&lt;appender&nbsp;name=&quot;FILE_TRACE&quot;&nbsp;class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;file&gt;${LOG_HOME}/trace.log&lt;/file&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;rollingPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fileNamePattern&gt;${LOG_HOME}/trace/trace-%d{yyyy-MM-dd}-%i.log.zip&lt;/fileNamePattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;maxHistory&gt;10&lt;/maxHistory&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;TimeBasedFileNamingAndTriggeringPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;MaxFileSize&gt;${LOG_MAX_SIZE}&lt;/MaxFileSize&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/TimeBasedFileNamingAndTriggeringPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/rollingPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;encoder&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pattern&gt;${LOG_COMMON_PATTERN}&lt;/pattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/encoder&gt;
&nbsp;&nbsp;&lt;/appender&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;!--&nbsp;(INFO&nbsp;or&nbsp;Greater)&nbsp;or&nbsp;logname&nbsp;prefix&nbsp;=&nbsp;${APP_PACKAGE}&nbsp;--&gt;
&nbsp;&nbsp;&lt;appender&nbsp;name=&quot;FILE_APP&quot;&nbsp;class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter&nbsp;class=&quot;cn.zollty.lightning.common.PackageOrThresholdFilter&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;level&gt;INFO&lt;/level&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;prefix&gt;${APP_PACKAGE}&lt;/prefix&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/filter&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;file&gt;${LOG_HOME}/app.log&lt;/file&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;rollingPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fileNamePattern&gt;${LOG_HOME}/app/app-%d{yyyy-MM-dd}-%i.log.zip&lt;/fileNamePattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;maxHistory&gt;90&lt;/maxHistory&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;TimeBasedFileNamingAndTriggeringPolicy&nbsp;class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;MaxFileSize&gt;${LOG_MAX_SIZE}&lt;/MaxFileSize&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/TimeBasedFileNamingAndTriggeringPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/rollingPolicy&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;encoder&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pattern&gt;${LOG_COMMON_PATTERN}&lt;/pattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/encoder&gt;
&nbsp;&nbsp;&lt;/appender&gt;

&lt;/included&gt;</pre><p><span style="color: rgb(255, 0, 0);"><strong>special_log_level.xml</strong></span><span style="line-height: 1.8;"></span><br/></p><pre class="brush:xml;toolbar:false">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;&nbsp;?&gt;
&lt;included&gt;

&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;org.apache.zookeeper.ClientCnxn&quot;&nbsp;level=&quot;ERROR&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;org.apache.kafka.clients.consumer.internals.ConsumerCoordinator&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;kafka.producer.BrokerPartitionInfo&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;kafka.producer.async.ProducerSendThread&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;kafka.producer.async.DefaultEventHandler&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;org.apache.kafka.common.metrics.Metrics&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;org.apache.kafka.clients.Metadata&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;org.apache.kafka.clients.consumer.internals.AbstractCoordinator&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;org.apache.kafka.clients.consumer.internals.Fetcher&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;logger&nbsp;name=&quot;org.apache.kafka.clients.NetworkClient&quot;&nbsp;level=&quot;INFO&quot;&nbsp;/&gt;
&nbsp;&nbsp;
&lt;/included&gt;</pre><p><br/></p><p>也可以把变量定义到properties文件中，本地就放在&nbsp;</p><p>src/resources/conf/logback_val.properties</p><p>服务器上放在</p><p>${catalina.base}/conf/<span style="line-height: 32.4px;">logback_val.properties</span></p><p>配置如下：</p><pre class="brush:xml;toolbar:false">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&nbsp;scan=&quot;true&quot;&nbsp;scanPeriod=&quot;60&nbsp;seconds&quot;&nbsp;debug=&quot;false&quot;&gt;

&nbsp;&nbsp;&lt;if&nbsp;condition=&#39;isDefined(&quot;catalina.base&quot;)&#39;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;then&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;file=&quot;${catalina.base}/conf/logback_val.properties&quot;&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/then&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;else&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;resource=&quot;./conf/logback_val.properties&quot;&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/else&gt;
&nbsp;&nbsp;&lt;/if&gt;
&nbsp;&nbsp;
&nbsp;&nbsp;...</pre><p>logback_val.properties:</p><pre class="brush:plain;toolbar:false">#&nbsp;\u90E8\u7F72\u7684\u73AF\u5883\u7C7B\u578B\uFF1Adev\u3001test\u3001product
deploy.env=dev
#&nbsp;\u4E3B\u65E5\u5FD7\u7EA7\u522B
log.root.level=DEBUG
#&nbsp;APP&nbsp;\u65E5\u5FD7\u7EA7\u522B
log.app.level=TRACE
#&nbsp;Kafka&nbsp;LogStash&nbsp;\u9009\u62E9\u4F7F\u7528&nbsp;value=&nbsp;&quot;yes&quot;&nbsp;or&nbsp;&quot;no&quot;
log.use.logstash=yes
#&nbsp;LogStash&nbsp;Kafka&nbsp;URL
log.logstash.kafka=172.16.1.164:9092,172.16.1.165:9092,172.16.1.166:9092</pre><p style="line-height: 32.4px; white-space: normal;"><br/></p><p style="line-height: 32.4px; white-space: normal;">参考资料<span style="line-height: 32.4px;">：</span></p><p><a href="http://logback.qos.ch/manual/configuration.html#conditional">http://logback.qos.ch/manual/configuration.html#conditional</a><br/> </p><p><br/></p>