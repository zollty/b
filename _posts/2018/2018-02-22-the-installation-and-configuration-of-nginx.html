---
layout: ue
title: Nginx安装部署和配置
category: 中间件技术
tags: Nginx
keywords: "Nginx"
---

<p><br/></p><p>方法一（推荐）: 使用操作系统提供的安装工具（比如yum）<strong>自动安装</strong>：</p><p>参见官方文档：<a href="http://nginx.org/en/linux_packages.html">http://nginx.org/en/linux_packages.html</a> </p><p>注意，安装nginx的时候，会默认创建一个nginx用户，可以通过cat /etc/passwd查看用户信息。</p><p><br/></p><p>方法二：通过源码<strong>手工编译安装</strong>，如下文：</p><p>本文以 centos/redhat为例。</p><p><br/></p><p>主要步骤：</p><p>&nbsp; 1. 安装准备</p><p>&nbsp; 2. 检查依赖并安装</p><p><br/></p><p><strong>1、安装准备</strong></p><p>找一个安装位置，比如：/usr/local/nginx&nbsp;位置</p><p><br/></p><p>Nginx的安装依赖于以下三个包：</p><p>1 SSL功能需要openssl库，下载地址：http://www.openssl.org/</p><p>2 gzip模块需要zlib库，下载地址：http://www.zlib.net/</p><p>3 rewrite模块需要pcre库，下载地址：http://www.pcre.org/</p><p><br/></p><p>列表如下：</p><pre class="brush:plain;toolbar:false">nginx-1.12.2.tar.gz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20-Oct-2017&nbsp;15:40&nbsp;&nbsp;&nbsp;&nbsp;959K
openssl-1.1.0f.tar.gz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25-May-2017&nbsp;21:09&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5M（可选）
pcre-8.41.zip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;05-Jul-2017&nbsp;22:46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2M（可选）
zlib-1.2.11.tar.gz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16-Jul-2017&nbsp;22:46&nbsp;&nbsp;&nbsp;&nbsp;593K（可选）</pre><p>下载nginx:&nbsp; &nbsp; wget http://nginx.org/download/nginx-1.12.2.tar.gz</p><p>下载openssl : https://www.openssl.org/source/openssl-1.1.0g.tar.gz</p><p>下载zlib&nbsp; &nbsp; : wget http://zlib.net/zlib-1.2.11.tar.gz</p><p>下载pcre&nbsp; &nbsp; : wget https://ftp.pcre.org/pub/pcre/pcre-8.41.zip</p><p><br/></p><p>依赖包安装顺序依次为:openssl、zlib、pcre, 然后安装Nginx包</p><p><br/></p><p><strong>2、检查依赖并安装</strong></p><p>依赖库如下：</p><pre class="brush:plain;toolbar:false">gcc-c++&nbsp;
libtool&nbsp;
zlib&nbsp;zlib-devel&nbsp;
openssl&nbsp;openssl-devel
pcre&nbsp;pcre-devel</pre><p>如果没有安装c++编译环境，还得安装，通过yum install gcc-c++完成安装</p><p>（查看方式 yum list | grep gcc）</p><p><br/></p><p>查看效果如下：<br/></p><p><span style="font-size: 12px;">[root@middleware07 ]# rpm -qa | grep libtool</span></p><p><span style="color: rgb(192, 0, 0); font-size: 12px;">libtool-2.4.2-22.el7_3.x86_64</span></p><p><span style="font-size: 12px;">[root@middleware07 ]# rpm -qa | grep gcc</span></p><p><span style="font-size: 12px;">libgcc-4.8.5-16.el7_4.1.x86_64</span></p><p><span style="font-size: 12px;">gcc-4.8.5-16.el7_4.1.x86_64</span></p><p><span style="color: rgb(192, 0, 0); font-size: 12px;">gcc-c++-4.8.5-16.el7_4.1.x86_64</span></p><p><span style="font-size: 12px;">[root@middleware07 ]# rpm -qa | grep zlib</span></p><p><span style="font-size: 12px;">zlib-1.2.7-17.el7.x86_64</span></p><p><span style="color: rgb(192, 0, 0); font-size: 12px;">zlib-devel-1.2.7-17.el7.x86_64</span></p><p><span style="font-size: 12px;">[root@middleware07 ]# rpm -qa | grep openssl</span></p><p><span style="color: rgb(192, 0, 0); font-size: 12px;">openssl-devel-1.0.2k-8.el7.x86_64</span></p><p><span style="font-size: 12px;">openssl-1.0.2k-8.el7.x86_64</span></p><p><span style="font-size: 12px;">openssl-libs-1.0.2k-8.el7.x86_64</span></p><p><span style="font-size: 12px;">[root@middleware07 ]# rpm -qa | grep pcre</span></p><p><span style="color: rgb(192, 0, 0); font-size: 12px;">pcre-devel-8.32-17.el7.x86_64</span></p><p><span style="font-size: 12px;">pcre-8.32-17.el7.x86_64</span></p><p><br/></p><p>如果没有的话，就用类似于下面的命令安装：</p><p>yum install -y gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel</p><p><br/></p><p>一次安装过程：</p><pre class="brush:bash;toolbar:false">wget&nbsp;https://ftp.pcre.org/pub/pcre/pcre-8.41.zip
wget&nbsp;https://www.openssl.org/source/openssl-1.1.0f.tar.gz
yum&nbsp;-y&nbsp;install&nbsp;gcc&nbsp;gcc-c++&nbsp;autoconf&nbsp;automake&nbsp;libtool&nbsp;make&nbsp;cmake
yum&nbsp;-y&nbsp;install&nbsp;zlib&nbsp;zlib-devel&nbsp;openssl&nbsp;openssl-devel&nbsp;pcre-devel
./configure&nbsp;--prefix=/usr/local/nginx-1.12.2
make&nbsp;&amp;&amp;&nbsp;make&nbsp;install</pre><p>pcre和openssl也可以下载安装包，编译安装：</p><p><br/></p><p>openssl ：</p><p>[root@localhost] tar zxvf openssl-fips-2.0.9.tar.gz</p><p>[root@localhost] cd openssl-fips-2.0.9</p><p>[root@localhost] ./config &amp;&amp; make &amp;&amp; make install</p><p><br/></p><p>pcre:</p><p>[root@localhost] tar zxvf pcre-8.36.tar.gz</p><p>[root@localhost] cd pcre-8.36</p><p>[root@localhost]&nbsp; ./configure &amp;&amp; make &amp;&amp; make install</p><p><br/></p><p>zlib:</p><p>[root@localhost]tar zxvf zlib-1.2.8.tar.gz</p><p>[root@localhost] cd zlib-1.2.8</p><p>[root@localhost]&nbsp; ./configure &amp;&amp; make &amp;&amp; make install</p><p><br/></p><p>最后安装nginx</p><p>[root@localhost]tar zxvf nginx-1.8.0.tar.gz</p><p>[root@localhost] cd nginx-1.8.0</p><p>[root@localhost]&nbsp; ./configure &amp;&amp; make &amp;&amp; make install</p><p><br/></p><p>另外一个安装过程如下：</p><pre class="brush:bash;toolbar:false">cd&nbsp;/usr/local/src
wget&nbsp;http://nginx.org/download/nginx-1.4.2.tar.gz
tar&nbsp;-zxvf&nbsp;nginx-1.4.2.tar.gz
cd&nbsp;nginx-1.4.2

./configure&nbsp;--sbin-path=/usr/local/nginx/nginx&nbsp;\
--conf-path=/usr/local/nginx/nginx.conf&nbsp;\
--pid-path=/usr/local/nginx/nginx.pid&nbsp;\
--with-http_ssl_module&nbsp;\
--with-pcre=/opt/app/zollty/pcre-8.37&nbsp;\
--with-zlib=/opt/app/zollty/zlib-1.2.8&nbsp;\
--with-openssl=/opt/app/zollty/openssl-1.0.1t

make
make&nbsp;install</pre><p>--with-pcre=/usr/src/pcre-8.34 指的是pcre-8.34 的源码路径。</p><p>--with-zlib=/usr/src/zlib-1.2.7 指的是zlib-1.2.7 的源码路径。</p><p><br/></p><p>安装完成后，可启动nginx：</p><p>whereis nginx</p><p>（通常在 /usr/local/nginx/ 下面）</p><p><br/></p><p>启动命令：/usr/local/nginx/sbin/nginx</p><p>发现报错了：</p><p>error while loading shared libraries: libpcre.so.1: cannot open shared object file: No such file or directory</p><p>经网上查询，这是linux的通病</p><p><br/></p><p>先找到libpcre.so.1所在位置，然后做个软链接就可以了:</p><p>whereis libpcre.so.1</p><p>ln -s /usr/local/lib/libpcre.so.1 /lib64</p><p>&nbsp;</p><p>查看是否已启动：</p><p>netstat -ntlp&nbsp; ,&nbsp; Nginx默认端口为80</p><p><br/></p><p>将Nginx设置为开机自动启动</p><p>echo &quot;/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf&quot; &gt;&gt; /etc/rc.local</p><p><br/></p><p>停止/重新加载：</p><p>/usr/local/nginx/sbin/nginx -s stop(quit、reload)</p><p><br/></p><p>配置环境变量</p><p>在/etc/profile 中加入配置&nbsp;</p><p>vi /etc/profile<br/></p><p>在配置文件中加入</p><p>#nginx configure</p><p>export NGINX_HOME=/usr/local/nginx</p><p>export PATH=$PATH:$NGINX_HOME/sbin</p><p>编译完保存退出并执行</p><p>[root@zollty-linux nginx-1.10.2]# source /etc/profile</p><p>使配置生效。</p><p><br/></p><p>查看nginx版本</p><p>[root@zollty-linux nginx]# nginx -v</p><p>nginx version: nginx/1.10.2</p><p>整个过程成功了！</p><p><br/></p><p><strong>附：nginx编译选项</strong></p><p style="margin-bottom: 10px; padding: 0px; line-height: 1.5; font-size: 16px; color: rgb(85, 85, 85); font-family: Verdana, &quot;BitStream vera Sans&quot;, Tahoma, Helvetica, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">make是用来<span style="text-decoration: underline;">编译</span>的，它从Makefile中读取指令，然后编译。</p><p style="margin-bottom: 10px; padding: 0px; line-height: 1.5; font-size: 16px; color: rgb(85, 85, 85); font-family: Verdana, &quot;BitStream vera Sans&quot;, Tahoma, Helvetica, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">make install是用来<span style="text-decoration: underline;">安装</span>的，它也从Makefile中读取指令，安装到指定的位置。</p><p style="margin-bottom: 10px; padding: 0px; line-height: 1.5; font-size: 16px; color: rgb(85, 85, 85); font-family: Verdana, &quot;BitStream vera Sans&quot;, Tahoma, Helvetica, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">configure命令是用来检测你的安装平台的目标特征的。它定义了系统的各个方面，包括nginx的被允许使用的连接处理的方法，比如它会检测你是不是有CC或GCC，它是个shell脚本，执行结束时，它会创建一个Makefile文件。nginx的configure命令支持以下参数：</p><ul style="padding: 0px 0px 10px; color: rgb(85, 85, 85); font-family: Verdana, &quot;BitStream vera Sans&quot;, Tahoma, Helvetica, sans-serif; font-size: 12px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p><code>--prefix=<code><em>path</em></code></code>&nbsp; &nbsp; 定义一个目录，存放服务器上的文件&nbsp;，也就是nginx的安装目录。默认使用&nbsp;<code>/usr/local/nginx。</code></p></li><li><p><code>--sbin-path=<code><em>path</em></code></code>&nbsp;设置nginx的可执行文件的路径，默认为 &nbsp;<code><code><em>prefix</em></code>/sbin/nginx</code>.</p></li><li><p><code>--conf-path=<code><em>path</em></code></code>&nbsp;&nbsp;设置在nginx.conf配置文件的路径。nginx允许使用不同的配置文件启动，通过命令行中的-c选项。默认为<code><code><em>prefix</em></code>/conf/nginx.conf</code>.</p></li><li><p><code>--pid-path=<code><em>path</em>&nbsp;&nbsp;设置nginx.pid文件，将存储的主进程的进程号。安装完成后，可以随时改变的文件名 ， 在nginx.conf配置文件中使用 PID指令。默认情况下，文件名 为</code></code><code><code><em>prefix</em></code>/logs/nginx.pid</code>.</p></li><li><p><code>--error-log-path=<code><em>path</em></code></code>&nbsp;设置主错误，警告，和诊断文件的名称。安装完成后，可以随时改变的文件名 ，在nginx.conf配置文件中 使用 的error_log指令。默认情况下，文件名 为<code><code><em>prefix</em></code>/logs/error.log</code>.</p></li><li><p><code>--http-log-path=<code><em>path</em></code></code>&nbsp; 设置主请求的HTTP服务器的日志文件的名称。安装完成后，可以随时改变的文件名 ，在nginx.conf配置文件中 使用 的access_log指令。默认情况下，文件名 为<code><code><em>prefix</em></code>/logs/access.log</code>.</p></li><li><p><code>--user=<code><em>name</em></code></code>&nbsp; 设置nginx工作进程的用户。安装完成后，可以随时更改的名称在nginx.conf配置文件中 使用的 user指令。默认的用户名是nobody。</p></li><li><p><code>--group=<code><em>name</em></code></code>&nbsp;&nbsp;设置nginx工作进程的用户组。安装完成后，可以随时更改的名称在nginx.conf配置文件中 使用的 user指令。默认的为非特权用户。</p></li><li><p><code>--with-select_module</code>&nbsp;<code>--without-select_module&nbsp;启用或禁用构建一个模块来允许服务器使用select()方法。该模块将自动建立，如果平台不支持的kqueue，epoll，rtsig或/dev/poll。</code></p></li><li><p><code>--with-poll_module</code>&nbsp;<code>--without-poll_module</code>&nbsp;启用或禁用构建一个模块来允许服务器使用poll()方法。该模块将自动建立，如果平台不支持的kqueue，epoll，rtsig或/dev/poll。</p></li><li><p><code>--without-http_gzip_module</code>&nbsp;— 不编译压缩的HTTP服务器的响应模块。编译并运行此模块需要zlib库。</p></li><li><p><code>--without-http_rewrite_module</code>&nbsp; 不编译重写模块。编译并运行此模块需要PCRE库支持。</p></li><li><p><code>--without-http_proxy_module</code>&nbsp;— 不编译http_proxy模块。</p></li><li><p><code>--with-http_ssl_module</code>&nbsp;— 使用https协议模块。默认情况下，该模块没有被构建。建立并运行此模块的OpenSSL库是必需的。</p></li><li><p><code>--with-pcre=<code><em>path</em></code></code>&nbsp;—&nbsp;设置PCRE库的源码路径。PCRE库的源码（版本4.4 - 8.30）需要从PCRE网站下载并解压。其余的工作是Nginx的./ configure和make来完成。正则表达式使用在location指令和 ngx_http_rewrite_module 模块中。</p></li><li><p><code>--with-pcre-jit</code>&nbsp;—编译PCRE包含“just-in-time compilation”（1.1.12中， pcre_jit指令）。</p></li><li><p><code>--with-zlib=<code><em>path</em></code></code>&nbsp;—设置的zlib库的源码路径。要下载从 zlib（版本1.1.3 - 1.2.5）的并解压。其余的工作是Nginx的./ configure和make完成。ngx_http_gzip_module模块需要使用zlib 。</p></li><li><p><code>--with-cc-opt=<code><em>parameters</em></code></code>&nbsp;— 设置额外的参数将被添加到CFLAGS变量。例如,当你在FreeBSD上使用PCRE库时需要使用:<code>--with-cc-opt=&quot;-I /usr/local/include。</code>.如需要需要增加&nbsp;<code>select()支持的文件数量</code>:<code>--with-cc-opt=&quot;-D FD_SETSIZE=2048&quot;.</code></p></li><li><p><code>--with-ld-opt=<code><em>parameters</em></code></code>&nbsp;—设置附加的参数，将用于在链接期间。例如，当在FreeBSD下使用该系统的PCRE库,应指定:<code>--with-ld-opt=&quot;-L /usr/local/lib&quot;.</code></p></li></ul><p><br/></p><p><br/></p>