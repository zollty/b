---
layout: ue
title: 我的JBoss使用笔记
category: 中间件技术
tags: JBoss
keywords: "JBoss使用笔记"
---

<div><br/></div><div>一、JBOSS安装</div><div><br/></div><div>1）</div><div>直接解压到无空格的目录路径下即可。</div><div>例如:</div><div>D:\C\Java\jboss-5.0.1.GA\</div><div><br/></div><div>JBOSS的文件夹说明：</div><div>\bin 不解释</div><div><span style="color:#ff0000;">\server</span> 主目录，下面分成default、all、minimal等几个“用户”</div><div><br/></div><div>常用的是：<span style="color:#ff0000;">\server\default\</span></div><div>该目录下，发布项目的目录是：<span style="color:#FF0000;">\server\default\deploy\</span></div><div><br/></div><div>2）</div><div>配置WINDOWS环境变量：</div><div>新建JBOSS_HOME，内容为jboss的安装路径，例如D:\C\Java\jboss-5.0.1.GA</div><div>然后将：%JBOSS_HOME%/bin 添加到Path变量中。</div><div><br/></div><div>3）</div><div>验证安装是否成功：</div><div><br/></div><div>运行\bin\run.bat即可启动。默认是8080端口，输入http://localhost:8080即可出现JBOSS的页面</div><div><br/></div><div>关闭时，不要直接点击shutdown.bat，应该在cmd窗口运行如下指令：</div><div>&nbsp; &nbsp; 进入\bin目录，输入shutdown -S</div><div><br/></div><div><br/></div><div>4）安装Eclipse的JBOSS插件</div><div>用JBoss Tools，地址如下：</div><div><a href="http://www.jboss.org/tools/download/installation">http://www.jboss.org/tools/download/installation</a> </div><div>和其他Eclipse插件的安装方法一样，有安装说明。</div><div><br/></div><div><p><span style="font-family:&#39;宋体&#39;;font-size:10.5000pt;">5<span style="font-family:宋体;">）在</span><span style="font-family:Calibri;">Eclipse</span><span style="font-family:宋体;">下</span><span style="font-family:Calibri;">new</span><span style="font-family:宋体;">一个</span><span style="font-family:Calibri;">JBOSS&nbsp;Application&nbsp;Server</span><span style="font-family:宋体;">，然后在</span><span style="font-family:Calibri;">Server</span><span style="font-family:宋体;">名称上双击，打开设置。</span></span><span style="font-family:宋体;font-size:10.5pt;">&nbsp;</span></p></div><div><br/></div><div>二、JBOSS配置</div><div><br/></div><div>1）修改HTTP端口号</div><div>例如要修改default用户的端口号：</div><div>找到\server\default\<span style="color:#ff0000;">deploy\jbossweb.sar\server.xml</span>修改即可。</div><div><br/></div><div>2）修改JVM参数</div><div>找到\bin\run.bat</div><div>从末尾开始找，找到如下：</div><div>set JAVA_OPTS=%JAVA_OPTS% -Xms256m -Xmx1024m -XX:MaxPermSize=256m</div><div><br/></div><div><br/></div><div>三、问题解决</div><div><br/></div><div>1）启动后报错： invalid console appender config detected，Spring Bean无法初始化。</div><div>log4j问题，</div><div>在\server\default\conf\jboss-service.xml找到Log4jService，并增加<span style="font-size: 14px;">&lt;attribute name=&quot;CatchSystemOut&quot;&gt;false&lt;/attribute&gt;</span>，如下：</div><div><pre class="brush:xml;toolbar:false;" style="background-color:#F8F8F8;font-family:Verdana, Consolas, &#39;Courier New&#39;;">&lt;mbean&nbsp;code=&quot;org.jboss.logging.Log4jService&quot;&nbsp;name=&quot;jboss.system:type=Log4jService,service=Logging&quot;&gt;
&nbsp;&nbsp;&lt;attribute&nbsp;name=&quot;ConfigurationURL&quot;&gt;resource:log4j.xml&lt;/attribute&gt;
&nbsp;&nbsp;&lt;attribute&nbsp;name=&quot;CatchSystemOut&quot;&gt;false&lt;/attribute&gt;
&nbsp;&nbsp;&lt;attribute&nbsp;name=&quot;Log4jQuietMode&quot;&gt;true&lt;/attribute&gt;
&lt;/mbean&gt;</pre></div><div>注意，该设置并不会关闭日志的打印。</div><div><br/></div><div>2）java.lang.RuntimeException: mapped-name is required for MethodCacheAfterAdvi</div><div>我项目的web.xml里面有如下一段：</div><p style="line-height: normal;"><span style="font-size: 16px;">&lt;context-param&gt;</span></p><p style="line-height: normal;"><span style="font-size: 16px;">&nbsp; &nbsp; &nbsp; &lt;param-name&gt;webAppRootKey&lt;/param-name&gt;</span></p><p style="line-height: normal;"><span style="font-size: 16px;">&nbsp; &nbsp; &nbsp; &lt;param-value&gt;zollty&lt;/param-value&gt;</span></p><p style="line-height: normal;"><span style="font-size: 16px;">&nbsp; &lt;/context-param&gt;</span></p><div>删了貌似就行了。不过未测试，不知是不要这个原因，仅是猜测。</div><div><br/></div><div>3）Linux命令行启动后，关闭窗口不停止服务器的方法</div><div>执行： nohup&nbsp;./run.sh</div><div><br/></div><div><h3 style="background-color:#FFFFFF;color:#333333;font-family:&#39;Hiragino Sans GB W3&#39;, &#39;Hiragino Sans GB&#39;, Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;"><span style="font-family:&#39;Hiragino Sans GB W3&#39;, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei&#39;, 微软雅黑, Arial, Helvetica, simsun, 宋体;font-size:26px;">Linux下JBOSS的配置与启动</span>&nbsp;&nbsp;</h3></div><div><br/></div><div>1、安装JDK</div><div>（略），可以不设置环境变量，直接解压出目录即可。</div><div><br/></div><div>2、给JBOSS指定JDK_HOME</div><div>在run.conf中修改：</div><p style="line-height: normal;"><span style="font-size: 16px; background-color: rgb(238, 236, 225);">#</span></p><p style="line-height: normal;"><span style="font-size: 16px; background-color: rgb(238, 236, 225);"># Specify the location of the Java home directory. &nbsp;If set then $JAVA will</span></p><p style="line-height: normal;"><span style="font-size: 16px; background-color: rgb(238, 236, 225);"># be defined to $JAVA_HOME/bin/java, else $JAVA will be &quot;java&quot;.</span></p><p style="line-height: normal;"><span style="font-size: 16px; background-color: rgb(238, 236, 225);">#</span></p><p style="line-height: normal;"><span style="color: rgb(255, 0, 0); font-size: 16px; background-color: rgb(238, 236, 225);">JAVA_HOME=&quot;/opt/java/jdk1.6.0_45&quot; </span></p><div><br/></div><p style="line-height: normal;"><span style="font-size: 16px; background-color: rgb(238, 236, 225);">#</span></p><p style="line-height: normal;"><span style="font-size: 16px; background-color: rgb(238, 236, 225);"># Specify the exact Java VM executable to use.</span></p><p style="line-height: normal;"><span style="font-size: 16px; background-color: rgb(238, 236, 225);">#</span></p><p style="line-height: normal;"><span style="font-size: 16px; background-color: rgb(238, 236, 225);">#JAVA=&quot;&quot;</span></p><div><br/></div><div>3、给JBOSS指定<span style="background-color:#FFFFFF;color:#333333;font-family:&#39;Hiragino Sans GB W3&#39;, &#39;Hiragino Sans GB&#39;, Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">JBOSS_HOME</span></div><div><span style="background-color:#FFFFFF;color:#333333;font-family:&#39;Hiragino Sans GB W3&#39;, &#39;Hiragino Sans GB&#39;, Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">修改/bin/run.sh文件，在前面加上如下两行</span></div><div><span style="background-color:#FFFFFF;color:#333333;font-family:&#39;Hiragino Sans GB W3&#39;, &#39;Hiragino Sans GB&#39;, Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">export JBOSS_HOME=/opt/app/jboss-5.1.0.GA</span><div style="background-color:#FFFFFF;color:#333333;font-family:&#39;Hiragino Sans GB W3&#39;, &#39;Hiragino Sans GB&#39;, Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">export PATH=$PATH:$JBOSS_HOME/bin</div></div><div>### $Id: run.sh 88978 2009-05-16 18:18:45Z alex.loubyansky@jboss.com $ ###</div><div><br/></div><div>export JBOSS_HOME=/opt/app/jboss-5.1.0.GA</div><div>export PATH=$PATH:$JBOSS_HOME/bin</div><div><br/></div><div>DIRNAME=`dirname $0`</div><div>PROGNAME=`basename $0`</div><div>GREP=&quot;grep&quot;</div><div><br/></div><div><br/></div><div><span style="font-size:medium;"><strong>JBOSS技术原理和常见问题解决方案</strong></span></div><div><br/></div><div><br/></div><div>1、classLoader 类的加载问题</div><div><br/></div><div>JBOSS的类加载策略 和 Tomcat是不一样的，所以可能导致 Tomcat下可以运行的程序，到JBOSS下面运行报错。</div><div><br/></div><div>以Servlet init方法为例：</div><div><br/></div><div>有以下代码：</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ClassLoader cl0 = ClassLoader.getSystemClassLoader();
 &nbsp;<span style="color:#ff0000;"><strong>// 为&nbsp;<span style="line-height:1.5;background-color:#FFFFFF;">sun.misc.Launcher$AppClassLoader</span></strong></span></div><div>&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;00&quot;+cl0);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;=====================================&quot;);</div><div>&nbsp; &nbsp; &nbsp; &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ClassLoader cl1 = this.getClass().getClassLoader(); &nbsp;<span style="color:#ff0000;"><strong>// 为Web Server 定义的 ClassLoader，用于加载 class 等资源</strong></span></div><div>&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;11&quot;+cl1);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;=====================================&quot;);</div><div>&nbsp; &nbsp; &nbsp; &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ClassLoader cl2 = Thread.currentThread().getContextClassLoader(); &nbsp;<span style="line-height:1.5;background-color:#FFFFFF;">&nbsp;</span><span style="line-height:1.5;background-color:#FFFFFF;color:#ff0000;"><strong>// 为Web Server 定义的 ClassLoader，用于启动Servlet服务</strong></span></div><div>&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;22&quot;+cl2);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;=====================================&quot;);</div><div>&nbsp; &nbsp; &nbsp; &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ClassLoader cl3 = <strong>Thread.currentThread().getClass().getClassLoader()</strong>;
 &nbsp;<span style="color:#ff0000;"><strong>// 为 null</strong></span></div><div>&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;33&quot;+cl3);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;=====================================&quot;);</div><div><br/></div><div>得到的classLoader，在JBOSS下面为</div><div>00sun.misc.Launcher$<a href="mailto:AppClassLoader@182f0db">AppClassLoader@182f0db</a> <br/>===================================== <br/><a href="mailto:11BaseClassLoader@1a7b1af">11BaseClassLoader@1a7b1af</a>{vfszip:/D:/C/Java/jboss-5.0.1.GA/server/default/deploy/servlet-01EAR.ear/servlet-01.war/} &nbsp; <span style="color:#ff0000;"><strong>// 全称为 org.jboss.classloader.spi.base.BaseClassLoader</strong></span><br/>===================================== <br/>22org.jboss.web.tomcat.service.WebCtxLoader$<a href="mailto:ENCLoader@1ed7aba">ENCLoader@1ed7aba</a>&nbsp; <span style="color:#ff0000;"><strong>// 经测试，WebCtxLoader 为 BaseClassLoader 的子类</strong></span></div><div><br/><span style="background-color:#FFFFFF;">=====================================&nbsp;</span><br/><span style="background-color:#FFFFFF;">33null&nbsp;</span><br/><span style="background-color:#FFFFFF;">=====================================</span></div><div><br/></div><div>在Tomcat下面为：</div><div>00sun.misc.Launcher$<a href="mailto:AppClassLoader@ad3ba4">AppClassLoader@ad3ba4</a> <br/>===================================== <br/>11WebappClassLoader <br/> context: /servlet-01 <br/> delegate: false <br/> repositories: <br/> /WEB-INF/classes/ <br/>----------&gt; Parent Classloader: <br/><a href="mailto:org.apache.catalina.loader.StandardClassLoader@182bcde">org.apache.catalina.loader.StandardClassLoader@182bcde</a> <br/><br/>===================================== <br/>22WebappClassLoader <br/> context: /servlet-01 <br/> delegate: false <br/> repositories: <br/> /WEB-INF/classes/ <br/>----------&gt; Parent Classloader: <br/><a href="mailto:org.apache.catalina.loader.StandardClassLoader@182bcde">org.apache.catalina.loader.StandardClassLoader@182bcde</a> <br/><br/>===================================== <br/>33null <br/>=====================================</div><div><br/></div><p><br/></p>