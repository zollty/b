---
layout: ue
title: 我的PostgreSQL技术笔记
category: 数据库技术_综合
tags: PostgreSQL
keywords: "PostgreSQL"
---

<p><strong><span style="font-size: 20px; ">0、安装PostgreSQL服务器</span></strong></p><p><span style="font-size: 20px; "></span></p><div>若有不明之处，参见官方手册：</div><div><a href="https://www.postgresql.org/docs/9.4/static/runtime.html">https://www.postgresql.org/docs/9.4/static/runtime.html</a></div><div>权限配置，参见：<a href="https://www.postgresql.org/docs/9.4/static/client-authentication.html">https://www.postgresql.org/docs/9.4/static/client-authentication.html</a></div><div>1、安装</div><div>ubuntu直接：</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-family: monospace; font-size: 18px; background-color: rgb(247, 247, 247);">apt-get install postgresql-9.4</span></div><div>其他参见：<a href="https://www.postgresql.org/download/">https://www.postgresql.org/download/</a></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Get:1&nbsp;http://ftp.cn.debian.org/debian/&nbsp;jessie/main&nbsp;libpq5&nbsp;amd64&nbsp;9.4.8-0+deb8u1&nbsp;[123&nbsp;kB]</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Get:2&nbsp;http://ftp.cn.debian.org/debian/&nbsp;jessie/main&nbsp;postgresql-client-common&nbsp;all&nbsp;165+deb8u1&nbsp;[73.7&nbsp;kB]</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Get:3&nbsp;http://ftp.cn.debian.org/debian/&nbsp;jessie/main&nbsp;postgresql-client-9.4&nbsp;amd64&nbsp;9.4.8-0+deb8u1&nbsp;[1,073&nbsp;kB]</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Get:4&nbsp;http://ftp.cn.debian.org/debian/&nbsp;jessie/main&nbsp;ssl-cert&nbsp;all&nbsp;1.0.35&nbsp;[20.9&nbsp;kB]</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Get:5&nbsp;http://ftp.cn.debian.org/debian/&nbsp;jessie/main&nbsp;postgresql-common&nbsp;all&nbsp;165+deb8u1&nbsp;[203&nbsp;kB]</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Get:6&nbsp;http://ftp.cn.debian.org/debian/&nbsp;jessie/main&nbsp;postgresql-9.4&nbsp;amd64&nbsp;9.4.8-0+deb8u1&nbsp;[3,687&nbsp;kB]</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Fetched&nbsp;5,181&nbsp;kB&nbsp;in&nbsp;4s&nbsp;(1,218&nbsp;kB/s)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Preconfiguring&nbsp;packages&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Selecting&nbsp;previously&nbsp;unselected&nbsp;package&nbsp;libpq5:amd64.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">(Reading&nbsp;database&nbsp;...&nbsp;34370&nbsp;files&nbsp;and&nbsp;directories&nbsp;currently&nbsp;installed.)</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Preparing&nbsp;to&nbsp;unpack&nbsp;.../libpq5_9.4.8-0+deb8u1_amd64.deb&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Unpacking&nbsp;libpq5:amd64&nbsp;(9.4.8-0+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Selecting&nbsp;previously&nbsp;unselected&nbsp;package&nbsp;postgresql-client-common.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Preparing&nbsp;to&nbsp;unpack&nbsp;.../postgresql-client-common_165+deb8u1_all.deb&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Unpacking&nbsp;postgresql-client-common&nbsp;(165+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Selecting&nbsp;previously&nbsp;unselected&nbsp;package&nbsp;postgresql-client-9.4.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Preparing&nbsp;to&nbsp;unpack&nbsp;.../postgresql-client-9.4_9.4.8-0+deb8u1_amd64.deb&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Unpacking&nbsp;postgresql-client-9.4&nbsp;(9.4.8-0+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Selecting&nbsp;previously&nbsp;unselected&nbsp;package&nbsp;ssl-cert.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Preparing&nbsp;to&nbsp;unpack&nbsp;.../ssl-cert_1.0.35_all.deb&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Unpacking&nbsp;ssl-cert&nbsp;(1.0.35)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Selecting&nbsp;previously&nbsp;unselected&nbsp;package&nbsp;postgresql-common.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Preparing&nbsp;to&nbsp;unpack&nbsp;.../postgresql-common_165+deb8u1_all.deb&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Adding&nbsp;&#39;diversion&nbsp;of&nbsp;/usr/bin/pg_config&nbsp;to&nbsp;/usr/bin/pg_config.libpq-dev&nbsp;by&nbsp;postgresql-common&#39;</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Unpacking&nbsp;postgresql-common&nbsp;(165+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Selecting&nbsp;previously&nbsp;unselected&nbsp;package&nbsp;postgresql-9.4.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Preparing&nbsp;to&nbsp;unpack&nbsp;.../postgresql-9.4_9.4.8-0+deb8u1_amd64.deb&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Unpacking&nbsp;postgresql-9.4&nbsp;(9.4.8-0+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Processing&nbsp;triggers&nbsp;for&nbsp;man-db&nbsp;(2.7.0.2-5)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Processing&nbsp;triggers&nbsp;for&nbsp;systemd&nbsp;(215-17+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Setting&nbsp;up&nbsp;libpq5:amd64&nbsp;(9.4.8-0+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Setting&nbsp;up&nbsp;postgresql-client-common&nbsp;(165+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Setting&nbsp;up&nbsp;postgresql-client-9.4&nbsp;(9.4.8-0+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">update-alternatives:&nbsp;using&nbsp;/usr/share/postgresql/9.4/man/man1/psql.1.gz&nbsp;to&nbsp;provide&nbsp;/usr/share/man/man1/psql.1.gz&nbsp;(psql.1.gz)&nbsp;in&nbsp;auto&nbsp;mode</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Setting&nbsp;up&nbsp;ssl-cert&nbsp;(1.0.35)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Setting&nbsp;up&nbsp;postgresql-common&nbsp;(165+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Adding&nbsp;user&nbsp;postgres&nbsp;to&nbsp;group&nbsp;ssl-cert</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Creating&nbsp;config&nbsp;file&nbsp;/etc/postgresql-common/createcluster.conf&nbsp;with&nbsp;new&nbsp;version</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Creating&nbsp;config&nbsp;file&nbsp;/etc/logrotate.d/postgresql-common&nbsp;with&nbsp;new&nbsp;version</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Building&nbsp;PostgreSQL&nbsp;dictionaries&nbsp;from&nbsp;installed&nbsp;myspell/hunspell&nbsp;packages...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Removing&nbsp;obsolete&nbsp;dictionary&nbsp;files:</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Setting&nbsp;up&nbsp;postgresql-9.4&nbsp;(9.4.8-0+deb8u1)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Creating&nbsp;new&nbsp;cluster&nbsp;9.4/main&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;&nbsp;config&nbsp;/etc/postgresql/9.4/main</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;&nbsp;data&nbsp;&nbsp;&nbsp;/var/lib/postgresql/9.4/main</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;&nbsp;locale&nbsp;en_US.UTF-8</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Flags&nbsp;of&nbsp;/var/lib/postgresql/9.4/main&nbsp;set&nbsp;as&nbsp;-------------e-C</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;&nbsp;port&nbsp;&nbsp;&nbsp;5432</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">update-alternatives:&nbsp;using&nbsp;/usr/share/postgresql/9.4/man/man1/postmaster.1.gz&nbsp;to&nbsp;provide&nbsp;/usr/share/man/man1/postmaster.1.gz&nbsp;(postmaster.1.gz)&nbsp;in&nbsp;auto&nbsp;mode</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Processing&nbsp;triggers&nbsp;for&nbsp;libc-bin&nbsp;(2.19-18+deb8u3)&nbsp;...</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Processing&nbsp;triggers&nbsp;for&nbsp;systemd&nbsp;(215-17+deb8u1)&nbsp;...</div><div>2、修改用户密码</div><div>安装时会创建postgres用户，用户的home路径为安装路径下面的一个地方，例如</div><div>/var/lib/postgresql</div><div>初次使用这个用户，最好是用root修改一下密码：</div><div>echo&nbsp;postgres:postgres&nbsp;|&nbsp;chpasswd</div><div>3、设置一下环境变量(参见：<a href="https://www.postgresql.org/docs/9.4/static/install-post.html">https://www.postgresql.org/docs/9.4/static/install-post.html</a>)</div><div>用postgres用户登录，然后在其主目录执行：</div><div>vim&nbsp;~/.bash_profile</div><div>增加如下内容：</div><pre class="brush:ps;toolbar:false">export&nbsp;PGHOME=/usr/lib/postgresql/9.4
export&nbsp;PATH=$PGHOME/bin:$PATH
export&nbsp;PGDATA=$HOME/data
export&nbsp;LD_LIBRARY_PATH=$PGHOME/lib
MANPATH=/usr/share/postgresql/9.4/man:$MANPATH
export&nbsp;MANPATH</pre><p><span style="line-height: 1.8;">其中PGHOME是postgresql的bin和lib所在的目录，可以通过以下命令查看</span></p><div>whereis&nbsp;postgresql</div><div>显示：postgresql:&nbsp;/usr/lib/postgresql&nbsp;/etc/postgresql&nbsp;/usr/share/postgresql</div><div>第一个路径就是postgresql的安装路径。</div><div>注意PGDATA设置的是当前用户的home目录的data目录下，可以先创建这个目录：</div><div>mkdir&nbsp;-p&nbsp;~/data</div><div>修改配置：</div><div>1.PostgresPlus\8.3\data\pg_hba.conf&nbsp;</div><div>#&nbsp;IPv4&nbsp;local&nbsp;connections:&nbsp;</div><div>host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.0.1/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trust&nbsp;</div><div>这样&nbsp;ip为192.168.0.1&nbsp;就可以访问你的数据库了&nbsp;。&nbsp;</div><div>如果还是不可以&nbsp;，关掉防火墙&nbsp;</div><div>2、更改postgresql.conf下&nbsp;</div><div>#listen_addresses&nbsp;=&nbsp;&#39;localhost&#39;&nbsp;#&nbsp;what&nbsp;IP&nbsp;address(es)&nbsp;to&nbsp;listen&nbsp;on;&nbsp;</div><div>为&nbsp;</div><div>listen_addresses&nbsp;=&nbsp;&#39;*&#39;</div><div>记得去掉listen_addresses前的#号</div><div>4、然后执行初始化data空间</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">postgres@open-auth-tomcat:~$&nbsp;<span style="font-weight: bold;">initdb</span></span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">The&nbsp;files&nbsp;belonging&nbsp;to&nbsp;this&nbsp;database&nbsp;system&nbsp;will&nbsp;be&nbsp;owned&nbsp;by&nbsp;user&nbsp;&quot;postgres&quot;.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">This&nbsp;user&nbsp;must&nbsp;also&nbsp;own&nbsp;the&nbsp;server&nbsp;process.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">The&nbsp;database&nbsp;cluster&nbsp;will&nbsp;be&nbsp;initialized&nbsp;with&nbsp;locale&nbsp;&quot;en_US.UTF-8&quot;.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">The&nbsp;default&nbsp;database&nbsp;encoding&nbsp;has&nbsp;accordingly&nbsp;been&nbsp;set&nbsp;to&nbsp;&quot;UTF8&quot;.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">The&nbsp;default&nbsp;text&nbsp;search&nbsp;configuration&nbsp;will&nbsp;be&nbsp;set&nbsp;to&nbsp;&quot;english&quot;.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Data&nbsp;page&nbsp;checksums&nbsp;are&nbsp;disabled.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">fixing&nbsp;permissions&nbsp;on&nbsp;existing&nbsp;directory&nbsp;/var/lib/postgresql/data&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">creating&nbsp;subdirectories&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">selecting&nbsp;default&nbsp;max_connections&nbsp;...&nbsp;100</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">selecting&nbsp;default&nbsp;shared_buffers&nbsp;...&nbsp;128MB</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">selecting&nbsp;dynamic&nbsp;shared&nbsp;memory&nbsp;implementation&nbsp;...&nbsp;posix</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">creating&nbsp;configuration&nbsp;files&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">creating&nbsp;template1&nbsp;database&nbsp;in&nbsp;/var/lib/postgresql/data/base/1&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">initializing&nbsp;pg_authid&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">initializing&nbsp;dependencies&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">creating&nbsp;system&nbsp;views&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">loading&nbsp;system&nbsp;objects&#39;&nbsp;descriptions&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">creating&nbsp;collations&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">creating&nbsp;conversions&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">creating&nbsp;dictionaries&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">setting&nbsp;privileges&nbsp;on&nbsp;built-in&nbsp;objects&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">creating&nbsp;information&nbsp;schema&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">loading&nbsp;PL/pgSQL&nbsp;server-side&nbsp;language&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">vacuuming&nbsp;database&nbsp;template1&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">copying&nbsp;template1&nbsp;to&nbsp;template0&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">copying&nbsp;template1&nbsp;to&nbsp;postgres&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">syncing&nbsp;data&nbsp;to&nbsp;disk&nbsp;...&nbsp;ok</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">WARNING:&nbsp;enabling&nbsp;&quot;trust&quot;&nbsp;authentication&nbsp;for&nbsp;local&nbsp;connections</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">You&nbsp;can&nbsp;change&nbsp;this&nbsp;by&nbsp;editing&nbsp;pg_hba.conf&nbsp;or&nbsp;using&nbsp;the&nbsp;option&nbsp;-A,&nbsp;or</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">--auth-local&nbsp;and&nbsp;--auth-host,&nbsp;the&nbsp;next&nbsp;time&nbsp;you&nbsp;run&nbsp;initdb.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">Success.&nbsp;You&nbsp;can&nbsp;now&nbsp;start&nbsp;the&nbsp;database&nbsp;server&nbsp;using:</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 16px; font-weight: bold;">postgres&nbsp;-D&nbsp;/var/lib/postgresql/data</span></span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">or</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 16px; font-weight: bold;">pg_ctl&nbsp;-D&nbsp;/var/lib/postgresql/data&nbsp;-l&nbsp;logfile&nbsp;start</span></span></div><div>其他启动命令：</div><div>postgres&nbsp;-D&nbsp;/var/lib/postgresql/data&nbsp;&gt;logfile&nbsp;2&gt;&amp;1&nbsp;&amp;</div><div>关闭命令：</div><div>$&nbsp;kill&nbsp;-INT&nbsp;`head&nbsp;-1&nbsp;/var/lib/postgresql/data/postmaster.pid`</div><p>其中postmaster.pid的路径为data所在的路径下面</p><p><br/></p><div>进入sql命令行：</div><div>参见：<a href="https://www.postgresql.org/docs/9.4/static/tutorial-accessdb.html">https://www.postgresql.org/docs/9.4/static/tutorial-accessdb.html</a></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">postgres@open-auth-tomcat:~/data$&nbsp;psql&nbsp;-U&nbsp;postgres&nbsp;-d&nbsp;postgres</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">psql&nbsp;(9.4.8)</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">Type&nbsp;&quot;help&quot;&nbsp;for&nbsp;help.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">postgres=#&nbsp;help</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">You&nbsp;are&nbsp;using&nbsp;psql,&nbsp;the&nbsp;command-line&nbsp;interface&nbsp;to&nbsp;PostgreSQL.</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">Type:&nbsp;&nbsp;\copyright&nbsp;for&nbsp;distribution&nbsp;terms</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\h&nbsp;for&nbsp;help&nbsp;with&nbsp;SQL&nbsp;commands</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\?&nbsp;for&nbsp;help&nbsp;with&nbsp;psql&nbsp;commands</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\g&nbsp;or&nbsp;terminate&nbsp;with&nbsp;semicolon&nbsp;to&nbsp;execute&nbsp;query</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\q&nbsp;to&nbsp;quit</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-weight:bold">postgres=#&nbsp;\l</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&nbsp;of&nbsp;databases</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;Owner&nbsp;&nbsp;&nbsp;|&nbsp;Encoding&nbsp;|&nbsp;&nbsp;&nbsp;Collate&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;Ctype&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Access&nbsp;privileges&nbsp;&nbsp;&nbsp;</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">-----------+----------+----------+-------------+-------------+-----------------------</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-weight:bold">&nbsp;postgres&nbsp;&nbsp;|&nbsp;postgres&nbsp;|&nbsp;UTF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;en_US.UTF-8&nbsp;|&nbsp;en_US.UTF-8&nbsp;|&nbsp;</span></div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;template0&nbsp;|&nbsp;postgres&nbsp;|&nbsp;UTF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;en_US.UTF-8&nbsp;|&nbsp;en_US.UTF-8&nbsp;|&nbsp;=c/postgres&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;postgres=CTc/postgres</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;template1&nbsp;|&nbsp;postgres&nbsp;|&nbsp;UTF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;en_US.UTF-8&nbsp;|&nbsp;en_US.UTF-8&nbsp;|&nbsp;=c/postgres&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;postgres=CTc/postgres</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;">(3&nbsp;rows)</div><div style="white-space: pre-wrap; line-height: 1.5; font-size: 14px;"><span style="font-weight:bold">postgres=#&nbsp;\q</span></div><div>默认创建了postgres的数据库</div><div>可以创建新数据库：根据模板&nbsp;template0创建数据库</div><div>CREATE&nbsp;DATABASE&nbsp;sonarqube&nbsp;TEMPLATE&nbsp;template0;</div><div>或者</div><div>$&nbsp;<strong>createdb</strong>&nbsp;-T&nbsp;template0&nbsp;sonarqube</div><div>修改数据库;</div><div><a href="https://www.postgresql.org/docs/9.4/static/sql-alterdatabase.html">https://www.postgresql.org/docs/9.4/static/sql-alterdatabase.html</a></div><div>创建role：</div><div>参见：<a href="https://www.postgresql.org/docs/9.4/static/database-roles.html">https://www.postgresql.org/docs/9.4/static/database-roles.html</a></div><div>CREATE&nbsp;ROLE&nbsp;sonarqube&nbsp;LOGIN;</div><div>ALTER&nbsp;ROLE&nbsp;sonarqube&nbsp;PASSWORD&nbsp;&#39;123456&#39;;</div><div>注意：<strong>postgresql修改密码默认是用的MD5加密过</strong>，所以这样的123456的密码明文用不了，如果想设置成明文的123456如下：</div><div>ALTER&nbsp;ROLE&nbsp;sonarqube&nbsp;<strong>UNENCRYPTED&nbsp;</strong>PASSWORD&nbsp;&#39;123456&#39;;</div><div>设置密码永久有效：ALTER&nbsp;ROLE&nbsp;sonarqube&nbsp;VALID&nbsp;UNTIL&nbsp;&#39;infinity&#39;;</div><p><br/></p><p><br/></p><p><span style="font-size: 20px; ">1、安装客户端</span></p><p>安装：</p><p>pgadmin3-1.16.1.zip</p><p>下载地址http://www.postgresql.org/ftp/pgadmin3/release/v1.16.1/</p><p><br/></p><p><span style="font-size: 20px; ">2、登录报错Access to database denied</span></p><p>详细信息如下：</p><p>Access to database denied&nbsp;</p><p><span style="color: rgb(192, 0, 0); ">The server doesn&#39;t grant access to the database</span>: the server reports</p><p>FATAL: <span style="color: rgb(192, 0, 0); ">no pg_hba.conf entry for host &quot;170.12.3.8&quot;, user &quot;dcm&quot;, database &quot;dcm&quot;, SSL off</span></p><p>To access a database on a PostgreSQL server, you first have to grant primary access to the server for your client (Host Based Authentication). PostgreSQL will check the pg_hba.conf file if a pattern that matches your client address / username / database is present and enabled before any SQL GRANT access control lists are evaluated.</p><p>The initial settings in pg_hba.conf are quite restrictive, in order to avoid unwanted security holes caused by unreviewed but mandatory system settings. <span style="color: rgb(192, 0, 0); ">You&#39;ll probably want to add something like</span></p><p><span style="color: rgb(192, 0, 0); ">host all all 192.168.0.0/24 md5</span></p><p>This example grants MD5 encrypted password access to all databases to all users on the private network 192.168.0.0/24.</p><p>You can use the pg_hba.conf editor that is built into pgAdmin III to edit the pg_hba.conf configuration file. After changing pg_hba.conf, you need to trigger a server configuration reload using pg_ctl or by stopping and restarting the server process.&nbsp;</p><p><br/></p><p>解决方案：</p><p><br/></p><p>在PostgreSQL安装目录下，找到pg_hba.conf文件，例如：/opt/PostgresPlus/9.2AS/data/pg_hba.conf</p><p style="line-height: normal; "><span style="font-size: 16px; "># &quot;local&quot; is for Unix domain socket connections only</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">local all all trust</span></p><p style="line-height: normal; "><span style="font-size: 16px; "># IPv4 local connections:</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all 127.0.0.1/32 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all 170.16.0.0/16 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all 170.16.3.8/32 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all 10.6.174.10/32 trust</span></p><p style="line-height: normal; "><span style="font-size: 16px; "># IPv6 local connections:</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all ::1/128 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; "># Allow replication connections from localhost, by a user with the replication privilege.</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">#local replication enterprisedb md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">#host replication enterprisedb 127.0.0.1/32 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">#host replication enterprisedb ::1/128 md5</span></p><p>增加IP配置项：</p><p><span style="color: rgb(192, 0, 0); ">host all all 170.26.3.0/24 md5</span></p><p>注意这个24不要乱写，24是<strong>子网掩码</strong>。</p><p>例如：</p><p style="line-height: normal; "><span style="color: rgb(255, 0, 0); ">170.26.0.0/12</span><br/></p><p style="line-height: normal; ">&nbsp; &nbsp; 这个/12代表子网掩码：/12代表12个二进制1（11111111.11110000.00000000.00000000）</p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">/8: 255.0.0.0</span></p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">/12: 255.240.0.0</span></p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">/16: 255.255.0.0</span></p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">/24: 255.255.255.0</span></p><p>170.26.0.0/12能表示的范围为：</p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">170.00010000.00000000.00000000（170.24.0.0 ）</span></p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">170.11111111.11111111.11111111（170.255.255.255 ）</span></p><p>所以170.26.3.0/24代表：</p><p><span style="color: rgb(192, 0, 0); ">170.26.3.0~170.26.3.255</span></p><p><br/></p><p>就代表0~255范围的IP地址。</p><p><br/></p><p>md5代表认证方式。常用的有ident，md5，password，trust，reject。</p><p><span style="color: rgb(192, 0, 0); ">ident</span>是Linux下PostgreSQL默认的local认证方式，凡是能正确登录服务器的操作系统用户（注：不是数据库用户）就能使用本用户映射的数据库用户不需密码登录数据库。</p><p><span style="color: rgb(192, 0, 0); ">password</span>是以明文密码传送给数据库，建议不要在生产环境中使用。</p><p><span style="color: rgb(192, 0, 0); ">md5</span>是常用的密码认证方式，如果你不使用ident，最好使用md5。</p><p><span style="color: rgb(192, 0, 0); ">trust</span>是只要知道数据库用户名就不需要密码或ident就能登录，建议不要在生产环境中使用。</p><p><span style="color: rgb(192, 0, 0); ">reject</span>是拒绝认证。</p><p><br/></p><p>修改后，最好再执行一下reload命令，使配置生效：</p><p>切换到安装目录下的bin目录。</p><p>执行：</p><p>./pg_ctl reload -D $PGDATA=/opt/PostgresPlus/9.2AS/data</p><p>（pg_ctl reload -D $PGDATA / service postgresql reload）</p><p><br/></p><p><br/></p><p>3、导出数据：</p><p>【其中dcm为用户名dcm_client为数据库名】</p><p>./pg_dump -U dcm dcm_client &gt; /opt/back_data/dcm_client.sql</p><p>【导入的数据是copy格式的PostgreSQL才能恢复的数据格式】</p><p><strong><span style="color: rgb(192, 0, 0); ">导出insert式的SQL数据：</span></strong></p><p>./pg_dump -U dcm <span style="color: rgb(192, 0, 0); ">--inserts</span> &gt; /opt/back_data/dcm_data.sql dcm_client</p><p>其中dcm为用户名dcm_client为数据库名</p><p><br/></p><p>4、新增列<br/></p><p>ALTER TABLE dcm_car_passenger ADD COLUMN etnumber character varying(20); -- --票号</p><p>ALTER TABLE dcm_car_passenger ADD COLUMN etissueddate character varying(16); -- --出票时间</p><p>ALTER TABLE dcm_car_passenger ADD COLUMN etissuanceoffice character varying(10); -- --出票office</p><p>ALTER TABLE dcm_car_passenger ADD COLUMN totalfare character varying(10); -- --总票价</p><p>COMMENT ON COLUMN dcm_car_passenger.etnumber IS &#39;--票号&#39;;</p><p>COMMENT ON COLUMN dcm_car_passenger.etissueddate IS &#39;--出票时间&#39;;</p><p>COMMENT ON COLUMN dcm_car_passenger.etissuanceoffice IS &#39;--出票office&#39;;</p><p>COMMENT ON COLUMN dcm_car_passenger.totalfare IS &#39;--总票价&#39;;</p><p><br/></p><p>5、修改列</p><p><span style="line-height: normal; color: rgb(0, 112, 192); ">ALTER TABLE</span><span class="Apple-style-span" style="line-height: normal;"> dcm_car_passenger</span></p><p style="line-height: normal; margin-top: 0px; ">&nbsp; &nbsp;ALTER COLUMN foid TYPE character varying(30);</p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">COMMENT ON COLUMN</span> dcm_car_passenger.foid IS &#39;---旅客证件号&#39;;</p><p><br/></p><p style="line-height: 32.4px; white-space: normal;">PostgreSQL的语法;</p><div style="line-height: 32.4px; white-space: normal;"><a href="https://www.postgresql.org/docs/9.4/static/tutorial-sql.html">https://www.postgresql.org/docs/9.4/static/tutorial-sql.html</a></div><p><br/></p><p><br/></p>