---
layout: ue
title: 我的PostgreSQL技术笔记
category: 数据库技术_综合
tags: PostgreSQL
keywords: "PostgreSQL"
---

<p><span style="font-size: 20px; ">1、安装客户端</span></p><p>安装：</p><p>pgadmin3-1.16.1.zip</p><p>下载地址http://www.postgresql.org/ftp/pgadmin3/release/v1.16.1/</p><p><br/></p><p><span style="font-size: 20px; ">2、登录报错Access to database denied</span></p><p>详细信息如下：</p><p>Access to database denied&nbsp;</p><p><span style="color: rgb(192, 0, 0); ">The server doesn&#39;t grant access to the database</span>: the server reports</p><p>FATAL: <span style="color: rgb(192, 0, 0); ">no pg_hba.conf entry for host &quot;170.12.3.8&quot;, user &quot;dcm&quot;, database &quot;dcm&quot;, SSL off</span></p><p>To access a database on a PostgreSQL server, you first have to grant primary access to the server for your client (Host Based Authentication). PostgreSQL will check the pg_hba.conf file if a pattern that matches your client address / username / database is present and enabled before any SQL GRANT access control lists are evaluated.</p><p>The initial settings in pg_hba.conf are quite restrictive, in order to avoid unwanted security holes caused by unreviewed but mandatory system settings. <span style="color: rgb(192, 0, 0); ">You&#39;ll probably want to add something like</span></p><p><span style="color: rgb(192, 0, 0); ">host all all 192.168.0.0/24 md5</span></p><p>This example grants MD5 encrypted password access to all databases to all users on the private network 192.168.0.0/24.</p><p>You can use the pg_hba.conf editor that is built into pgAdmin III to edit the pg_hba.conf configuration file. After changing pg_hba.conf, you need to trigger a server configuration reload using pg_ctl or by stopping and restarting the server process.&nbsp;</p><p><br/></p><p>解决方案：</p><p><br/></p><p>在PostgreSQL安装目录下，找到pg_hba.conf文件，例如：/opt/PostgresPlus/9.2AS/data/pg_hba.conf</p><p style="line-height: normal; "><span style="font-size: 16px; "># &quot;local&quot; is for Unix domain socket connections only</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">local all all trust</span></p><p style="line-height: normal; "><span style="font-size: 16px; "># IPv4 local connections:</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all 127.0.0.1/32 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all 170.16.0.0/16 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all 170.16.3.8/32 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all 10.6.174.10/32 trust</span></p><p style="line-height: normal; "><span style="font-size: 16px; "># IPv6 local connections:</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">host all all ::1/128 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; "># Allow replication connections from localhost, by a user with the replication privilege.</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">#local replication enterprisedb md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">#host replication enterprisedb 127.0.0.1/32 md5</span></p><p style="line-height: normal; "><span style="font-size: 16px; ">#host replication enterprisedb ::1/128 md5</span></p><p>增加IP配置项：</p><p><span style="color: rgb(192, 0, 0); ">host all all 170.26.3.0/24 md5</span></p><p>注意这个24不要乱写，24是<strong>子网掩码</strong>。</p><p>例如：</p><p style="line-height: normal; "><span style="color: rgb(255, 0, 0); ">170.26.0.0/12</span><br/></p><p style="line-height: normal; ">&nbsp; &nbsp; 这个/12代表子网掩码：/12代表12个二进制1（11111111.11110000.00000000.00000000）</p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">/8: 255.0.0.0</span></p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">/12: 255.240.0.0</span></p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">/16: 255.255.0.0</span></p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">/24: 255.255.255.0</span></p><p>170.26.0.0/12能表示的范围为：</p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">170.00010000.00000000.00000000（170.24.0.0 ）</span></p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">170.11111111.11111111.11111111（170.255.255.255 ）</span></p><p>所以170.26.3.0/24代表：</p><p><span style="color: rgb(192, 0, 0); ">170.26.3.0~170.26.3.255</span></p><p><br/></p><p>就代表0~255范围的IP地址。</p><p><br/></p><p>md5代表认证方式。常用的有ident，md5，password，trust，reject。</p><p><span style="color: rgb(192, 0, 0); ">ident</span>是Linux下PostgreSQL默认的local认证方式，凡是能正确登录服务器的操作系统用户（注：不是数据库用户）就能使用本用户映射的数据库用户不需密码登录数据库。</p><p><span style="color: rgb(192, 0, 0); ">password</span>是以明文密码传送给数据库，建议不要在生产环境中使用。</p><p><span style="color: rgb(192, 0, 0); ">md5</span>是常用的密码认证方式，如果你不使用ident，最好使用md5。</p><p><span style="color: rgb(192, 0, 0); ">trust</span>是只要知道数据库用户名就不需要密码或ident就能登录，建议不要在生产环境中使用。</p><p><span style="color: rgb(192, 0, 0); ">reject</span>是拒绝认证。</p><p><br/></p><p>修改后，最好再执行一下reload命令，使配置生效：</p><p>切换到安装目录下的bin目录。</p><p>执行：</p><p>./pg_ctl reload -D $PGDATA=/opt/PostgresPlus/9.2AS/data</p><p>（pg_ctl reload -D $PGDATA / service postgresql reload）</p><p><br/></p><p><br/></p><p>3、导出数据：</p><p>【其中dcm为用户名dcm_client为数据库名】</p><p>./pg_dump -U dcm dcm_client &gt; /opt/back_data/dcm_client.sql</p><p>【导入的数据是copy格式的PostgreSQL才能恢复的数据格式】</p><p><strong><span style="color: rgb(192, 0, 0); ">导出insert式的SQL数据：</span></strong></p><p>./pg_dump -U dcm <span style="color: rgb(192, 0, 0); ">--inserts</span> &gt; /opt/back_data/dcm_data.sql dcm_client</p><p>其中dcm为用户名dcm_client为数据库名</p><p><br/></p><p>4、新增列<br/></p><p>ALTER TABLE dcm_car_passenger ADD COLUMN etnumber character varying(20); -- --票号</p><p>ALTER TABLE dcm_car_passenger ADD COLUMN etissueddate character varying(16); -- --出票时间</p><p>ALTER TABLE dcm_car_passenger ADD COLUMN etissuanceoffice character varying(10); -- --出票office</p><p>ALTER TABLE dcm_car_passenger ADD COLUMN totalfare character varying(10); -- --总票价</p><p>COMMENT ON COLUMN dcm_car_passenger.etnumber IS &#39;--票号&#39;;</p><p>COMMENT ON COLUMN dcm_car_passenger.etissueddate IS &#39;--出票时间&#39;;</p><p>COMMENT ON COLUMN dcm_car_passenger.etissuanceoffice IS &#39;--出票office&#39;;</p><p>COMMENT ON COLUMN dcm_car_passenger.totalfare IS &#39;--总票价&#39;;</p><p><br/></p><p>5、修改列</p><p><span style="line-height: normal; color: rgb(0, 112, 192); ">ALTER TABLE</span><span class="Apple-style-span" style="line-height: normal; "> dcm_car_passenger</span></p><p style="line-height: normal; margin-top: 0px; ">&nbsp; &nbsp;ALTER COLUMN foid TYPE character varying(30);</p><p style="line-height: normal; "><span style="color: rgb(0, 112, 192); ">COMMENT ON COLUMN</span> dcm_car_passenger.foid IS &#39;---旅客证件号&#39;;</p><p><br/></p>
