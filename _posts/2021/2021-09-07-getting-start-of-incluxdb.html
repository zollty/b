---
layout: ue
title: InfluxDBå…¥é—¨æ•™ç¨‹
category: ä¸­é—´ä»¶æŠ€æœ¯
tags: [InfluxDB]
keywords: "InfluxDBæ•™ç¨‹"
---

{% raw %}
<p><span style="color: inherit; font-family: é»‘ä½“, SimHei; font-size: 24px; font-weight: 600;">ä¸€ã€åŸºç¡€æ¦‚å¿µ</span><br/></p><p>1ã€å­˜å‚¨æ¡¶ï¼ˆbucketï¼‰</p><p>bucketæ˜¯å­˜å‚¨æ—¶åºæ•°æ®çš„ä¸€ä¸ªå‘½åç©ºé—´ï¼Œç›¸å½“äºæ•°æ®è¡¨ã€‚</p><p>æ¯ä¸ªbucketéƒ½å¿…é¡»è®¾ç½®æ•°æ®ä¿å­˜çš„æ—¶é•¿ã€‚å­˜å‚¨æ¡¶å±äºæŸä¸ªç»„ç»‡ã€‚<br/></p><p>ç¿»è¯‘è‡ªï¼š<a href="https://docs.influxdata.com/influxdb/v2.0/organizations/buckets/">https://docs.influxdata.com/influxdb/v2.0/organizations/buckets/</a></p><p>2ã€ç»„ç»‡ï¼ˆOrganizationï¼‰</p><p>æ¯ä¸ªç»„ç»‡åˆ›å»ºæ—¶éƒ½å¿…é¡»å…³è”ä¸€ä¸ªå­˜å‚¨æ¡¶ï¼ˆbucketï¼‰ï¼Œæ‰€ä»¥æ¯ä¸ªç»„ç»‡éƒ½è‡³å°‘æœ‰ä¸€ä¸ªbucketï¼Œ</p><p>å•ä¸ªInfluxDB OSSï¼Œå»ºè®®å­˜å‚¨æ¡¶ä¸è¶…è¿‡20ï¼Œå› æ­¤ç»„ç»‡ä¹Ÿä¸è¶…è¿‡20ä¸ªã€‚</p><p>å•ä¸ªInfluxDB OSSï¼Œæ”¯æŒ20ä¸ªbucketsä»¥å†…çš„æŒç»­å†™å…¥æˆ–è€…è·¨bucketæˆ–ç»„ç»‡çš„æŒç»­æŸ¥è¯¢ã€‚</p><p>3ã€æˆå‘˜ï¼ˆMemberï¼‰ï¼ˆç›¸å½“äºç”¨æˆ·ï¼‰</p><p>æ¯ä¸ªæˆå‘˜éƒ½ä»å±äºç»„ç»‡ã€‚æˆå‘˜å¯ä»¥å±äºå¤šä¸ªç»„ç»‡ã€‚</p><p>4ã€APIä»¤ç‰Œï¼ˆtokenï¼‰<br/></p><p>ç”¨æˆ·ä½¿ç”¨API tokenè®¿é—®å¯¹åº”ç»„ç»‡çš„æ•°æ®ã€‚<br/></p><p>bucketåªæ˜¯ç»„ç»‡ä¸­çš„ä¸€ç±»æ•°æ®ï¼Œç»„ç»‡ä¸­è¿˜æœ‰userã€taskç­‰å…¶ä»–æ•°æ®ã€‚</p><p><br/></p><h2>äºŒã€æ•°æ®å…ƒç´ </h2><p>ç¿»è¯‘è‡ªï¼š<a href="https://docs.influxdata.com/influxdb/v2.0/reference/key-concepts/data-elements/">https://docs.influxdata.com/influxdb/v2.0/reference/key-concepts/data-elements/</a></p><p>æ•°æ®ç»„ç»‡æ¨¡å¼ï¼ˆSchemaï¼‰ï¼š</p><p>InfluxDB schemaåŒ…æ‹¬ï¼š buckets, series, measurements, tag keys, tag values, and field keysã€‚</p><p>æ¯ä¸ªbucketå­˜å‚¨çš„æ•°æ®ç»“æ„ â€œç¤ºæ„â€ å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p>_time<span style="white-space: pre;">	</span>_measurement<span style="white-space: pre;">	</span>location<span style="white-space: pre;">	</span>scientist<span style="white-space: pre;">	</span>_field<span style="white-space: pre;">	</span>_value</p><p>2019-08-18T00:00:00Z<span style="white-space:pre">	</span>census<span style="white-space:pre">	</span>klamath<span style="white-space:pre">	</span>anderson<span style="white-space:pre">	</span>bees<span style="white-space:pre">	</span>23</p><p>2019-08-18T00:00:00Z<span style="white-space:pre">	</span>census<span style="white-space:pre">	</span>portland<span style="white-space:pre">	</span>mullen<span style="white-space:pre">	</span>ants<span style="white-space:pre">	</span>30</p><p>2019-08-18T00:06:00Z<span style="white-space:pre">	</span>census<span style="white-space:pre">	</span>klamath<span style="white-space:pre">	</span>anderson<span style="white-space:pre">	</span>bees<span style="white-space:pre">	</span>28</p><p>2019-08-18T00:06:00Z<span style="white-space: pre;">	</span>census<span style="white-space: pre;">	</span>portland<span style="white-space: pre;">	</span>mullen<span style="white-space: pre;">	</span>ants<span style="white-space: pre;">	</span>32</p><p>å…¶ä¸­ï¼š</p><p><strong>_measurementï¼š</strong>ä»£è¡¨ä¸€ä¸ªå¤§ç±»å‹çš„æ•°æ®ï¼ˆåŒ…æ‹¬æŸä¸ªç±»å‹çš„æ‰€æœ‰ _field å’Œ tagsï¼‰ã€‚<br/></p><p>ä¸€ä¸ªbucketå¯ä»¥å­˜å‚¨ä»»æ„æ•°é‡çš„measurementã€‚æ¯ç§measurementçš„tagså¯ä»¥ä¸åŒã€‚</p><p><strong>field key å’Œ filed valueï¼š</strong>å³ key-valueï¼Œæ³¨æ„keyæ˜¯æ— ç´¢å¼•çš„</p><p><strong>tag</strong>ï¼šç›¸å½“äºç´¢å¼•ä¿¡æ¯ï¼Œtag keyä¸ºè¡¨å¤´metaä¿¡æ¯ï¼Œtag valueå­˜å‚¨åˆ°æ¯è¡Œæ•°æ®ä¸­ï¼ˆstringç±»å‹ï¼‰ã€‚</p><p>tag valueå¯ä»¥ä¸ºç©ºï¼Œä½†æ˜¯tagå­—æ®µä½œä¸ºç´¢å¼•ï¼Œä¸€èˆ¬éœ€è¦èƒ½å¯¹æ•°æ®è¿›è¡Œé™ç»´åˆ†ç±»â€”â€”tagè¦é€‚åˆäºåˆ†ç±»ï¼Œè€Œä¸å»ºè®®ä½¿ç”¨ UUIDs, hashes, and random stringsè¿™ç§ä¼šå¯¼è‡´å¤§é‡å”¯ä¸€çš„ç±»å‹ï¼ˆç§°ä¹‹ä¸º high series cardinalityï¼šé«˜ç»´åŸºæ•°ï¼‰ï¼Œé«˜ç»´åŸºæ•°æ˜¯å¯¼è‡´æ•°æ®åº“å†…å­˜å ç”¨å·¨å¤§çš„ç½ªé­ç¥¸é¦–ã€‚</p><p><strong>field setï¼š</strong>å³ä¸€ç»„ time + key-value çš„é›†åˆï¼Œä¾‹å¦‚</p><pre class="brush:plain;toolbar:false">census bees=23i,ants=30i 1566086400000000000
census bees=28i,ants=32i 1566086760000000000
&nbsp; &nbsp; &nbsp; &nbsp;-----------------
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Field set</pre><p><strong>tag setï¼š</strong>å³ä¸€ç»„ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼‰tag key + tag valueçš„é›†åˆï¼Œä¾‹å¦‚ï¼š<br/></p><pre class="brush:plain;toolbar:false">location = klamath, scientist = anderson
location = portland, scientist = anderson
location = klamath, scientist = mullen
location = portland, scientist = mullen</pre><p><strong>Seriesï¼ˆåºåˆ—ï¼‰</strong>ï¼šæŠŠå…·æœ‰ç›¸åŒ_measurement + tags k-v + _field keyçš„æ•°æ®ï¼ˆæ—¶é—´å’Œfield valueï¼‰ç§°ä¹‹ä¸ºä¸€ä¸ªåºåˆ—ã€‚ä¾‹å¦‚ï¼š</p><pre class="brush:plain;toolbar:false"># series key
census,location=klamath,scientist=anderson bees

# series
2019-08-18T00:00:00Z 23
2019-08-18T00:06:00Z 28  </pre><p><strong>ç‚¹ä½ï¼ˆPointï¼‰</strong>ï¼šä¸€ä¸ªç‚¹ä½åŒ…æ‹¬äº†series keyã€field value å’Œ timestampï¼Œä¾‹å¦‚ï¼š</p><pre class="brush:plain;toolbar:false">2019-08-18T00:00:00Z census ants 30 portland mullen</pre><p><strong>æ³¨æ„(ä¸€)ï¼ŒInfluxDBæ²¡æœ‰ç‚¹ä½IDçš„æ¦‚å¿µ</strong><strong>ï¼Œæ‰€æœ‰ç‚¹ä½éƒ½æ˜¯æ ¹æ®series keyæ¥ç¡®å®šçš„</strong>ï¼Œè€Œseries keyæ˜¯ _measurement + tags k-v + _field keyä¸‰è€…çš„ç»„åˆã€‚ç†è®ºä¸Štagså¯ä»¥æ²¡æœ‰ï¼Œ_measurementå¯ä»¥çœ‹åšå°è¡¨åç§°ï¼Œæ‰€ä»¥field keyå¯ä»¥è¿‘ä¼¼çš„è§†ä¸ºâ€œç‚¹ä½IDâ€ã€‚</p><p><strong>æ³¨æ„(äºŒ)ï¼Œé¿å…è¿‡é«˜çš„series</strong>ï¼šç”±äºç‚¹ä½æ˜¯ç”±series keyç¡®å®šçš„ï¼Œè€Œseriers keyåˆæ˜¯ç”±_measurement + tags k-v + _field keyä¸‰è€…çš„ç»„åˆç¡®å®šçš„ï¼Œæ‰€ä»¥è®¾è®¡æ—¶ï¼Œå»ºè®®é™ä½series keyçš„æ•°é‡ï¼Œå³å‡å°‘ä¸‰è€…ç»„åˆçš„ä¸ªæ•°ã€‚</p><p><br/></p><p><strong>æ•°æ®å†™å…¥ä½¿ç”¨è¡Œåè®®ï¼ˆLine protocolï¼‰</strong>ï¼ŒåŒ…æ‹¬4ä¸ªéƒ¨åˆ†ï¼š</p><p>measurement</p><p>field set</p><p>tag setï¼ˆå¯é€‰ï¼‰</p><p>timestampï¼ˆå¯é€‰ï¼‰</p><p>ä¾‹å¦‚ï¼š</p><pre class="brush:plain;toolbar:false">measurementName,tagKey=tagValue fieldKey=&quot;fieldValue&quot; 1465839830100400200
                               |                     |
                           1st space             2nd space
# Measurement name with spaces
my\ Measurement fieldKey=&quot;string value&quot;

# Double quotes in a string field value
myMeasurement fieldKey=&quot;\&quot;string\&quot; within a string&quot;

# Tag keys and values with spaces
myMeasurement,tag\ Key1=tag\ Value1,tag\ Key2=tag\ Value2 fieldKey=100

# Emojis
myMeasurement,tagKey=ğŸ­ fieldKey=&quot;Launch ğŸš€&quot; 1556813561098000000</pre><p>è¡Œåè®®å…·ä½“å®šä¹‰å‚è§ï¼š<a href="https://docs.influxdata.com/influxdb/v2.0/reference/syntax/line-protocol">https://docs.influxdata.com/influxdb/v2.0/reference/syntax/line-protocol</a> </p><p><br/></p><p><strong>å®˜æ–¹å»ºè®®çš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼š</strong></p><p><strong>1ã€é¿å…åœ¨æµ‹é‡åç§°ä¸­ç¼–ç æ•°æ®</strong></p><p>ä¾‹å¦‚ï¼š</p><pre class="brush:plain;toolbar:false">Schema 1 - Data encoded in the measurement name
-------------
blueberries.plot-1.north temp=50.1 1472515200000000000
blueberries.plot-2.midwest temp=49.8 1472515200000000000</pre><p><strong>2ã€é¿å…åœ¨ä¸€ä¸ªæ ‡ç­¾ä¸­æ”¾ç½®å¤šäºä¸€æ¡ä¿¡æ¯</strong></p><p>ä¾‹å¦‚ï¼š</p><pre class="brush:plain;toolbar:false">Schema 1 - Multiple data encoded in a single tag
-------------
weather_sensor,crop=blueberries,location=plot-1.north temp=50.1 1472515200000000000
weather_sensor,crop=blueberries,location=plot-2.midwest temp=49.8 1472515200000000000</pre><p>è¿™æ˜¯å› ä¸ºï¼Œåœ¨InfluxDBä¸­ï¼Œtagsçš„æ•°é‡æ˜¯ä¸é™åˆ¶çš„ï¼Œå®ƒä»å­˜å‚¨å±‚é¢æ”¯æŒå¤šåˆ—ç´¢å¼•ã€‚ï¼ˆè‡³äºtagsæ•°é‡å¤šäº†ä¹‹åï¼Œæ˜¯å¦å½±å“å­˜å‚¨å’ŒæŸ¥è¯¢æ•ˆç‡ï¼Œæš‚ä¸”æœªçŸ¥ï¼‰</p><p><br/></p><h3>ä¸‰ã€æœåŠ¡ç«¯å…³é”®é…ç½®<br/></h3><p>åŒ…æ‹¬æ–‡ä»¶åœ°å€ï¼ŒæŸ¥è¯¢è¿æ¥æ± ç­‰ï¼Œå¦‚ä¸‹ï¼š</p><pre class="brush:bash;toolbar:false">[root@influxdb2]# cat config.yml 
bolt-path: /home/data/.influxdbv2/influxd.bolt
engine-path: /home/data/.influxdbv2/engine
http-write-timeout: 65s
http-read-timeout: 305s
query-queue-size: 100
query-memory-bytes: 104857600
query-concurrency: 100</pre><p>å…·ä½“å‚è§å®˜æ–¹é…ç½®æ–‡æ¡£ã€‚</p><p><br/></p><h3>å››ã€å®¢æˆ·ç«¯å…³é”®é…ç½®ï¼ˆä»¥Javaä¸ºä¾‹ï¼‰</h3><p>ç”Ÿäº§ä½¿ç”¨ï¼Œå¼ºçƒˆå»ºè®®é…ç½®HttpClientå„é¡¹å‚æ•°ï¼Œé€šè¿‡æµ‹è¯•å’Œç›‘æ§æ¥è®¾ç½®åˆç†çš„å€¼ã€‚</p><p>ä¾‹å¦‚å‹åŠ›æµ‹è¯•æ—¶çš„é…ç½®å¦‚ä¸‹ï¼š</p><pre class="brush:java;toolbar:false">Dispatcher dispatcher = new Dispatcher();
dispatcher.setMaxRequestsPerHost(1000); // é»˜è®¤5
dispatcher.setMaxRequests(1000); // é»˜è®¤64
OkHttpClient.Builder okHttpClient = new OkHttpClient.Builder()
        .protocols(Collections.singletonList(Protocol.HTTP_1_1))
        // è®¾ç½®å®Œæˆè¯·æ±‚çš„è¶…æ—¶ï¼›è°ƒç”¨è¶…æ—¶è·¨è¶Šæ•´ä¸ªè°ƒç”¨ï¼šè§£æDNSã€è¿æ¥ã€å†™å…¥è¯·æ±‚ã€æ­£æ–‡ã€æœåŠ¡å™¨å¤„ç†å’Œè¯»å–å“åº”æ­£æ–‡ã€‚å¦‚æœå‘¼å«éœ€è¦é‡å®šå‘æˆ–
        // æ‰€æœ‰é‡è¯•éƒ½å¿…é¡»åœ¨ä¸€ä¸ªè¶…æ—¶æ—¶é—´å†…å®Œæˆï¼›é»˜è®¤ä¸º0ï¼Œåˆ™ä¸è®¾ç½®è¶…æ—¶
        .callTimeout(Duration.ZERO)
        // å»ºç«‹è¿æ¥ï¼ˆTCP å¥—æ¥å­—ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼›é»˜è®¤å€¼æ˜¯10S
        .connectTimeout(Duration.ofSeconds(100))
        // å‘èµ·è¯·æ±‚åˆ°è¯»åˆ°å“åº”æ•°æ®çš„è¶…æ—¶æ—¶é—´,é»˜è®¤æ˜¯10S
        .readTimeout(Duration.ofSeconds(600))
        // å‘èµ·è¯·æ±‚å¹¶è¢«â½¬ç›®æ ‡æœåŠ¡å™¨ï¨¸æ¥å—çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯10S
        .writeTimeout(Duration.ofSeconds(60))
        // é»˜è®¤è¿æ¥æ± é…ç½®é»˜è®¤5,5
        .connectionPool(new ConnectionPool(5, 5, TimeUnit.MINUTES)).dispatcher(dispatcher);
InfluxDBClientOptions options = InfluxDBClientOptions.builder().url(&quot;http://192.168.10.36:8086&quot;)
        .authenticateToken(token).org(org).bucket(bucket).okHttpClient(okHttpClient).build();</pre><p><br/></p><h3>äº”ã€æˆ‘å¯¹InfluxDBçš„æµ‹è¯•åŠè¯„ä»·</h3><p>1ã€å¼€æºç‰ˆæœ¬ä¸æ”¯æŒé›†ç¾¤</p><p>ä¸æ”¯æŒé›†ç¾¤ï¼Œæ€§èƒ½å’Œå®¹é‡å¦‚ä½•æ‰©å±•ï¼Œæ•°æ®å¦‚ä½•å¤‡ä»½ï¼Œéœ€è¦è°¨æ…è¯„ä¼°ã€‚å¦‚æœè¦ä¹°å•†ä¸šç‰ˆå¦è®ºã€‚</p><p>å¦‚æœç ”å‘èƒ½åŠ›å¼ºï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä¸€ä¸‹è‡ªç ”InfluxDB HAæ–¹æ¡ˆåŠç»„ä»¶ï¼Œæœ€ç®€å•çš„æ˜¯ç±»ä¼¼äºsharding-jdbcè¿™ç§åˆ†åº“åˆ†è¡¨æ–¹æ³•ï¼Œè¿˜æœ‰åŸºäºRaftçš„æ–¹æ¡ˆã€‚</p><p><br/></p><p>2ã€æ€§èƒ½</p><p>å•èŠ‚ç‚¹æ™®é€šé…ç½®ï¼ŒåŒæœåŠ¡å™¨ä¸‹æµ‹è¯•ï¼Œå†™å…¥æ€§èƒ½è¾¾åˆ°6w/så·¦å³ï¼Œç®—æ˜¯ä¸€æµçš„ã€‚æŸ¥è¯¢æ€§èƒ½æœ‰3w/sï¼Œç®—æ¯”è¾ƒå¥½ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŒæ ·çš„ç¯å¢ƒå’Œç±»ä¼¼çš„ç¨‹åºæµ‹è¯•ä¸‹ï¼ŒHBaseçš„æŸ¥è¯¢æ€§èƒ½å¯è¾¾300w/sã€‚</p><p><br/></p>
{% endraw %}
